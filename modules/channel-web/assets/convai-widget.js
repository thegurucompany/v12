(function(Fe){typeof define=="function"&&define.amd?define(Fe):Fe()})(function(){"use strict";var ik=Object.defineProperty;var rk=(Fe,F,mn)=>F in Fe?ik(Fe,F,{enumerable:!0,configurable:!0,writable:!0,value:mn}):Fe[F]=mn;var Ht=(Fe,F,mn)=>rk(Fe,typeof F!="symbol"?F+"":F,mn);var Fe,F,mn,nc,gn,ic,rc,oc,sc,so,ao,co,ac,hi={},cc=[],op=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,fi=Array.isArray;function ht(t,e){for(var n in e)t[n]=e[n];return t}function lo(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function pe(t,e,n){var i,r,o,s={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?Fe.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)s[o]===void 0&&(s[o]=t.defaultProps[o]);return pi(t,s,i,r,null)}function pi(t,e,n,i,r){var o={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++mn,__i:-1,__u:0};return r==null&&F.vnode!=null&&F.vnode(o),o}function lc(){return{current:null}}function Ee(t){return t.children}function Qe(t,e){this.props=t,this.context=e}function On(t,e){if(e==null)return t.__?On(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?On(t):null}function dc(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return dc(t)}}function uo(t){(!t.__d&&(t.__d=!0)&&gn.push(t)&&!Wi.__r++||ic!==F.debounceRendering)&&((ic=F.debounceRendering)||rc)(Wi)}function Wi(){for(var t,e,n,i,r,o,s,a=1;gn.length;)gn.length>a&&gn.sort(oc),t=gn.shift(),a=gn.length,t.__d&&(n=void 0,r=(i=(e=t).__v).__e,o=[],s=[],e.__P&&((n=ht({},i)).__v=i.__v+1,F.vnode&&F.vnode(n),ho(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[r]:null,o,r??On(i),!!(32&i.__u),s),n.__v=i.__v,n.__.__k[n.__i]=n,mc(o,n,s),n.__e!=r&&dc(n)));Wi.__r=0}function uc(t,e,n,i,r,o,s,a,c,l,d){var u,h,f,m,p,g,v=i&&i.__k||cc,_=e.length;for(c=sp(n,e,v,c,_),u=0;u<_;u++)(f=n.__k[u])!=null&&(h=f.__i===-1?hi:v[f.__i]||hi,f.__i=u,g=ho(t,f,h,r,o,s,a,c,l,d),m=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&fo(h.ref,null,f),d.push(f.ref,f.__c||m,f)),p==null&&m!=null&&(p=m),4&f.__u||h.__k===f.__k?c=hc(f,c,t):typeof f.type=="function"&&g!==void 0?c=g:m&&(c=m.nextSibling),f.__u&=-7);return n.__e=p,c}function sp(t,e,n,i,r){var o,s,a,c,l,d=n.length,u=d,h=0;for(t.__k=new Array(r),o=0;o<r;o++)(s=e[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(c=o+h,(s=t.__k[o]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?pi(null,s,null,null,null):fi(s)?pi(Ee,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?pi(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=t,s.__b=t.__b+1,a=null,(l=s.__i=ap(s,n,c,u))!==-1&&(u--,(a=n[l])&&(a.__u|=2)),a==null||a.__v===null?(l==-1&&(r>d?h--:r<d&&h++),typeof s.type!="function"&&(s.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,s.__u|=4))):t.__k[o]=null;if(u)for(o=0;o<d;o++)(a=n[o])!=null&&!(2&a.__u)&&(a.__e==i&&(i=On(a)),vc(a,a));return i}function hc(t,e,n){var i,r;if(typeof t.type=="function"){for(i=t.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=t,e=hc(i[r],e,n));return e}t.__e!=e&&(e&&t.type&&!n.contains(e)&&(e=On(t)),n.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function xt(t,e){return e=e||[],t==null||typeof t=="boolean"||(fi(t)?t.some(function(n){xt(n,e)}):e.push(t)),e}function ap(t,e,n,i){var r,o,s=t.key,a=t.type,c=e[n];if(c===null&&t.key==null||c&&s==c.key&&a===c.type&&!(2&c.__u))return n;if(i>(c!=null&&!(2&c.__u)?1:0))for(r=n-1,o=n+1;r>=0||o<e.length;){if(r>=0){if((c=e[r])&&!(2&c.__u)&&s==c.key&&a===c.type)return r;r--}if(o<e.length){if((c=e[o])&&!(2&c.__u)&&s==c.key&&a===c.type)return o;o++}}return-1}function fc(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||op.test(e)?n:n+"px"}function Hi(t,e,n,i,r){var o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||fc(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||fc(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(sc,"$1")),e=e.toLowerCase()in t||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?i?n.t=i.t:(n.t=so,t.addEventListener(e,o?co:ao,o)):t.removeEventListener(e,o?co:ao,o);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function pc(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.u==null)e.u=so++;else if(e.u<n.t)return;return n(F.event?F.event(e):e)}}}function ho(t,e,n,i,r,o,s,a,c,l){var d,u,h,f,m,p,g,v,_,C,y,k,T,E,I,x,D,O=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),o=[a=e.__e=n.__e]),(d=F.__b)&&d(e);e:if(typeof O=="function")try{if(v=e.props,_="prototype"in O&&O.prototype.render,C=(d=O.contextType)&&i[d.__c],y=d?C?C.props.value:d.__:i,n.__c?g=(u=e.__c=n.__c).__=u.__E:(_?e.__c=u=new O(v,y):(e.__c=u=new Qe(v,y),u.constructor=O,u.render=lp),C&&C.sub(u),u.props=v,u.state||(u.state={}),u.context=y,u.__n=i,h=u.__d=!0,u.__h=[],u._sb=[]),_&&u.__s==null&&(u.__s=u.state),_&&O.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=ht({},u.__s)),ht(u.__s,O.getDerivedStateFromProps(v,u.__s))),f=u.props,m=u.state,u.__v=e,h)_&&O.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),_&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(_&&O.getDerivedStateFromProps==null&&v!==f&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(v,y),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(v,u.__s,y)===!1||e.__v==n.__v)){for(e.__v!=n.__v&&(u.props=v,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(U){U&&(U.__=e)}),k=0;k<u._sb.length;k++)u.__h.push(u._sb[k]);u._sb=[],u.__h.length&&s.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(v,u.__s,y),_&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(f,m,p)})}if(u.context=y,u.props=v,u.__P=t,u.__e=!1,T=F.__r,E=0,_){for(u.state=u.__s,u.__d=!1,T&&T(e),d=u.render(u.props,u.state,u.context),I=0;I<u._sb.length;I++)u.__h.push(u._sb[I]);u._sb=[]}else do u.__d=!1,T&&T(e),d=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++E<25);u.state=u.__s,u.getChildContext!=null&&(i=ht(ht({},i),u.getChildContext())),_&&!h&&u.getSnapshotBeforeUpdate!=null&&(p=u.getSnapshotBeforeUpdate(f,m)),x=d,d!=null&&d.type===Ee&&d.key==null&&(x=gc(d.props.children)),a=uc(t,fi(x)?x:[x],e,n,i,r,o,s,a,c,l),u.base=e.__e,e.__u&=-161,u.__h.length&&s.push(u),g&&(u.__E=u.__=null)}catch(U){if(e.__v=null,c||o!=null)if(U.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,e.__e=a}else for(D=o.length;D--;)lo(o[D]);else e.__e=n.__e,e.__k=n.__k;F.__e(U,e,n)}else o==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=cp(n.__e,e,n,i,r,o,s,c,l);return(d=F.diffed)&&d(e),128&e.__u?void 0:a}function mc(t,e,n){for(var i=0;i<n.length;i++)fo(n[i],n[++i],n[++i]);F.__c&&F.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(o){o.call(r)})}catch(o){F.__e(o,r.__v)}})}function gc(t){return typeof t!="object"||t==null?t:fi(t)?t.map(gc):ht({},t)}function cp(t,e,n,i,r,o,s,a,c){var l,d,u,h,f,m,p,g=n.props,v=e.props,_=e.type;if(_=="svg"?r="http://www.w3.org/2000/svg":_=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),o!=null){for(l=0;l<o.length;l++)if((f=o[l])&&"setAttribute"in f==!!_&&(_?f.localName==_:f.nodeType==3)){t=f,o[l]=null;break}}if(t==null){if(_==null)return document.createTextNode(v);t=document.createElementNS(r,_,v.is&&v),a&&(F.__m&&F.__m(e,o),a=!1),o=null}if(_===null)g===v||a&&t.data===v||(t.data=v);else{if(o=o&&Fe.call(t.childNodes),g=n.props||hi,!a&&o!=null)for(g={},l=0;l<t.attributes.length;l++)g[(f=t.attributes[l]).name]=f.value;for(l in g)if(f=g[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=f;else if(!(l in v)){if(l=="value"&&"defaultValue"in v||l=="checked"&&"defaultChecked"in v)continue;Hi(t,l,null,f,r)}}for(l in v)f=v[l],l=="children"?h=f:l=="dangerouslySetInnerHTML"?d=f:l=="value"?m=f:l=="checked"?p=f:a&&typeof f!="function"||g[l]===f||Hi(t,l,f,g[l],r);if(d)a||u&&(d.__html===u.__html||d.__html===t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(u&&(t.innerHTML=""),uc(e.type==="template"?t.content:t,fi(h)?h:[h],e,n,i,_=="foreignObject"?"http://www.w3.org/1999/xhtml":r,o,s,o?o[0]:n.__k&&On(n,0),a,c),o!=null)for(l=o.length;l--;)lo(o[l]);a||(l="value",_=="progress"&&m==null?t.removeAttribute("value"):m!==void 0&&(m!==t[l]||_=="progress"&&!m||_=="option"&&m!==g[l])&&Hi(t,l,m,g[l],r),l="checked",p!==void 0&&p!==t[l]&&Hi(t,l,p,g[l],r))}return t}function fo(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(r){F.__e(r,n)}}function vc(t,e,n){var i,r;if(F.unmount&&F.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||fo(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){F.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&vc(i[r],e,n||typeof t.type!="function");n||lo(t.__e),t.__c=t.__=t.__e=void 0}function lp(t,e,n){return this.constructor(t,n)}function zt(t,e,n){var i,r,o,s;e==document&&(e=document.documentElement),F.__&&F.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,o=[],s=[],ho(e,t=(!i&&n||e).__k=pe(Ee,null,[t]),r||hi,hi,e.namespaceURI,!i&&n?[n]:r?null:e.firstChild?Fe.call(e.childNodes):null,o,!i&&n?n:r?r.__e:e.firstChild,i,s),mc(o,t,s)}function po(t,e){zt(t,e,po)}function mo(t,e,n){var i,r,o,s,a=ht({},t.props);for(o in t.type&&t.type.defaultProps&&(s=t.type.defaultProps),e)o=="key"?i=e[o]:o=="ref"?r=e[o]:a[o]=e[o]===void 0&&s!==void 0?s[o]:e[o];return arguments.length>2&&(a.children=arguments.length>3?Fe.call(arguments,2):n),pi(t.type,a,i||t.key,r||t.ref,null)}function Ne(t){function e(n){var i,r;return this.getChildContext||(i=new Set,(r={})[e.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&i.forEach(function(s){s.__e=!0,uo(s)})},this.sub=function(o){i.add(o);var s=o.componentWillUnmount;o.componentWillUnmount=function(){i&&i.delete(o),s&&s.call(o)}}),n.children}return e.__c="__cC"+ac++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,i){return n.children(i)}).contextType=e,e}Fe=cc.slice,F={__e:function(t,e,n,i){for(var r,o,s;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),s=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t,i||{}),s=r.__d),s)return r.__E=r}catch(a){t=a}throw t}},mn=0,nc=function(t){return t!=null&&t.constructor==null},Qe.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ht({},this.state),typeof t=="function"&&(t=t(ht({},n),this.props)),t&&ht(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),uo(this))},Qe.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),uo(this))},Qe.prototype.render=Ee,gn=[],rc=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,oc=function(t,e){return t.__v.__b-e.__v.__b},Wi.__r=0,sc=/(PointerCapture)$|Capture$/i,so=0,ao=pc(!1),co=pc(!0),ac=0;function go(){return(go=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var dp=["context","children"];function up(t){this.getChildContext=function(){return t.context};var e=t.children,n=function(i,r){if(i==null)return{};var o,s,a={},c=Object.keys(i);for(s=0;s<c.length;s++)r.indexOf(o=c[s])>=0||(a[o]=i[o]);return a}(t,dp);return mo(e,n)}function hp(){var t=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(t),this._vdom=pe(up,go({},this._props,{context:t.detail.context}),function e(n,i){if(n.nodeType===3)return n.data;if(n.nodeType!==1)return null;var r=[],o={},s=0,a=n.attributes,c=n.childNodes;for(s=a.length;s--;)a[s].name!=="slot"&&(o[a[s].name]=a[s].value,o[yc(a[s].name)]=a[s].value);for(s=c.length;s--;){var l=e(c[s],null),d=c[s].slot;d?o[d]=pe(bc,{name:d},l):r[s]=l}var u=i?pe(bc,null,r):r;return pe(i||n.nodeName.toLowerCase(),o,u)}(this,this._vdomComponent)),(this.hasAttribute("hydrate")?po:zt)(this._vdom,this._root)}function yc(t){return t.replace(/-(\w)/g,function(e,n){return n?n.toUpperCase():""})}function fp(t,e,n){if(this._vdom){var i={};i[t]=n=n??void 0,i[yc(t)]=n,this._vdom=mo(this._vdom,i),zt(this._vdom,this._root)}}function pp(){zt(this._vdom=null,this._root)}function bc(t,e){var n=this;return pe("slot",go({},t,{ref:function(i){i?(n.ref=i,n._listener||(n._listener=function(r){r.stopPropagation(),r.detail.context=e},i.addEventListener("_preact",n._listener))):n.ref.removeEventListener("_preact",n._listener)}}))}function mp(t,e,n,i){function r(){var o=Reflect.construct(HTMLElement,[],r);return o._vdomComponent=t,o._root=i&&i.shadow?o.attachShadow({mode:i.mode||"open"}):o,o}return(r.prototype=Object.create(HTMLElement.prototype)).constructor=r,r.prototype.connectedCallback=hp,r.prototype.attributeChangedCallback=fp,r.prototype.disconnectedCallback=pp,n=n||t.observedAttributes||Object.keys(t.propTypes||{}),r.observedAttributes=n,n.forEach(function(o){Object.defineProperty(r.prototype,o,{get:function(){return this._vdom.props[o]},set:function(s){this._vdom?this.attributeChangedCallback(o,null,s):(this._props||(this._props={}),this._props[o]=s,this.connectedCallback());var a=typeof s;s!=null&&a!=="string"&&a!=="boolean"&&a!=="number"||this.setAttribute(o,s)}})}),customElements.define(e,r)}var gp=0;function S(t,e,n,i,r,o){e||(e={});var s,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?s=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--gp,__i:-1,__u:0,__source:r,__self:o};if(typeof t=="function"&&(s=t.defaultProps))for(a in s)c[a]===void 0&&(c[a]=s[a]);return F.vnode&&F.vnode(l),l}var It,ae,vo,_c,Dn=0,Cc=[],ge=F,kc=ge.__b,Sc=ge.__r,Tc=ge.diffed,wc=ge.__c,Ec=ge.unmount,Pc=ge.__;function vn(t,e){ge.__h&&ge.__h(ae,t,Dn||e),Dn=0;var n=ae.__H||(ae.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function B(t){return Dn=1,zi(xc,t)}function zi(t,e,n){var i=vn(It++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):xc(void 0,e),function(a){var c=i.__N?i.__N[0]:i.__[0],l=i.t(c,a);c!==l&&(i.__N=[l,i.__[1]],i.__c.setState({}))}],i.__c=ae,!ae.__f)){var r=function(a,c,l){if(!i.__c.__H)return!0;var d=i.__c.__H.__.filter(function(h){return!!h.__c});if(d.every(function(h){return!h.__N}))return!o||o.call(this,a,c,l);var u=i.__c.props!==a;return d.forEach(function(h){if(h.__N){var f=h.__[0];h.__=h.__N,h.__N=void 0,f!==h.__[0]&&(u=!0)}}),o&&o.call(this,a,c,l)||u};ae.__f=!0;var o=ae.shouldComponentUpdate,s=ae.componentWillUpdate;ae.componentWillUpdate=function(a,c,l){if(this.__e){var d=o;o=void 0,r(a,c,l),o=d}s&&s.call(this,a,c,l)},ae.shouldComponentUpdate=r}return i.__N||i.__}function G(t,e){var n=vn(It++,3);!ge.__s&&ko(n.__H,e)&&(n.__=t,n.u=e,ae.__H.__h.push(n))}function ft(t,e){var n=vn(It++,4);!ge.__s&&ko(n.__H,e)&&(n.__=t,n.u=e,ae.__h.push(n))}function j(t){return Dn=5,ce(function(){return{current:t}},[])}function yo(t,e,n){Dn=6,ft(function(){if(typeof t=="function"){var i=t(e());return function(){t(null),i&&typeof i=="function"&&i()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function ce(t,e){var n=vn(It++,7);return ko(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function ie(t,e){return Dn=8,ce(function(){return t},e)}function Gt(t){var e=ae.context[t.__c],n=vn(It++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(ae)),e.props.value):t.__}function bo(t,e){ge.useDebugValue&&ge.useDebugValue(e?e(t):t)}function vp(t){var e=vn(It++,10),n=B();return e.__=t,ae.componentDidCatch||(ae.componentDidCatch=function(i,r){e.__&&e.__(i,r),n[1](i)}),[n[0],function(){n[1](void 0)}]}function _o(){var t=vn(It++,11);if(!t.__){for(var e=ae.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function yp(){for(var t;t=Cc.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Gi),t.__H.__h.forEach(Co),t.__H.__h=[]}catch(e){t.__H.__h=[],ge.__e(e,t.__v)}}ge.__b=function(t){ae=null,kc&&kc(t)},ge.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Pc&&Pc(t,e)},ge.__r=function(t){Sc&&Sc(t),It=0;var e=(ae=t.__c).__H;e&&(vo===ae?(e.__h=[],ae.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(Gi),e.__h.forEach(Co),e.__h=[],It=0)),vo=ae},ge.diffed=function(t){Tc&&Tc(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Cc.push(e)!==1&&_c===ge.requestAnimationFrame||((_c=ge.requestAnimationFrame)||bp)(yp)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),vo=ae=null},ge.__c=function(t,e){e.some(function(n){try{n.__h.forEach(Gi),n.__h=n.__h.filter(function(i){return!i.__||Co(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],ge.__e(i,n.__v)}}),wc&&wc(t,e)},ge.unmount=function(t){Ec&&Ec(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{Gi(i)}catch(r){e=r}}),n.__H=void 0,e&&ge.__e(e,n.__v))};var Rc=typeof requestAnimationFrame=="function";function bp(t){var e,n=function(){clearTimeout(i),Rc&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,100);Rc&&(e=requestAnimationFrame(n))}function Gi(t){var e=ae,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),ae=e}function Co(t){var e=ae;t.__c=t.__(),ae=e}function ko(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function xc(t,e){return typeof e=="function"?e(t):e}var _p=Symbol.for("preact-signals");function Ki(){if(Kt>1)Kt--;else{for(var t,e=!1;mi!==void 0;){var n=mi;for(mi=void 0,So++;n!==void 0;){var i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Oc(n))try{n.c()}catch(r){e||(t=r,e=!0)}n=i}}if(So=0,Kt--,e)throw t}}function Ic(t){if(Kt>0)return t();Kt++;try{return t()}finally{Ki()}}var le=void 0,mi=void 0,Kt=0,So=0,Ji=0;function Ac(t){if(le!==void 0){var e=t.n;if(e===void 0||e.t!==le)return e={i:0,S:t,p:le.s,n:void 0,t:le,e:void 0,x:void 0,r:e},le.s!==void 0&&(le.s.n=e),le.s=e,t.n=e,32&le.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=le.s,e.n=void 0,le.s.n=e,le.s=e),e}}function Ie(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}Ie.prototype.brand=_p,Ie.prototype.h=function(){return!0},Ie.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)},Ie.prototype.U=function(t){if(this.t!==void 0){var e=t.e,n=t.x;e!==void 0&&(e.x=n,t.e=void 0),n!==void 0&&(n.e=e,t.x=void 0),t===this.t&&(this.t=n)}},Ie.prototype.subscribe=function(t){var e=this;return Nn(function(){var n=e.value,i=le;le=void 0;try{t(n)}finally{le=i}})},Ie.prototype.valueOf=function(){return this.value},Ie.prototype.toString=function(){return this.value+""},Ie.prototype.toJSON=function(){return this.value},Ie.prototype.peek=function(){var t=le;le=void 0;try{return this.value}finally{le=t}},Object.defineProperty(Ie.prototype,"value",{get:function(){var t=Ac(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(So>100)throw new Error("Cycle detected");this.v=t,this.i++,Ji++,Kt++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Ki()}}}});function Jt(t){return new Ie(t)}function Oc(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Dc(t){for(var e=t.s;e!==void 0;e=e.n){var n=e.S.n;if(n!==void 0&&(e.r=n),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function Mc(t){for(var e=t.s,n=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):n=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}t.s=n}function Mn(t){Ie.call(this,void 0),this.x=t,this.s=void 0,this.g=Ji-1,this.f=4}(Mn.prototype=new Ie).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Ji))return!0;if(this.g=Ji,this.f|=1,this.i>0&&!Oc(this))return this.f&=-2,!0;var t=le;try{Dc(this),le=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return le=t,Mc(this),this.f&=-2,!0},Mn.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}Ie.prototype.S.call(this,t)},Mn.prototype.U=function(t){if(this.t!==void 0&&(Ie.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Mn.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}},Object.defineProperty(Mn.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=Ac(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Ze(t){return new Mn(t)}function Nc(t){var e=t.u;if(t.u=void 0,typeof e=="function"){Kt++;var n=le;le=void 0;try{e()}catch(i){throw t.f&=-2,t.f|=8,To(t),i}finally{le=n,Ki()}}}function To(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,Nc(t)}function Cp(t){if(le!==this)throw new Error("Out-of-order effect");Mc(this),le=t,this.f&=-2,8&this.f&&To(this),Ki()}function gi(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}gi.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}},gi.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Nc(this),Dc(this),Kt++;var t=le;return le=this,Cp.bind(this,t)},gi.prototype.N=function(){2&this.f||(this.f|=2,this.o=mi,mi=this)},gi.prototype.d=function(){this.f|=8,1&this.f||To(this)};function Nn(t){var e=new gi(t);try{e.c()}catch(n){throw e.d(),n}return e.d.bind(e)}var wo,Yi,Eo,Lc=[],Uc=[];Nn(function(){wo=this.N})();function Ln(t,e){F[t]=e.bind(null,F[t]||function(){})}function Xi(t){Eo&&Eo(),Eo=t&&t.S()}function Fc(t){var e=this,n=t.data,i=At(n);i.value=n;var r=ce(function(){for(var a=e,c=e.__v;c=c.__;)if(c.__c){c.__c.__$f|=4;break}var l=Ze(function(){var f=i.value.value;return f===0?0:f===!0?"":f||""}),d=Ze(function(){return!nc(l.value)}),u=Nn(function(){if(this.N=Bc,d.value){var f=l.value;a.base&&a.base.nodeType===3&&(a.base.data=f)}}),h=e.__$u.d;return e.__$u.d=function(){u(),h.call(this)},[d,l]},[]),o=r[0],s=r[1];return o.value?s.peek():s.value}Fc.displayName="_st",Object.defineProperties(Ie.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Fc},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),Ln("__b",function(t,e){if(typeof e.type=="string"){var n,i=e.props;for(var r in i)if(r!=="children"){var o=i[r];o instanceof Ie&&(n||(e.__np=n={}),n[r]=o,i[r]=o.peek())}}t(e)}),Ln("__r",function(t,e){Xi();var n,i=e.__c;i&&(i.__$f&=-2,(n=i.__$u)===void 0&&(i.__$u=n=function(r){var o;return Nn(function(){o=this}),o.c=function(){i.__$f|=1,i.setState({})},o}())),Yi=i,Xi(n),t(e)}),Ln("__e",function(t,e,n,i){Xi(),Yi=void 0,t(e,n,i)}),Ln("diffed",function(t,e){Xi(),Yi=void 0;var n;if(typeof e.type=="string"&&(n=e.__e)){var i=e.__np,r=e.props;if(i){var o=n.U;if(o)for(var s in o){var a=o[s];a!==void 0&&!(s in i)&&(a.d(),o[s]=void 0)}else o={},n.U=o;for(var c in i){var l=o[c],d=i[c];l===void 0?(l=kp(n,c,d,r),o[c]=l):l.o(d,r)}}}t(e)});function kp(t,e,n,i){var r=e in t&&t.ownerSVGElement===void 0,o=Jt(n);return{o:function(s,a){o.value=s,i=a},d:Nn(function(){this.N=Bc;var s=o.value.value;i[e]!==s&&(i[e]=s,r?t[e]=s:s?t.setAttribute(e,s):t.removeAttribute(e))})}}Ln("unmount",function(t,e){if(typeof e.type=="string"){var n=e.__e;if(n){var i=n.U;if(i){n.U=void 0;for(var r in i){var o=i[r];o&&o.d()}}}}else{var s=e.__c;if(s){var a=s.__$u;a&&(s.__$u=void 0,a.d())}}t(e)}),Ln("__h",function(t,e,n,i){(i<3||i===9)&&(e.__$f|=2),t(e,n,i)}),Qe.prototype.shouldComponentUpdate=function(t,e){var n=this.__$u,i=n&&n.s!==void 0;for(var r in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var o=2&this.__$f;if(!(i||o||4&this.__$f)||1&this.__$f)return!0}else if(!(i||4&this.__$f)||3&this.__$f)return!0;for(var s in t)if(s!=="__source"&&t[s]!==this.props[s])return!0;for(var a in this.props)if(!(a in t))return!0;return!1};function At(t){return ce(function(){return Jt(t)},[])}function We(t){var e=j(t);return e.current=t,Yi.__$f|=4,ce(function(){return Ze(function(){return e.current()})},[])}var Sp=typeof requestAnimationFrame>"u"?setTimeout:requestAnimationFrame,Tp=function(t){queueMicrotask(function(){queueMicrotask(t)})};function wp(){Ic(function(){for(var t;t=Lc.shift();)wo.call(t)})}function Ep(){Lc.push(this)===1&&(F.requestAnimationFrame||Sp)(wp)}function Pp(){Ic(function(){for(var t;t=Uc.shift();)wo.call(t)})}function Bc(){Uc.push(this)===1&&(F.requestAnimationFrame||Tp)(Pp)}function yn(t){var e=j(t);e.current=t,G(function(){return Nn(function(){return this.N=Ep,e.current()})},[])}function jc(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=jc(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function pt(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=jc(t))&&(i&&(i+=" "),i+=e);return i}function Vc(t,e){for(var n in e)t[n]=e[n];return t}function Po(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var i in e)if(i!=="__source"&&t[i]!==e[i])return!0;return!1}function Ro(t,e){var n=e(),i=B({t:{__:n,u:e}}),r=i[0].t,o=i[1];return ft(function(){r.__=n,r.u=e,xo(r)&&o({t:r})},[t,n,e]),G(function(){return xo(r)&&o({t:r}),t(function(){xo(r)&&o({t:r})})},[t]),n}function xo(t){var e,n,i=t.u,r=t.__;try{var o=i();return!((e=r)===(n=o)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Io(t){t()}function Ao(t){return t}function Oo(){return[!1,Io]}var Do=ft;function Qi(t,e){this.props=t,this.context=e}function Zi(t,e){function n(r){var o=this.props.ref,s=o==r.ref;return!s&&o&&(o.call?o(null):o.current=null),e?!e(this.props,r)||!s:Po(this.props,r)}function i(r){return this.shouldComponentUpdate=n,pe(t,r)}return i.displayName="Memo("+(t.displayName||t.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(Qi.prototype=new Qe).isPureReactComponent=!0,Qi.prototype.shouldComponentUpdate=function(t,e){return Po(this.props,t)||Po(this.state,e)};var qc=F.__b;F.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),qc&&qc(t)};var Rp=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Y(t){function e(n){var i=Vc({},n);return delete i.ref,t(i,n.ref||null)}return e.$$typeof=Rp,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var $c=function(t,e){return t==null?null:xt(xt(t).map(e))},Yt={map:$c,forEach:$c,count:function(t){return t?xt(t).length:0},only:function(t){var e=xt(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:xt},xp=F.__e;F.__e=function(t,e,n,i){if(t.then){for(var r,o=e;o=o.__;)if((r=o.__c)&&r.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),r.__c(t,e)}xp(t,e,n,i)};var Wc=F.unmount;function Hc(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),t.__c.__H=null),(t=Vc({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(i){return Hc(i,e,n)})),t}function zc(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(i){return zc(i,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function vi(){this.__u=0,this.o=null,this.__b=null}function Gc(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Kc(t){var e,n,i;function r(o){if(e||(e=t()).then(function(s){n=s.default||s},function(s){i=s}),i)throw i;if(!n)throw e;return pe(n,o)}return r.displayName="Lazy",r.__f=!0,r}function Un(){this.i=null,this.l=null}F.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),Wc&&Wc(t)},(vi.prototype=new Qe).__c=function(t,e){var n=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(n);var r=Gc(i.__v),o=!1,s=function(){o||(o=!0,n.__R=null,r?r(a):a())};n.__R=s;var a=function(){if(!--i.__u){if(i.state.__a){var c=i.state.__a;i.__v.__k[0]=zc(c,c.__c.__P,c.__c.__O)}var l;for(i.setState({__a:i.__b=null});l=i.o.pop();)l.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),t.then(s,s)},vi.prototype.componentWillUnmount=function(){this.o=[]},vi.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=Hc(this.__b,n,i.__O=i.__P)}this.__b=null}var r=e.__a&&pe(Ee,null,t.fallback);return r&&(r.__u&=-33),[pe(Ee,null,e.__a?null:t.children),r]};var Jc=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function Ip(t){return this.getChildContext=function(){return t.context},t.children}function Ap(t){var e=this,n=t.h;e.componentWillUnmount=function(){zt(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),e.v||(e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],contains:function(){return!0},appendChild:function(i){this.childNodes.push(i),e.h.appendChild(i)},insertBefore:function(i,r){this.childNodes.push(i),e.h.insertBefore(i,r)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e.h.removeChild(i)}}),zt(pe(Ip,{context:e.context},t.__v),e.v)}function er(t,e){var n=pe(Ap,{__v:t,h:e});return n.containerInfo=e,n}(Un.prototype=new Qe).__a=function(t){var e=this,n=Gc(e.__v),i=e.l.get(t);return i[0]++,function(r){var o=function(){e.props.revealOrder?(i.push(r),Jc(e,t,i)):r()};n?n(o):o()}},Un.prototype.render=function(t){this.i=null,this.l=new Map;var e=xt(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Un.prototype.componentDidUpdate=Un.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){Jc(t,n,e)})};var Yc=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Op=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Dp=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Mp=/[A-Z0-9]/g,Np=typeof document<"u",Lp=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function Xc(t,e,n){return e.__k==null&&(e.textContent=""),zt(t,e),typeof n=="function"&&n(),t?t.__c:null}function Qc(t,e,n){return po(t,e),typeof n=="function"&&n(),t?t.__c:null}Qe.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Qe.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Zc=F.event;function Up(){}function Fp(){return this.cancelBubble}function Bp(){return this.defaultPrevented}F.event=function(t){return Zc&&(t=Zc(t)),t.persist=Up,t.isPropagationStopped=Fp,t.isDefaultPrevented=Bp,t.nativeEvent=t};var Mo,jp={enumerable:!1,configurable:!0,get:function(){return this.class}},el=F.vnode;F.vnode=function(t){typeof t.type=="string"&&function(e){var n=e.props,i=e.type,r={},o=i.indexOf("-")===-1;for(var s in n){var a=n[s];if(!(s==="value"&&"defaultValue"in n&&a==null||Np&&s==="children"&&i==="noscript"||s==="class"||s==="className")){var c=s.toLowerCase();s==="defaultValue"&&"value"in n&&n.value==null?s="value":s==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?s="ondblclick":c!=="onchange"||i!=="input"&&i!=="textarea"||Lp(n.type)?c==="onfocus"?s="onfocusin":c==="onblur"?s="onfocusout":Dp.test(s)&&(s=c):c=s="oninput":o&&Op.test(s)?s=s.replace(Mp,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&r[s=c]&&(s="oninputCapture"),r[s]=a}}i=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=xt(n.children).forEach(function(l){l.props.selected=r.value.indexOf(l.props.value)!=-1})),i=="select"&&r.defaultValue!=null&&(r.value=xt(n.children).forEach(function(l){l.props.selected=r.multiple?r.defaultValue.indexOf(l.props.value)!=-1:r.defaultValue==l.props.value})),n.class&&!n.className?(r.class=n.class,Object.defineProperty(r,"className",jp)):(n.className&&!n.class||n.class&&n.className)&&(r.class=r.className=n.className),e.props=r}(t),t.$$typeof=Yc,el&&el(t)};var tl=F.__r;F.__r=function(t){tl&&tl(t),Mo=t.__c};var nl=F.diffed;F.diffed=function(t){nl&&nl(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),Mo=null};var il={ReactCurrentDispatcher:{current:{readContext:function(t){return Mo.__n[t.__c].props.value},useCallback:ie,useContext:Gt,useDebugValue:bo,useDeferredValue:Ao,useEffect:G,useId:_o,useImperativeHandle:yo,useInsertionEffect:Do,useLayoutEffect:ft,useMemo:ce,useReducer:zi,useRef:j,useState:B,useSyncExternalStore:Ro,useTransition:Oo}}},Vp="18.3.1";function rl(t){return pe.bind(null,t)}function Ot(t){return!!t&&t.$$typeof===Yc}function ol(t){return Ot(t)&&t.type===Ee}function sl(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function yi(t){return Ot(t)?mo.apply(null,arguments):t}function al(t){return!!t.__k&&(zt(null,t),!0)}function cl(t){return t&&(t.base||t.nodeType===1&&t)||null}var ll=function(t,e){return t(e)},tr=function(t,e){return t(e)},dl=Ee,ul=Ot,Dt={useState:B,useId:_o,useReducer:zi,useEffect:G,useLayoutEffect:ft,useInsertionEffect:Do,useTransition:Oo,useDeferredValue:Ao,useSyncExternalStore:Ro,startTransition:Io,useRef:j,useImperativeHandle:yo,useMemo:ce,useCallback:ie,useContext:Gt,useDebugValue:bo,version:"18.3.1",Children:Yt,render:Xc,hydrate:Qc,unmountComponentAtNode:al,createPortal:er,createElement:pe,createContext:Ne,createFactory:rl,cloneElement:yi,createRef:lc,Fragment:Ee,isValidElement:Ot,isElement:ul,isFragment:ol,isMemo:sl,findDOMNode:cl,Component:Qe,PureComponent:Qi,memo:Zi,forwardRef:Y,flushSync:tr,unstable_batchedUpdates:ll,StrictMode:dl,Suspense:vi,SuspenseList:Un,lazy:Kc,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:il};const hl=Object.freeze(Object.defineProperty({__proto__:null,Children:Yt,Component:Qe,Fragment:Ee,PureComponent:Qi,StrictMode:dl,Suspense:vi,SuspenseList:Un,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:il,cloneElement:yi,createContext:Ne,createElement:pe,createFactory:rl,createPortal:er,createRef:lc,default:Dt,findDOMNode:cl,flushSync:tr,forwardRef:Y,hydrate:Qc,isElement:ul,isFragment:ol,isMemo:sl,isValidElement:Ot,lazy:Kc,memo:Zi,render:Xc,startTransition:Io,unmountComponentAtNode:al,unstable_batchedUpdates:ll,useCallback:ie,useContext:Gt,useDebugValue:bo,useDeferredValue:Ao,useEffect:G,useErrorBoundary:vp,useId:_o,useImperativeHandle:yo,useInsertionEffect:Do,useLayoutEffect:ft,useMemo:ce,useReducer:zi,useRef:j,useState:B,useSyncExternalStore:Ro,useTransition:Oo,version:Vp},Symbol.toStringTag,{value:"Module"}));var nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qp=typeof nr=="object"&&nr&&nr.Object===Object&&nr,$p=typeof self=="object"&&self&&self.Object===Object&&self;qp||$p||Function("return this")();var Wp=typeof window<"u"?ft:G,Hp=typeof window>"u";function zp(t,{defaultValue:e=!1,initializeWithValue:n=!0}={}){const i=a=>Hp?e:window.matchMedia(a).matches,[r,o]=B(()=>n?i(t):e);function s(){o(i(t))}return Wp(()=>{const a=window.matchMedia(t);return s(),a.addListener?a.addListener(s):a.addEventListener("change",s),()=>{a.removeListener?a.removeListener(s):a.removeEventListener("change",s)}},[t]),r}const fl=["full","compact"],Gp=["expandable"];function Kp(t){return Gp.includes(t)?(console.warn(`[ConversationalAI] The variant "${t}" is deprecated. Please use "full" or "compact" instead and choose how the widget should expand.`),"full"):fl.includes(t)?t:fl[0]}const pl=["never","mobile","desktop","always"];function Jp(t,e){return e==="expandable"?"always":pl.includes(t)?t:pl[0]}function Yp(t){return t.replace(/_/g,"-")}const Xp=["variant","expandable","override-config","avatar-image-url","avatar-orb-color-1","avatar-orb-color-2","agent-id","signed-url","terms-key","server-location","language","dynamic-variables","show-avatar-when-collapsed","override-prompt","override-first-message","override-language","override-voice-id"],ml={start_call_text:"Start a call",end_call_text:"End",action_text:"Need help?",expand_text:"Chat with AI",listening_text:"Listening",speaking_text:"Talk to interrupt"},gl=Object.keys(ml),vl=gl.map(Yp),No=[...Xp,...vl];function mt(t){const e=Gt(t);if(e==null)throw new Error(`${t.displayName} cannot be used outside of provider`);return e}const yl=Ne(null);function Qp({value:t,children:e}){const n=ce(()=>Object.fromEntries(No.map(i=>[i,Jt(t[i])])),[]);return No.forEach(i=>{n[i].value=t[i]}),S(yl.Provider,{value:n,children:e})}function bl(){return mt(yl)}function Ae(t){return bl()[t]}const Zp="https://api.elevenlabs.io",em="https://api.us.elevenlabs.io",tm="wss://api.elevenlabs.io",nm="wss://api.us.elevenlabs.io",_l=Ne(null);function im({children:t}){const e=Ae("server-location"),n=ce(()=>{const i=Ze(()=>rm(e.value));return{location:i,serverUrl:Ze(()=>i.value==="us"?em:Zp),webSocketUrl:Ze(()=>i.value==="us"?nm:tm)}},[]);return S(_l.Provider,{value:n,children:t})}function Lo(){return mt(_l)}function rm(t="us"){switch(t){case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}const Cl=Ne(null);function om({children:t}){const{serverUrl:e}=Lo(),n=Ae("agent-id"),i=Ae("override-config"),r=At(null);yn(()=>{if(i.value)try{const d=JSON.parse(i.value);if(d){r.value=d;return}}catch(d){console.error(`[ConversationalAI] Cannot parse override-config: ${d==null?void 0:d.message}`)}if(!n.value){r.value=null;return}const l=new AbortController;return sm(n.value,e.value,l.signal).then(d=>{l.signal.aborted||(r.value=d)}).catch(d=>{console.error(`[ConversationalAI] Cannot fetch config for agent ${n.value}: ${d==null?void 0:d.message}`),l.signal.aborted||(r.value=null)}),()=>{l.abort()}});const o=Ae("variant"),s=Ae("expandable"),a=Ae("terms-key"),c=We(()=>{if(!r.value)return null;const l=o.value??r.value.variant,d=s.value??r.value.expandable;return{...r.value,variant:Kp(l),expandable:Jp(d,l),termsKey:a.value??r.value.terms_key}});return c.value?S(Cl.Provider,{value:c,children:t}):null}function bn(){return mt(Cl)}async function sm(t,e,n){const r=await(await fetch(`${e}/v1/convai/agents/${t}/widget`,{signal:n})).json();if(!r.widget_config)throw new Error("Response does not contain widget_config");return r.widget_config}const kl=Ne(null);function am({children:t}){const e=bn(),n=Ae("avatar-image-url"),i=Ae("avatar-orb-color-1"),r=Ae("avatar-orb-color-2"),o=We(()=>n.value?{type:"image",url:n.value}:i.value&&r.value?{type:"orb",color_1:i.value,color_2:r.value}:e.value.avatar);return S(kl.Provider,{value:o,children:t})}function cm(){return mt(kl)}function lm(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var dm=Object.defineProperty,um=(t,e,n)=>e in t?dm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sl=(t,e,n)=>um(t,typeof e!="symbol"?e+"":e,n);let Ue=class{constructor(){Sl(this,"_locking"),Sl(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function ve(t,e){if(!t)throw new Error(e)}const hm=34028234663852886e22,fm=-34028234663852886e22,pm=4294967295,mm=2147483647,gm=-2147483648;function ir(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>mm||t<gm)throw new Error("invalid int 32: "+t)}function Uo(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>pm||t<0)throw new Error("invalid uint 32: "+t)}function Tl(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>hm||t<fm))throw new Error("invalid float 32: "+t)}const wl=Symbol("@bufbuild/protobuf/enum-type");function vm(t){const e=t[wl];return ve(e,"missing enum type on enum object"),e}function El(t,e,n,i){t[wl]=Pl(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function Pl(t,e,n){const i=Object.create(null),r=Object.create(null),o=[];for(const s of e){const a=Rl(s);o.push(a),i[s.name]=a,r[s.no]=a}return{typeName:t,values:o,findName(s){return i[s]},findNumber(s){return r[s]}}}function ym(t,e,n){const i={};for(const r of e){const o=Rl(r);i[o.localName]=o.no,i[o.no]=o.localName}return El(i,t,e),i}function Rl(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Fo{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(n);return r.readMessage(i,e,o,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function bm(t,e,n,i){var r;const o=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),s={[o]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[o];return Object.setPrototypeOf(s.prototype,new Fo),Object.assign(s,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new s().fromBinary(a,c)},fromJson(a,c){return new s().fromJson(a,c)},fromJsonString(a,c){return new s().fromJsonString(a,c)},equals(a,c){return t.util.equals(s,a,c)}}),s}function _m(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Bo(t,e,n){for(let o=0;o<28;o=o+7){const s=t>>>o,a=!(!(s>>>7)&&e==0),c=(a?s|128:s)&255;if(n.push(c),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const s=e>>>o,a=!!(s>>>7),c=(a?s|128:s)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const rr=4294967296;function xl(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function o(s,a){const c=Number(t.slice(s,a));r*=n,i=i*n+c,i>=rr&&(r=r+(i/rr|0),i=i%rr)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?Al(i,r):jo(i,r)}function Cm(t,e){let n=jo(t,e);const i=n.hi&2147483648;i&&(n=Al(n.lo,n.hi));const r=Il(n.lo,n.hi);return i?"-"+r:r}function Il(t,e){if({lo:t,hi:e}=km(t,e),e<=2097151)return String(rr*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+i*6777216+r*6710656,s=i+r*8147497,a=r*2;const c=1e7;return o>=c&&(s+=Math.floor(o/c),o%=c),s>=c&&(a+=Math.floor(s/c),s%=c),a.toString()+Ol(s)+Ol(o)}function km(t,e){return{lo:t>>>0,hi:e>>>0}}function jo(t,e){return{lo:t|0,hi:e|0}}function Al(t,e){return e=~e,t?t=~t+1:e+=1,jo(t,e)}const Ol=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Dl(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Sm(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Tm(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||process.env.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),s=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>o||l<r)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<s)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=r=>ve(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>ve(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),xl(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),xl(r)},dec(r,o){return Cm(r,o)},uDec(r,o){return Il(r,o)}}}const me=Tm();var R;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(R||(R={}));var Xt;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Xt||(Xt={}));function Qt(t,e,n){if(e===n)return!0;if(t==R.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return e==n}return!1}function Fn(t,e){switch(t){case R.BOOL:return!1;case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return e==0?me.zero:"0";case R.DOUBLE:case R.FLOAT:return 0;case R.BYTES:return new Uint8Array(0);case R.STRING:return"";default:return 0}}function Ml(t,e){switch(t){case R.BOOL:return e===!1;case R.STRING:return e==="";case R.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var _e;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(_e||(_e={}));class wm{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Uo(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ir(e),Dl(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){Tl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Uo(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){ir(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return ir(e),e=(e<<1^e>>31)>>>0,Dl(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=me.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=me.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=me.enc(e);return Bo(n.lo,n.hi,this.buf),this}sint64(e){let n=me.enc(e),i=n.hi>>31,r=n.lo<<1^i,o=(n.hi<<1|n.lo>>>31)^i;return Bo(r,o,this.buf),this}uint64(e){let n=me.uEnc(e);return Bo(n.lo,n.hi,this.buf),this}}class Em{constructor(e,n){this.varint64=_m,this.uint32=Sm,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case _e.Varint:for(;this.buf[this.pos++]&128;);break;case _e.Bit64:this.pos+=4;case _e.Bit32:this.pos+=4;break;case _e.LengthDelimited:let r=this.uint32();this.pos+=r;break;case _e.StartGroup:for(;;){const[o,s]=this.tag();if(s===_e.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(s,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return me.dec(...this.varint64())}uint64(){return me.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,me.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return me.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return me.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Pm(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function Nl(t){const e=t.field.localName,n=Object.create(null);return n[e]=Rm(t),[n,()=>n[e]]}function Rm(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Fn(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function xm(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),or=[];for(let t=0;t<Mt.length;t++)or[Mt[t].charCodeAt(0)]=t;or[45]=Mt.indexOf("+"),or[95]=Mt.indexOf("/");const Ll={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,o,s=0;for(let a=0;a<t.length;a++){if(o=or[t.charCodeAt(a)],o===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:s=o,r=1;break;case 1:n[i++]=s<<2|(o&48)>>4,s=o,r=2;break;case 2:n[i++]=(s&15)<<4|(o&60)>>2,s=o,r=3;break;case 3:n[i++]=(s&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let o=0;o<t.length;o++)switch(i=t[o],n){case 0:e+=Mt[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Mt[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Mt[r|i>>6],e+=Mt[i&63],n=0;break}return n&&(e+=Mt[r],e+="=",n==1&&(e+="=")),e}};function Im(t,e,n){Fl(e,t);const i=e.runtime.bin.makeReadOptions(n),r=xm(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,s]=Nl(e);for(const a of r)e.runtime.bin.readField(o,i.readerFactory(a.data),e.field,a.wireType,i);return s()}function Am(t,e,n,i){Fl(e,t);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(Ul(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of l)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const s=o.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,s,o);const c=r.readerFactory(s.finish());for(;c.pos<c.len;){const[l,d]=c.tag(),u=c.skip(d,l);t.getType().runtime.bin.onUnknownField(t,l,d,u)}}function Ul(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function Fl(t,e){ve(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function Bl(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!Ml(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function jl(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Fn(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Nt(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Fo.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function Vl(t,e){return Nt(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}R.DOUBLE,R.FLOAT,R.INT64,R.UINT64,R.INT32,R.UINT32,R.BOOL,R.STRING,R.BYTES;const ql={ignoreUnknownFields:!1},$l={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Om(t){return t?Object.assign(Object.assign({},ql),t):ql}function Dm(t){return t?Object.assign(Object.assign({},$l),t):$l}const sr=Symbol(),ar=Symbol();function Mm(){return{makeReadOptions:Om,makeWriteOptions:Dm,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(gt(e)));i=i??new t;const r=new Map,o=n.typeRegistry;for(const[s,a]of Object.entries(e)){const c=t.fields.findJsonName(s);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=r.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(s,'"'));r.set(c.oneof,s)}Wl(i,a,c,n,t)}else{let l=!1;if(o!=null&&o.findExtension&&s.startsWith("[")&&s.endsWith("]")){const d=o.findExtension(s.substring(1,s.length-1));if(d&&d.extendee.typeName==t.typeName){l=!0;const[u,h]=Nl(d);Wl(u,a,d.field,n,d),Am(i,d,h(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(s,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Bl(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Lm(r))continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Hl(r,s,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const o=e.typeRegistry;if(o!=null&&o.findExtensionFor)for(const s of n.runtime.bin.listUnknownFields(t)){const a=o.findExtensionFor(n.typeName,s.no);if(a&&Ul(t,a)){const c=Im(t,a,e),l=Hl(a.field,c,e);l!==void 0&&(i[a.field.jsonName]=l)}}}catch(o){const s=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=o instanceof Error?o.message:String(o);throw new Error(s+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return bi(t,e,n??Xt.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||Ml(t,e)))return cr(t,e)},debug:gt}}function gt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Wl(t,e,n,i,r){let o=n.localName;if(n.repeated){if(ve(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(e)));const s=t[o];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(a)));switch(n.kind){case"message":s.push(n.T.fromJson(a,i));break;case"enum":const c=Vo(n.T,a,i.ignoreUnknownFields,!0);c!==ar&&s.push(c);break;case"scalar":try{s.push(bi(n.T,a,n.L,!0))}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(a));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(e)));const s=t[o];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=Nm(n.K,a)}catch(d){let u="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(e));throw d instanceof Error&&d.message.length>0&&(u+=": ".concat(d.message)),new Error(u)}switch(n.V.kind){case"message":s[l]=n.V.T.fromJson(c,i);break;case"enum":const d=Vo(n.V.T,c,i.ignoreUnknownFields,!0);d!==ar&&(s[l]=d);break;case"scalar":try{s[l]=bi(n.V.T,c,Xt.BIGINT,!0)}catch(u){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(e));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const s=n.T;if(e===null&&s.typeName!="google.protobuf.Value")return;let a=t[o];Nt(a)?a.fromJson(e,i):(t[o]=a=s.fromJson(e,i),s.fieldWrapper&&!n.oneof&&(t[o]=s.fieldWrapper.unwrapField(a)));break;case"enum":const c=Vo(n.T,e,i.ignoreUnknownFields,!1);switch(c){case sr:jl(n,t);break;case ar:break;default:t[o]=c;break}break;case"scalar":try{const l=bi(n.T,e,n.L,!1);switch(l){case sr:jl(n,t);break;default:t[o]=l;break}}catch(l){let d="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gt(e));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}function Nm(t,e){if(t===R.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return bi(t,e,Xt.BIGINT,!0).toString()}function bi(t,e,n,i){if(e===null)return i?Fn(t,n):sr;switch(t){case R.DOUBLE:case R.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==R.FLOAT&&Tl(r),r;case R.INT32:case R.FIXED32:case R.SFIXED32:case R.SINT32:case R.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==R.UINT32||t==R.FIXED32?Uo(o):ir(o),o;case R.INT64:case R.SFIXED64:case R.SINT64:if(typeof e!="number"&&typeof e!="string")break;const s=me.parse(e);return n?s.toString():s;case R.FIXED64:case R.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=me.uParse(e);return n?a.toString():a;case R.BOOL:if(typeof e!="boolean")break;return e;case R.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case R.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Ll.dec(e)}throw new Error}function Vo(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:sr;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return ar;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(gt(e)))}function Lm(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Hl(t,e,n){if(t.kind=="map"){ve(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[s,a]of r)i[s.toString()]=cr(t.V.T,a);break;case"message":for(const[s,a]of r)i[s.toString()]=a.toJson(n);break;case"enum":const o=t.V.T;for(const[s,a]of r)i[s.toString()]=qo(o,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){ve(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(cr(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(qo(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return cr(t.T,e);case"enum":return qo(t.T,e,n.enumAsInteger);case"message":return Vl(t.T,e).toJson(n)}}function qo(t,e,n){var i;if(ve(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function cr(t,e){switch(t){case R.INT32:case R.SFIXED32:case R.SINT32:case R.FIXED32:case R.UINT32:return ve(typeof e=="number"),e;case R.FLOAT:case R.DOUBLE:return ve(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case R.STRING:return ve(typeof e=="string"),e;case R.BOOL:return ve(typeof e=="boolean"),e;case R.UINT64:case R.FIXED64:case R.INT64:case R.SFIXED64:case R.SINT64:return ve(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case R.BYTES:return ve(e instanceof Uint8Array),Ll.enc(e)}}const Bn=Symbol("@bufbuild/protobuf/unknown-fields"),zl={readUnknownFields:!0,readerFactory:t=>new Em(t)},Gl={writeUnknownFields:!0,writerFactory:()=>new wm};function Um(t){return t?Object.assign(Object.assign({},zl),t):zl}function Fm(t){return t?Object.assign(Object.assign({},Gl),t):Gl}function Bm(){return{makeReadOptions:Um,makeWriteOptions:Fm,listUnknownFields(t){var e;return(e=t[Bn])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Bn]},writeUnknownFields(t,e){const i=t[Bn];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Bn])||(r[Bn]=[]),r[Bn].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const o=t.getType(),s=r?e.len:e.pos+n;let a,c;for(;e.pos<s&&([a,c]=e.tag(),!(r===!0&&c==_e.EndGroup));){const l=o.fields.find(a);if(!l){const d=e.skip(c,a);i.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}Kl(t,e,l,c,i)}if(r&&(c!=_e.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Kl,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!Bl(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];Jl(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Jl(t,e,n,i)}}}function Kl(t,e,n,i,r){let{repeated:o,localName:s}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=s&&delete t.value,t.case=s,s="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?R.INT32:n.T;let c=dr;if(n.kind=="scalar"&&n.L>0&&(c=Vm),o){let h=t[s];if(i==_e.LengthDelimited&&a!=R.STRING&&a!=R.BYTES){let m=e.uint32()+e.pos;for(;e.pos<m;)h.push(c(e,a))}else h.push(c(e,a))}else t[s]=c(e,a);break;case"message":const l=n.T;o?t[s].push(lr(e,new l,r,n)):Nt(t[s])?lr(e,t[s],r,n):(t[s]=lr(e,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[s]=l.fieldWrapper.unwrapField(t[s])));break;case"map":let[d,u]=jm(n,e,r);t[s][d]=u;break}}function lr(t,e,n,i){const r=e.getType().runtime.bin,o=i==null?void 0:i.delimited;return r.readMessage(e,t,o?i.no:t.uint32(),n,o),e}function jm(t,e,n){const i=e.uint32(),r=e.pos+i;let o,s;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:o=dr(e,t.K);break;case 2:switch(t.V.kind){case"scalar":s=dr(e,t.V.T);break;case"enum":s=e.int32();break;case"message":s=lr(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=Fn(t.K,Xt.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),s===void 0)switch(t.V.kind){case"scalar":s=Fn(t.V.T,Xt.BIGINT);break;case"enum":s=t.V.T.values[0].no;break;case"message":s=new t.V.T;break}return[o,s]}function Vm(t,e){const n=dr(t,e);return typeof n=="bigint"?n.toString():n}function dr(t,e){switch(e){case R.STRING:return t.string();case R.BOOL:return t.bool();case R.DOUBLE:return t.double();case R.FLOAT:return t.float();case R.INT32:return t.int32();case R.INT64:return t.int64();case R.UINT64:return t.uint64();case R.FIXED64:return t.fixed64();case R.BYTES:return t.bytes();case R.FIXED32:return t.fixed32();case R.SFIXED32:return t.sfixed32();case R.SFIXED64:return t.sfixed64();case R.SINT64:return t.sint64();case R.UINT32:return t.uint32();case R.SINT32:return t.sint32()}}function Jl(t,e,n,i){ve(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?R.INT32:t.T;if(r)if(ve(Array.isArray(e)),t.packed)$m(n,o,t.no,e);else for(const s of e)_i(n,o,t.no,s);else _i(n,o,t.no,e);break;case"message":if(r){ve(Array.isArray(e));for(const s of e)Yl(n,i,t,s)}else Yl(n,i,t,e);break;case"map":ve(typeof e=="object"&&e!=null);for(const[s,a]of Object.entries(e))qm(n,i,t,s,a);break}}function qm(t,e,n,i,r){t.tag(n.no,_e.LengthDelimited),t.fork();let o=i;switch(n.K){case R.INT32:case R.FIXED32:case R.UINT32:case R.SFIXED32:case R.SINT32:o=Number.parseInt(i);break;case R.BOOL:ve(i=="true"||i=="false"),o=i=="true";break}switch(_i(t,n.K,1,o),n.V.kind){case"scalar":_i(t,n.V.T,2,r);break;case"enum":_i(t,R.INT32,2,r);break;case"message":ve(r!==void 0),t.tag(2,_e.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Yl(t,e,n,i){const r=Vl(n.T,i);n.delimited?t.tag(n.no,_e.StartGroup).raw(r.toBinary(e)).tag(n.no,_e.EndGroup):t.tag(n.no,_e.LengthDelimited).bytes(r.toBinary(e))}function _i(t,e,n,i){ve(i!==void 0);let[r,o]=Xl(e);t.tag(n,r)[o](i)}function $m(t,e,n,i){if(!i.length)return;t.tag(n,_e.LengthDelimited).fork();let[,r]=Xl(e);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}function Xl(t){let e=_e.Varint;switch(t){case R.BYTES:case R.STRING:e=_e.LengthDelimited;break;case R.DOUBLE:case R.FIXED64:case R.SFIXED64:e=_e.Bit64;break;case R.FIXED32:case R.SFIXED32:case R.FLOAT:e=_e.Bit32;break}const n=R[t].toLowerCase();return[e,n]}function Wm(){return{setEnumType:El,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,o=e,s=t;if(s[r]!=null)switch(i.kind){case"oneof":const a=s[r].case;if(a===void 0)continue;const c=i.findField(a);let l=s[r].value;c&&c.kind=="message"&&!Nt(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===R.BYTES&&(l=Ci(l)),o[r]={case:a,value:l};break;case"scalar":case"enum":let d=s[r];i.T===R.BYTES&&(d=i.repeated?d.map(Ci):Ci(d)),o[r]=d;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===R.BYTES)for(const[f,m]of Object.entries(s[r]))o[r][f]=Ci(m);else Object.assign(o[r],s[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(s[r])){let m=s[r][f];h.fieldWrapper||(m=new h(m)),o[r][f]=m}break}break;case"message":const u=i.T;if(i.repeated)o[r]=s[r].map(h=>Nt(h,u)?h:new u(h));else{const h=s[r];u.fieldWrapper?u.typeName==="google.protobuf.BytesValue"?o[r]=Ci(h):o[r]=h:o[r]=Nt(h,u)?h:new u(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],o=n[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((s,a)=>i.T.equals(s,o[a]));case"scalar":return r.every((s,a)=>Qt(i.T,s,o[a]));case"enum":return r.every((s,a)=>Qt(R.INT32,s,o[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let s=r,a=o;return i.T.fieldWrapper&&(s!==void 0&&!Nt(s)&&(s=i.T.fieldWrapper.wrapField(s)),a!==void 0&&!Nt(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(s,a);case"enum":return Qt(R.INT32,r,o);case"scalar":return Qt(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const c=i.findField(r.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(r.value,o.value);case"enum":return Qt(R.INT32,r.value,o.value);case"scalar":return Qt(c.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const d=i.V.T;return l.every(h=>d.equals(r[h],o[h]));case"enum":return l.every(h=>Qt(R.INT32,r[h],o[h]));case"scalar":const u=i.V.T;return l.every(h=>Qt(u,r[h],o[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const o=t[r.localName];let s;if(r.repeated)s=o.map(ur);else if(r.kind=="map"){s=i[r.localName];for(const[a,c]of Object.entries(o))s[a]=ur(c)}else r.kind=="oneof"?s=r.findField(o.case)?{case:o.case,value:ur(o.value)}:{case:void 0}:s=ur(o);i[r.localName]=s}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function ur(t){if(t===void 0)return t;if(Nt(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Ci(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Hm(t,e,n){return{syntax:t,json:Mm(),bin:Bm(),util:Object.assign(Object.assign({},Wm()),{newFieldList:e,initFields:n}),makeMessageType(i,r,o){return bm(this,i,r,o)},makeEnum:ym,makeEnumType:Pl,getEnumType:vm,makeExtension(i,r,o){return Pm(this,i,r,o)}}}class zm{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function Ql(t,e){const n=Zl(t);return e?n:Qm(Xm(n))}function Gm(t){return Ql(t,!1)}const Km=Zl;function Zl(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const Jm=new Set(["constructor","toString","toJSON","valueOf"]),Ym=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),ed=t=>"".concat(t,"$"),Xm=t=>Ym.has(t)?ed(t):t,Qm=t=>Jm.has(t)?ed(t):t;class Zm{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Gm(e)}addField(e){ve(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function eg(t,e){var n,i,r,o,s,a;const c=[];let l;for(const d of typeof t=="function"?t():t){const u=d;if(u.localName=Ql(d.name,d.oneof!==void 0),u.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:Km(d.name),u.repeated=(i=d.repeated)!==null&&i!==void 0?i:!1,d.kind=="scalar"&&(u.L=(r=d.L)!==null&&r!==void 0?r:Xt.BIGINT),u.delimited=(o=d.delimited)!==null&&o!==void 0?o:!1,u.req=(s=d.req)!==null&&s!==void 0?s:!1,u.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(u.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=R.BYTES&&d.T!=R.STRING),d.oneof!==void 0){const h=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!l||l.name!=h)&&(l=new Zm(h)),u.oneof=l,l.addField(u)}c.push(u)}return c}const w=Hm("proto3",t=>new zm(t,e=>eg(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Fn(e.T,e.L);break}}});class Be extends Fo{constructor(e){super(),this.seconds=me.zero,this.nanos=0,w.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(w.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=me.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Be.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Be({seconds:me.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Be().fromBinary(e,n)}static fromJson(e,n){return new Be().fromJson(e,n)}static fromJsonString(e,n){return new Be().fromJsonString(e,n)}static equals(e,n){return w.util.equals(Be,e,n)}}Be.runtime=w,Be.typeName="google.protobuf.Timestamp",Be.fields=w.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const tg=w.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Be},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:ng,repeated:!0},{no:5,name:"events",kind:"message",T:rg,repeated:!0}]),ng=w.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:ig,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),ig=w.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Be},{no:3,name:"value",kind:"scalar",T:2}]),rg=w.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Be},{no:7,name:"normalized_end_timestamp",kind:"message",T:Be,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),td=w.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),tt=w.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ke=w.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),$o=w.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),ki=w.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Si=w.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),nt=w.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),jn=w.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),og=w.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Re=w.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),hr=w.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:fr,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:md}]),fr=w.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),sg=w.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:w.getEnumType(ke),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),_n=w.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(Vn)},{no:4,name:"tracks",kind:"message",T:qn,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:sg},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:w.getEnumType(Ti)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:w.getEnumType(nt)},{no:18,name:"kind_details",kind:"enum",T:w.getEnumType(ag),repeated:!0}]),Vn=w.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ti=w.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ag=w.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),He=w.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),cg=w.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Cn,repeated:!0}]),qn=w.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:w.getEnumType(tt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:w.getEnumType(ke)},{no:10,name:"layers",kind:"message",T:Cn,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:cg,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:w.getEnumType(He)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:md},{no:19,name:"audio_features",kind:"enum",T:w.getEnumType(Re),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(td)}]),Cn=w.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType($o)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),je=w.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:w.getEnumType(K)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:id,oneof:"value"},{no:3,name:"speaker",kind:"message",T:lg,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:rd,oneof:"value"},{no:7,name:"transcription",kind:"message",T:dg,oneof:"value"},{no:8,name:"metrics",kind:"message",T:tg,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Wo,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:od,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:sd,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:ad,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:zo,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Go,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ko,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),K=w.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),lg=w.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:nd,repeated:!0}]),nd=w.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),id=w.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),rd=w.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),dg=w.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:ug,repeated:!0}]),ug=w.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Wo=w.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),od=w.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),sd=w.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),ad=w.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:cd,oneof:"value"}]),cd=w.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),ld=w.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),dd=w.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:w.getEnumType(ud)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ud=w.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),hg=w.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:w.getEnumType(hd)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),hd=w.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"}]),fd=w.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:pd},{no:2,name:"screen",kind:"message",T:pd},{no:3,name:"resume_connection",kind:"enum",T:w.getEnumType(Si)},{no:4,name:"disabled_codecs",kind:"message",T:fg},{no:5,name:"force_relay",kind:"enum",T:w.getEnumType(Si)}]),pd=w.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:w.getEnumType(Si)}]),fg=w.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:fr,repeated:!0},{no:2,name:"publish",kind:"message",T:fr,repeated:!0}]),md=w.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Ho=w.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),gd=w.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:w.getEnumType(Ho)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),vd=w.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),zo=w.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:w.getEnumType(He)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:gd,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:vd,oneof:"content_header"}],{localName:"DataStream_Header"}),Go=w.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ko=w.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),it=w.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Jo=w.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),pg=w.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),mg=w.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:kn,oneof:"message"},{no:2,name:"answer",kind:"message",T:kn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Qo,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Xo,oneof:"message"},{no:5,name:"mute",kind:"message",T:Zo,oneof:"message"},{no:6,name:"subscription",kind:"message",T:pr,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:bd,oneof:"message"},{no:8,name:"leave",kind:"message",T:mr,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Cd,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:wd,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Ed,oneof:"message"},{no:13,name:"simulate",kind:"message",T:vt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:kd,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:xd,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:_d,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:_g,oneof:"message"}]),yd=w.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:gg,oneof:"message"},{no:2,name:"answer",kind:"message",T:kn,oneof:"message"},{no:3,name:"offer",kind:"message",T:kn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Qo,oneof:"message"},{no:5,name:"update",kind:"message",T:bg,oneof:"message"},{no:6,name:"track_published",kind:"message",T:es,oneof:"message"},{no:8,name:"leave",kind:"message",T:mr,oneof:"message"},{no:9,name:"mute",kind:"message",T:Zo,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Cg,oneof:"message"},{no:11,name:"room_update",kind:"message",T:kg,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Tg,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Eg,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Rg,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:xg,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:yg,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:vg,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Ag,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Mg,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Ng,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Lg,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Ig,oneof:"message"}]),Yo=w.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),Xo=w.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:w.getEnumType(tt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:w.getEnumType(ke)},{no:9,name:"layers",kind:"message",T:Cn,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Yo,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:w.getEnumType(He)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(td)},{no:17,name:"audio_features",kind:"enum",T:w.getEnumType(Re),repeated:!0}]),Qo=w.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:w.getEnumType(it)},{no:3,name:"final",kind:"scalar",T:8}]),Zo=w.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),gg=w.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:hr},{no:2,name:"participant",kind:"message",T:_n},{no:3,name:"other_participants",kind:"message",T:_n,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Sd,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:fd},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:dd},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:fr,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),vg=w.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Sd,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:fd},{no:3,name:"server_info",kind:"message",T:dd},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),es=w.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:qn}]),yg=w.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),kn=w.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),bg=w.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:_n,repeated:!0}]),pr=w.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ld,repeated:!0}]),bd=w.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:w.getEnumType($o)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),_d=w.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:w.getEnumType(Re),repeated:!0}]),_g=w.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),mr=w.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:w.getEnumType(nt)},{no:3,name:"action",kind:"enum",T:w.getEnumType($n)},{no:4,name:"regions",kind:"message",T:Og}]),$n=w.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Cd=w.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Cn,repeated:!0}]),kd=w.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Sd=w.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Cg=w.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:nd,repeated:!0}]),kg=w.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:hr}]),Sg=w.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:w.getEnumType(ki)},{no:3,name:"score",kind:"scalar",T:2}]),Tg=w.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:Sg,repeated:!0}]),wg=w.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(Jo)}]),Eg=w.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:wg,repeated:!0}]),ts=w.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType($o)},{no:2,name:"enabled",kind:"scalar",T:8}]),Pg=w.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:ts,repeated:!0}]),Rg=w.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:ts,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Pg,repeated:!0}]),Td=w.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),wd=w.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Td,repeated:!0}]),xg=w.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Ig=w.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:hr},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:_n},{no:4,name:"other_participants",kind:"message",T:_n,repeated:!0}]),Ed=w.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:kn},{no:2,name:"subscription",kind:"message",T:pr},{no:3,name:"publish_tracks",kind:"message",T:es,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Rd,repeated:!0},{no:5,name:"offer",kind:"message",T:kn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Pd,repeated:!0}]),Pd=w.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Rd=w.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:w.getEnumType(it)}]),vt=w.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:w.getEnumType(pg),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),xd=w.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Ag=w.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Og=w.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Dg,repeated:!0}]),Dg=w.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Mg=w.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:w.getEnumType(og)}]),Ng=w.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:w.getEnumType(ns)},{no:3,name:"message",kind:"scalar",T:9}]),ns=w.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Lg=w.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Ug(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gr={exports:{}},Fg=gr.exports,Id;function Bg(){return Id||(Id=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Fg,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},s=null;function a(p,g){var v=p[g];if(typeof v.bind=="function")return v.bind(p);try{return Function.prototype.bind.call(v,p)}catch{return function(){return Function.prototype.apply.apply(v,[p,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?c:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function d(){for(var p=this.getLevel(),g=0;g<r.length;g++){var v=r[g];this[v]=g<p?e:this.methodFactory(v,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function u(p){return function(){typeof console!==n&&(d.call(this),this[p].apply(this,arguments))}}function h(p,g,v){return l(p)||u.apply(this,arguments)}function f(p,g){var v=this,_,C,y,k="loglevel";typeof p=="string"?k+=":"+p:typeof p=="symbol"&&(k=void 0);function T(O){var U=(r[O]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=U;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+U+";"}catch{}}}function E(){var O;if(!(typeof window===n||!k)){try{O=window.localStorage[k]}catch{}if(typeof O===n)try{var U=window.document.cookie,$=encodeURIComponent(k),H=U.indexOf($+"=");H!==-1&&(O=/^([^;]+)/.exec(U.slice(H+$.length+1))[1])}catch{}return v.levels[O]===void 0&&(O=void 0),O}}function I(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function x(O){var U=O;if(typeof U=="string"&&v.levels[U.toUpperCase()]!==void 0&&(U=v.levels[U.toUpperCase()]),typeof U=="number"&&U>=0&&U<=v.levels.SILENT)return U;throw new TypeError("log.setLevel() called with invalid level: "+O)}v.name=p,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=g||h,v.getLevel=function(){return y??C??_},v.setLevel=function(O,U){return y=x(O),U!==!1&&T(y),d.call(v)},v.setDefaultLevel=function(O){C=x(O),E()||v.setLevel(O,!1)},v.resetLevel=function(){y=null,I(),d.call(v)},v.enableAll=function(O){v.setLevel(v.levels.TRACE,O)},v.disableAll=function(O){v.setLevel(v.levels.SILENT,O)},v.rebuild=function(){if(s!==v&&(_=x(s.getLevel())),d.call(v),s===v)for(var O in o)o[O].rebuild()},_=x(s?s.getLevel():"WARN");var D=E();D!=null&&(y=x(D)),d.call(v)}s=new f,s.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var v=o[g];return v||(v=o[g]=new f(g,s.methodFactory)),v};var m=typeof window!==n?window.log:void 0;return s.noConflict=function(){return typeof window!==n&&window.log===s&&(window.log=m),s},s.getLoggers=function(){return o},s.default=s,s})}(gr)),gr.exports}var vr=Bg(),is;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(is||(is={}));var rt;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(rt||(rt={}));let X=vr.getLogger("livekit");Object.values(rt).map(t=>vr.getLogger(t)),X.setDefaultLevel(is.info);function Lt(t){const e=vr.getLogger(t);return e.setDefaultLevel(X.getLevel()),e}const jg=vr.getLogger("lk-e2ee"),wi=7e3,Vg=[0,300,2*2*300,3*3*300,4*4*300,wi,wi,wi,wi,wi];class qg{constructor(e){this._retryDelays=e!==void 0?[...e]:Vg}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function $g(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function b(t,e,n,i){function r(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(i.next(d))}catch(u){s(u)}}function c(d){try{l(i.throw(d))}catch(u){s(u)}}function l(d){d.done?o(d.value):r(d.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Ad(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ut(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ad=="function"?Ad(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(s){return new Promise(function(a,c){s=t[o](s),r(a,c,s.done,s.value)})}}function r(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}typeof SuppressedError=="function"&&SuppressedError;var yr={exports:{}},Od;function Wg(){if(Od)return yr.exports;Od=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,T,E){return Function.prototype.apply.call(k,T,E)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function i(y){console&&console.warn&&console.warn(y)}var r=Number.isNaN||function(k){return k!==k};function o(){o.init.call(this)}yr.exports=o,yr.exports.once=v,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");s=y}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(y){return y._maxListeners===void 0?o.defaultMaxListeners:y._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(k){for(var T=[],E=1;E<arguments.length;E++)T.push(arguments[E]);var I=k==="error",x=this._events;if(x!==void 0)I=I&&x.error===void 0;else if(!I)return!1;if(I){var D;if(T.length>0&&(D=T[0]),D instanceof Error)throw D;var O=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw O.context=D,O}var U=x[k];if(U===void 0)return!1;if(typeof U=="function")e(U,this,T);else for(var $=U.length,H=m(U,$),E=0;E<$;++E)e(H[E],this,T);return!0};function l(y,k,T,E){var I,x,D;if(a(T),x=y._events,x===void 0?(x=y._events=Object.create(null),y._eventsCount=0):(x.newListener!==void 0&&(y.emit("newListener",k,T.listener?T.listener:T),x=y._events),D=x[k]),D===void 0)D=x[k]=T,++y._eventsCount;else if(typeof D=="function"?D=x[k]=E?[T,D]:[D,T]:E?D.unshift(T):D.push(T),I=c(y),I>0&&D.length>I&&!D.warned){D.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=y,O.type=k,O.count=D.length,i(O)}return y}o.prototype.addListener=function(k,T){return l(this,k,T,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(k,T){return l(this,k,T,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(y,k,T){var E={fired:!1,wrapFn:void 0,target:y,type:k,listener:T},I=d.bind(E);return I.listener=T,E.wrapFn=I,I}o.prototype.once=function(k,T){return a(T),this.on(k,u(this,k,T)),this},o.prototype.prependOnceListener=function(k,T){return a(T),this.prependListener(k,u(this,k,T)),this},o.prototype.removeListener=function(k,T){var E,I,x,D,O;if(a(T),I=this._events,I===void 0)return this;if(E=I[k],E===void 0)return this;if(E===T||E.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete I[k],I.removeListener&&this.emit("removeListener",k,E.listener||T));else if(typeof E!="function"){for(x=-1,D=E.length-1;D>=0;D--)if(E[D]===T||E[D].listener===T){O=E[D].listener,x=D;break}if(x<0)return this;x===0?E.shift():p(E,x),E.length===1&&(I[k]=E[0]),I.removeListener!==void 0&&this.emit("removeListener",k,O||T)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(k){var T,E,I;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[k]),this;if(arguments.length===0){var x=Object.keys(E),D;for(I=0;I<x.length;++I)D=x[I],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=E[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(I=T.length-1;I>=0;I--)this.removeListener(k,T[I]);return this};function h(y,k,T){var E=y._events;if(E===void 0)return[];var I=E[k];return I===void 0?[]:typeof I=="function"?T?[I.listener||I]:[I]:T?g(I):m(I,I.length)}o.prototype.listeners=function(k){return h(this,k,!0)},o.prototype.rawListeners=function(k){return h(this,k,!1)},o.listenerCount=function(y,k){return typeof y.listenerCount=="function"?y.listenerCount(k):f.call(y,k)},o.prototype.listenerCount=f;function f(y){var k=this._events;if(k!==void 0){var T=k[y];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function m(y,k){for(var T=new Array(k),E=0;E<k;++E)T[E]=y[E];return T}function p(y,k){for(;k+1<y.length;k++)y[k]=y[k+1];y.pop()}function g(y){for(var k=new Array(y.length),T=0;T<k.length;++T)k[T]=y[T].listener||y[T];return k}function v(y,k){return new Promise(function(T,E){function I(D){y.removeListener(k,x),E(D)}function x(){typeof y.removeListener=="function"&&y.removeListener("error",I),T([].slice.call(arguments))}C(y,k,x,{once:!0}),k!=="error"&&_(y,I,{once:!0})})}function _(y,k,T){typeof y.on=="function"&&C(y,"error",k,T)}function C(y,k,T,E){if(typeof y.on=="function")E.once?y.once(k,T):y.on(k,T);else if(typeof y.addEventListener=="function")y.addEventListener(k,function I(x){E.once&&y.removeEventListener(k,I),T(x)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return yr.exports}var yt=Wg();let Dd=!0,Md=!0;function Ei(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Sn(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(s,a){if(s!==e)return r.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),r.apply(this,[s,c])};const o=i.removeEventListener;i.removeEventListener=function(s,a){if(s!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(a))return o.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,c])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function Hg(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Dd=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function zg(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Md=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Nd(){if(typeof window=="object"){if(Dd)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function rs(t,e){Md&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Gg(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ei(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ei(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ei(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ei(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Ld(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ud(t){return Ld(t)?Object.keys(t).reduce(function(e,n){const i=Ld(t[n]),r=i?Ud(t[n]):t[n],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function os(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?os(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{os(t,t.get(r),n)})}))}function Fd(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&o.push(s)}),o.forEach(s=>{t.forEach(a=>{a.type===i&&a.trackId===s.id&&os(t,a,r)})}),r}const Bd=Nd;function jd(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof a[l]=="object"?a[l]:{ideal:a[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const u=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(d.ideal!==void 0){c.optional=c.optional||[];let h={};typeof d.ideal=="number"?(h[u("min",l)]=d.ideal,c.optional.push(h),h={},h[u("max",l)]=d.ideal,c.optional.push(h)):(h[u("",l)]=d.ideal,c.optional.push(h))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[u("",l)]=d.exact):["min","max"].forEach(h=>{d[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[u(h,l)]=d[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},r=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(d,u,h){u in d&&!(h in d)&&(d[h]=d[u],delete d[u])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let u;if(l.exact==="environment"||l.ideal==="environment"?u=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(u=["front"]),u)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(m=>m.kind==="videoinput");let f=h.find(m=>u.some(p=>m.label.toLowerCase().includes(p)));return!f&&h.length&&u.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=l.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),Bd("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return Bd("chrome: "+JSON.stringify(a)),c(a)},o=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(a,c,l){r(a,d=>{n.webkitGetUserMedia(d,c,u=>{l&&l(o(u))})})};if(n.getUserMedia=s.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return r(c,l=>a(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(o(d))))}}}function Vd(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function qd(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):o={track:r.track};const s=new Event("track");s.track=r.track,s.receiver=o,s.transceiver={receiver:o},s.streams=[i.stream],this.dispatchEvent(s)}),i.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===r.id):o={track:r};const s=new Event("track");s.track=r,s.receiver=o,s.transceiver={receiver:o},s.streams=[i.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Sn(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function $d(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=r.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(s=>{const a=this._senders.find(c=>c.track===s);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Wd(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(s=>s._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>Fd(s,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Sn(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>Fd(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,o,s;return this.getSenders().forEach(a=>{a.track===i&&(r?s=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(o?s=!0:o=a),a.track===i)),s||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Hd(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(s);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function zd(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Hd(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(u=>this._reverseStreams[u.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const u=new t.MediaStream(d.getTracks());this._streams[d.id]=u,this._reverseStreams[u.id]=d,d=u}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(p=>p===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[u.id];if(m)m.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([d]);this._streams[u.id]=p,this._reverseStreams[p.id]=u,this.addStream(p)}return this.getSenders().find(p=>p.track===d)};function o(l,d){let u=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],m=l._streams[f.id];u=u.replace(new RegExp(m.id,"g"),f.id)}),new RTCSessionDescription({type:d.type,sdp:u})}function s(l,d){let u=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const f=l._reverseStreams[h],m=l._streams[f.id];u=u.replace(new RegExp(f.id,"g"),m.id)}),new RTCSessionDescription({type:d.type,sdp:u})}["createOffer","createAnswer"].forEach(function(l){const d=t.RTCPeerConnection.prototype[l],u={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[m=>{const p=o(this,m);h[0].apply(null,[p])},m=>{h[1]&&h[1].apply(null,m)},arguments[2]]):d.apply(this,arguments).then(m=>o(this,m))}};t.RTCPeerConnection.prototype[l]=u[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=s(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:o(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(p=>d.track===p)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ss(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function Gd(t,e){Sn(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Kd=Object.freeze({__proto__:null,fixNegotiationNeeded:Gd,shimAddTrackRemoveTrack:zd,shimAddTrackRemoveTrackWithNative:Hd,shimGetSendersWithDtmf:$d,shimGetUserMedia:jd,shimMediaStream:Vd,shimOnTrack:qd,shimPeerConnection:ss,shimSenderReceiverGetStats:Wd});function Jd(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,s){rs("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,s)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(s,a,c){a in s&&!(c in s)&&(s[c]=s[a],delete s[a])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),r(s.audio,"autoGainControl","mozAutoGainControl"),r(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},i&&i.prototype.getSettings){const s=i.prototype.getSettings;i.prototype.getSettings=function(){const a=s.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[a])}}}}function Kg(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function Yd(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function as(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],s={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=s[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,s,a]=arguments;return i.apply(this,[o||null]).then(c=>{if(e.version<53&&!s)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,u)=>{c.set(u,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(s,a)}}function Xd(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Qd(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Sn(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Zd(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){rs("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function eu(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function tu(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:s}=o,a=s.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(a).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return o})}function nu(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function iu(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function ru(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var ou=Object.freeze({__proto__:null,shimAddTransceiver:tu,shimCreateAnswer:ru,shimCreateOffer:iu,shimGetDisplayMedia:Kg,shimGetParameters:nu,shimGetUserMedia:Jd,shimOnTrack:Yd,shimPeerConnection:as,shimRTCDataChannel:eu,shimReceiverGetStats:Qd,shimRemoveStream:Zd,shimSenderGetStats:Xd});function su(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o&&o.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function au(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,i.dispatchEvent(s)})}),e.apply(i,arguments)}}}function cu(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(l,d){const u=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[u]);return d?(h.then(l,d),Promise.resolve()):h},e.createAnswer=function(l,d){const u=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[u]);return d?(h.then(l,d),Promise.resolve()):h};let a=function(c,l,d){const u=r.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u};e.setLocalDescription=a,a=function(c,l,d){const u=o.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u},e.setRemoteDescription=a,a=function(c,l,d){const u=s.apply(this,[c]);return d?(u.then(l,d),Promise.resolve()):u},e.addIceCandidate=a}function lu(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(du(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function du(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ud(t.video)}):t}function uu(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let s=0;s<i.iceServers.length;s++){let a=i.iceServers[s];a.urls===void 0&&a.url?(rs("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(i.iceServers[s])}i.iceServers=o}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function hu(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fu(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(s=>s.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function pu(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var mu=Object.freeze({__proto__:null,shimAudioContext:pu,shimCallbacksAPI:cu,shimConstraints:du,shimCreateOfferLegacy:fu,shimGetUserMedia:lu,shimLocalStreamsAPI:su,shimRTCIceServerUrls:uu,shimRemoteStreamsAPI:au,shimTrackEventTransceiver:hu}),cs={exports:{}},gu;function Jg(){return gu||(gu=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)r=o[s].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(s=>{n.parameters[s]!==void 0?o.push(s+"="+n.parameters[s]):o.push(s)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let a=3;a<o.length;a++){const c=o[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const d=e.parseRtpMap(l),u=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=u.length?e.parseFmtp(u[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),i.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{s.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(s=>{r+=e.writeRtpMap(s),r+=e.writeFmtp(s),r+=e.writeRtcpFb(s)});let o=0;return i.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(s=>{r+=e.writeExtmap(s)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,s=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(m=>parseInt(m,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(f.rtx={ssrc:l}),i.push(f),o&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&c&&i.push({ssrc:c});let u=e.matchPrefix(n,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substring(5),10)*1e3*.95-50*40*8:u=void 0,i.forEach(h=>{h.maxBitrate=u})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const s=e.matchPrefix(n,"a=rtcp-mux");return i.mux=s.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const s=e.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const s=i!==void 0?i:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(cs)),cs.exports}var vu=Jg(),Wn=Ug(vu),Yg=lm({__proto__:null,default:Wn},[vu]);function br(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=Wn.parseCandidate(i.candidate);for(const s in o)s in r||Object.defineProperty(r,s,{value:o[s]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Sn(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function ls(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Sn(t,"icecandidate",e=>{if(e.candidate){const n=Wn.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function _r(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Wn.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=Wn.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},r=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=Wn.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),l=r(c),d=o(arguments[0],c);let u;l===0&&d===0?u=Number.POSITIVE_INFINITY:l===0||d===0?u=Math.max(l,d):u=Math.min(l,d);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return u}}),this._sctp=h}return s.apply(this,arguments)}}function Cr(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&c>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Sn(t,"datachannel",i=>(e(i.channel,i.target),i))}function ds(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",r);o.dispatchEvent(s)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function us(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function kr(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Sr(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var Xg=Object.freeze({__proto__:null,removeExtmapAllowMixed:us,shimAddIceCandidateNullOrEmpty:kr,shimConnectionState:ds,shimMaxMessageSize:_r,shimParameterlessSetLocalDescription:Sr,shimRTCIceCandidate:br,shimRTCIceCandidateRelayProtocol:ls,shimSendThrowTypeError:Cr});function Qg(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Nd,i=Gg(t),r={browserDetails:i,commonShim:Xg,extractVersion:Ei,disableLog:Hg,disableWarnings:zg,sdp:Yg};switch(i.browser){case"chrome":if(!Kd||!ss||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Kd,kr(t,i),Sr(t),jd(t,i),Vd(t),ss(t,i),qd(t),zd(t,i),$d(t),Wd(t),Gd(t,i),br(t),ls(t),ds(t),_r(t,i),Cr(t),us(t,i);break;case"firefox":if(!ou||!as||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=ou,kr(t,i),Sr(t),Jd(t,i),as(t,i),Yd(t),Zd(t),Xd(t),Qd(t),eu(t),tu(t),nu(t),iu(t),ru(t),br(t),ds(t),_r(t,i),Cr(t);break;case"safari":if(!mu||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=mu,kr(t,i),Sr(t),uu(t),fu(t),cu(t),su(t),au(t),hu(t),lu(t),pu(t),br(t),ls(t),_r(t,i),Cr(t),us(t,i);break;default:n("Unsupported browser!");break}return r}Qg({window:typeof window>"u"?void 0:window});const Zg=10,Pi="lk_e2ee",ev={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:Zg,keyringSize:16};var Zt;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Zt||(Zt={}));var yu;(function(t){t.KeyRatcheted="keyRatcheted"})(yu||(yu={}));var en;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(en||(en={}));var bu;(function(t){t.Error="cryptorError"})(bu||(bu={}));function tv(){return nv()||hs()}function hs(){return typeof window.RTCRtpScriptTransform<"u"}function nv(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class sk extends yt.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{X.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},ev),e),this.on(Zt.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Zt.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Zt.RatchetRequest,e,n)}}class tn extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var Z;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(Z||(Z={}));class de extends tn{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=Z[n]}}class fs extends tn{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ft extends tn{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class iv extends tn{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Pe extends tn{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class ps extends tn{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class _u extends tn{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class Cu extends tn{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:ns[n]}}var Tr;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Tr||(Tr={})),function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e}(Tr||(Tr={}));var ku;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(ku||(ku={}));var A;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(A||(A={}));var L;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(L||(L={}));var N;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(N||(N={}));var M;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(M||(M={}));function rv(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const ov=/version\/(\d+(\.?_?\d+)+)/i;let ms;function ze(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(ms===void 0||e){const i=sv.find(r=>{let{test:o}=r;return o.test(n)});ms=i==null?void 0:i.describe(n)}return ms}const sv=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:wr(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:gs(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:wr(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:gs(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:wr(ov,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:gs(t)}}}];function wr(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function gs(t){return t.includes("mac os")?wr(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var av="2.14.0";const cv=av,lv=16;class Oe{}Oe.setTimeout=function(){return setTimeout(...arguments)},Oe.setInterval=function(){return setInterval(...arguments)},Oe.clearTimeout=function(){return clearTimeout(...arguments)},Oe.clearInterval=function(){return clearInterval(...arguments)};const dv=5e3,Ri=[];var et;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(et||(et={}));class P extends yt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=P.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=X,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),dv):this.handleAppVisibilityChanged()},this.log=Lt((r=i.loggerName)!==null&&r!==void 0?r:rt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=P.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),J(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===P.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===P.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Ri.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&Ri.splice(Ri.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Hn(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?M.AudioPlaybackStarted:M.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?M.AudioPlaybackFailed:M.VideoPlaybackFailed,o):o.name==="AbortError"?X.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):X.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(s=>s.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(M.ElementAttached,e),e}detach(e){try{if(e){zn(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(M.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{zn(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(M.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Lt(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Ri.forEach(i=>{i.parentElement||(n=!1)}),n&&Ri.push(e)}}handleAppVisibilityChanged(){return b(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===P.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){qe()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){qe()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Hn(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Kn()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Kn()||Gn())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function zn(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(l){switch(l){case e.Audio:return tt.AUDIO;case e.Video:return tt.VIDEO;default:return tt.DATA}}t.kindToProto=r;function o(l){switch(l){case tt.AUDIO:return e.Audio;case tt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function s(l){switch(l){case n.Camera:return ke.CAMERA;case n.Microphone:return ke.MICROPHONE;case n.ScreenShare:return ke.SCREEN_SHARE;case n.ScreenShareAudio:return ke.SCREEN_SHARE_AUDIO;default:return ke.UNKNOWN}}t.sourceToProto=s;function a(l){switch(l){case ke.CAMERA:return n.Camera;case ke.MICROPHONE:return n.Microphone;case ke.SCREEN_SHARE:return n.ScreenShare;case ke.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case Jo.ACTIVE:return i.Active;case Jo.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=c})(P||(P={}));class re{constructor(e,n,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const uv=["vp8","h264"],hv=["vp8","h264","vp9","av1"];function fv(t){return!!uv.find(e=>e===t)}var Su;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Su||(Su={}));var vs;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(vs||(vs={}));const xi={h90:new re(160,90,9e4,20),h180:new re(320,180,16e4,20),h216:new re(384,216,18e4,20),h360:new re(640,360,45e4,20),h540:new re(960,540,8e5,25),h720:new re(1280,720,17e5,30),h1080:new re(1920,1080,3e6,30),h1440:new re(2560,1440,5e6,30),h2160:new re(3840,2160,8e6,30)},ys={h120:new re(160,120,7e4,20),h180:new re(240,180,125e3,20),h240:new re(320,240,14e4,20),h360:new re(480,360,33e4,20),h480:new re(640,480,5e5,20),h540:new re(720,540,6e5,25),h720:new re(960,720,13e5,30),h1080:new re(1440,1080,23e5,30),h1440:new re(1920,1440,38e5,30)},bs={h360fps3:new re(640,360,2e5,3,"medium"),h360fps15:new re(640,360,4e5,15,"medium"),h720fps5:new re(1280,720,8e5,5,"medium"),h720fps15:new re(1280,720,15e5,15,"medium"),h720fps30:new re(1280,720,2e6,30,"medium"),h1080fps15:new re(1920,1080,25e5,15,"medium"),h1080fps30:new re(1920,1080,5e6,30,"medium"),original:new re(0,0,7e6,30,"medium")},pv="|",Tu="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function mv(t){const e=t.split(pv);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ve(t){return b(this,void 0,void 0,function*(){return new Promise(e=>Oe.setTimeout(e,t))})}function _s(){return"addTransceiver"in RTCPeerConnection.prototype}function Cs(){return"addTrack"in RTCPeerConnection.prototype}function gv(){if(!("getCapabilities"in RTCRtpSender)||Kn())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function vv(){if(!("getCapabilities"in RTCRtpSender)||Gn())return!1;if(Kn()){const n=ze();if(n!=null&&n.version&&Ct(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&Ct(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function bt(t){return t==="av1"||t==="vp9"}function ks(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function yv(){return typeof RTCPeerConnection>"u"?!1:_s()||Cs()}function Gn(){var t;return((t=ze())===null||t===void 0?void 0:t.name)==="Firefox"}function Kn(){var t;return((t=ze())===null||t===void 0?void 0:t.name)==="Safari"}function Ss(){const t=ze();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function bv(){const t=ze();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Ct(t.osVersion,"17")>=0}function _v(t){return t||(t=ze()),(t==null?void 0:t.name)==="Safari"&&Ct(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Ct(t.osVersion,"18.3")>0}function wu(){var t,e;return qe()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Cv(){const t=ze(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Ct(e,t.osVersion)>=0?!0:t.name==="Safari"&&Ct(e,t.version)>=0}function qe(){return typeof document<"u"}function _t(){return navigator.product=="ReactNative"}function Ts(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Eu(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Pu(){if(!_t())return;let t=Eu();if(t)return t.platform}function Ru(){if(qe())return window.devicePixelRatio;if(_t()){let t=Eu();if(t)return t.devicePixelRatio}return 1}function Ct(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const s=parseInt(n[o],10),a=parseInt(i[o],10);if(s>a)return 1;if(s<a)return-1;if(o===r-1&&s===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function kv(t){for(const e of t)e.target.handleResize(e)}function Sv(t){for(const e of t)e.target.handleVisibilityChanged(e)}let ws=null;const xu=()=>(ws||(ws=new ResizeObserver(kv)),ws);let Es=null;const Iu=()=>(Es||(Es=new IntersectionObserver(Sv,{root:null,rootMargin:"0px"})),Es);function Tv(){var t;const e=new hg({sdk:hd.JS,protocol:lv,version:cv});return _t()&&(e.os=(t=Pu())!==null&&t!==void 0?t:""),e}function Au(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o==null||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const s=r.captureStream(),[a]=s.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Ii;function Ps(){if(!Ii){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Ii]=i.stream.getAudioTracks(),!Ii)throw Error("Could not get empty media stream audio track");Ii.enabled=!1}return Ii.clone()}class Jn{constructor(e,n){this.onFinally=n,this.promise=new Promise((i,r)=>b(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;return(i=this.onFinally)===null||i===void 0?void 0:i.call(this)})}}function wv(t){return hv.includes(t)}function nn(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function Ev(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Rs(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function Pv(t,e){return t.segments.map(n=>{let{id:i,text:r,language:o,startTime:s,endTime:a,final:c}=n;var l;const d=(l=e.get(i))!==null&&l!==void 0?l:Date.now(),u=Date.now();return c?e.delete(i):e.set(i,d),{id:i,text:r,startTime:Number.parseInt(s.toString()),endTime:Number.parseInt(a.toString()),final:c,language:o,firstReceivedTime:d,lastReceivedTime:u}})}function Rv(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Ou(t){switch(t.reason){case Z.LeaveRequest:return t.context;case Z.Cancelled:return nt.CLIENT_INITIATED;case Z.NotAllowed:return nt.USER_REJECTED;case Z.ServerUnreachable:return nt.JOIN_FAILURE;default:return nt.UNKNOWN_REASON}}function Er(t){return t!==void 0?Number(t):void 0}function Tn(t){return t!==void 0?BigInt(t):void 0}function Yn(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function kt(t){return!!t&&t.kind==P.Kind.Audio}function wn(t){return!!t&&t.kind==P.Kind.Video}function rn(t){return Yn(t)&&wn(t)}function Bt(t){return Yn(t)&&kt(t)}function xs(t){return!!t&&!t.isLocal}function xv(t){return!!t&&!t.isLocal}function Is(t){return xs(t)&&wn(t)}function Iv(t){return t.isLocal}function Av(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function Du(t,e,n){var i,r,o,s;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=Lu(t??{}),d=e==null?void 0:e.processor,u=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(As(h.audio,e),(i=(o=h.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=c??d)),h.video&&(As(h.video,n),(r=(s=h.video).deviceId)!==null&&r!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=l??u)),h}function As(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Os(t){var e,n,i,r;const o={};if(t.video)if(typeof t.video=="object"){const s={},a=s,c=t.video;Object.keys(c).forEach(l=>{switch(l){case"resolution":As(a,c.resolution);break;default:a[l]=c[l]}}),o.video=s,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Mu(t){return b(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=Nu();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,s=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Ve(n),r.getByteTimeDomainData(s);const c=s.some(l=>l!==128&&l!==0);return i.close(),!c}return!1}()})}function Nu(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>b(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)});window.document.body.addEventListener("click",i)}return n}}function Ov(t){return t==="audioinput"?P.Source.Microphone:t==="videoinput"?P.Source.Camera:P.Source.Unknown}function Ds(t){return t===P.Source.Microphone?"audioinput":t===P.Source.Camera?"videoinput":void 0}function Dv(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Kn()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Pr(t){return t.split("/")[1].toLowerCase()}function Mv(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new es({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function J(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?J(t.track):{})}}function Nv(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function Lv(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const o of i)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function Lu(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:rv(e)}}function Uv(t){switch(t){case ke.CAMERA:return P.Source.Camera;case ke.MICROPHONE:return P.Source.Microphone;case ke.SCREEN_SHARE:return P.Source.ScreenShare;case ke.SCREEN_SHARE_AUDIO:return P.Source.ScreenShareAudio;default:return P.Source.Unknown}}class Fv extends yt.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var i,r;const{kind:o,data:s}=n.data;switch(o){case"error":X.error(s.error.message),this.emit(en.EncryptionError,s.error);break;case"initAck":s.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(s.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==s.enabled&&s.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(en.ParticipantEncryptionStatusChanged,s.enabled,this.room.localParticipant),this.encryptionEnabled=s.enabled;else if(s.participantIdentity){const a=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(s.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(s.participantIdentity));this.emit(en.ParticipantEncryptionStatusChanged,s.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Zt.KeyRatcheted,s.ratchetResult,s.participantIdentity,s.keyIndex);break}},this.onWorkerError=n=>{X.error("e2ee worker encountered an error:",{error:n.error}),this.emit(en.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!tv())throw new fs("tried to setup end-to-end encryption on an unsupported browser");if(X.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:jg.getLevel()}};this.worker&&(X.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){X.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?X.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(N.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(A.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==He.NONE,r.identity)),e.on(A.ConnectionStateChanged,i=>{i===ee.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==He.NONE,r.identity)})})}).on(A.TrackUnsubscribed,(i,r,o)=>{var s;const a={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(s=this.worker)===null||s===void 0||s.postMessage(a)}).on(A.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(A.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(L.LocalSenderCreated,(i,r)=>b(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),n.on(Zt.SetKey,i=>this.postKey(i)).on(Zt.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const s={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(s)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Pr(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Yn(e)||!n){n||X.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return b(this,void 0,void 0,function*(){if(this.worker){if(hs()){const o={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Pi in e&&r){const c={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(c);return}let o=e.writableStream,s=e.readableStream;if(!o||!s){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,s=c.readable}const a={kind:"decode",data:{readableStream:s,writableStream:o,trackId:n,codec:r,participantIdentity:i,isReuse:Pi in e}};this.worker.postMessage(a,[s,o])}e[Pi]=!0}})}handleSender(e,n,i){var r;if(!(Pi in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(hs()){X.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{X.info("initialize encoded streams");const o=e.createEncodedStreams(),s={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(s,[o.readable,o.writable])}e[Pi]=!0}}}const Ms="default";class xe{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new xe),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o;if(((o=xe.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){X.debug("awaiting getUserMedia promise");try{n?yield xe.userMediaPromiseMap.get(n):yield Promise.all(xe.userMediaPromiseMap.values())}catch{X.warn("error waiting for media permissons")}}let s=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Kn()&&i.hasDeviceInUse(n))&&(s.filter(c=>c.kind===n).length===0||s.some(c=>{const l=c.label==="",d=n?c.kind===n:!0;return l&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);s=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(d=>{d.stop()})}return i._previousDevices=s,n&&(s=s.filter(a=>a.kind===n)),s}()})}normalizeDeviceId(e,n,i){return b(this,void 0,void 0,function*(){if(n!==Ms)return n;const r=yield this.getDevices(e),o=r.find(a=>a.deviceId===Ms);if(!o){X.warn("could not reliably determine default device");return}const s=r.find(a=>a.deviceId!==Ms&&a.groupId===(i??o.groupId));if(!s){X.warn("could not reliably determine default device");return}return s==null?void 0:s.deviceId})}hasDeviceInUse(e){return e?xe.userMediaPromiseMap.has(e):xe.userMediaPromiseMap.size>0}}xe.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],xe.userMediaPromiseMap=new Map;var Ai;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Ai||(Ai={}));class Bv{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ue,this.nextTaskIndex=0}run(e){return b(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ai.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Ai.RUNNING,yield e()}finally{n.status=Ai.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return b(this,void 0,void 0,function*(){return this.run(()=>b(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function jv(t,e){const n=new URL(Ev(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),Uu(n,"rtc")}function Vv(t){const e=new URL(Rs(t));return Uu(e,"validate")}function qv(t){return t.endsWith("/")?t:"".concat(t,"/")}function Uu(t,e){return t.pathname="".concat(qv(t.pathname)).concat(e),t.toString()}const $v=["syncState","trickle","offer","answer","simulate","leave"];function Wv(t){const e=$v.indexOf(t.case)>=0;return X.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var he;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(he||(he={}));class Ns{get currentState(){return this.state}get isDisconnected(){return this.state===he.DISCONNECTING||this.state===he.DISCONNECTED}get isEstablishingConnection(){return this.state===he.CONNECTING||this.state===he.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=he.DISCONNECTED,this.log=X,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Lt((i=n.loggerName)!==null&&i!==void 0?i:rt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new Bv,this.queuedRequests=[],this.closingLock=new Ue,this.connectionLock=new Ue,this.state=he.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return b(this,void 0,void 0,function*(){return this.state=he.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return b(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=he.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const o=Tv(),s=Hv(n,o,i),a=jv(e,s),c=Vv(a);return new Promise((l,d)=>b(this,void 0,void 0,function*(){const u=yield this.connectionLock.lock();try{const h=()=>b(this,void 0,void 0,function*(){this.close(),clearTimeout(f),d(new de("room connection has been cancelled (signal)",Z.Cancelled))}),f=setTimeout(()=>{this.close(),d(new de("room connection has timed out (signal)",Z.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const m=new URL(a);m.searchParams.has("access_token")&&m.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(m),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=p=>b(this,void 0,void 0,function*(){if(this.state!==he.CONNECTED){this.state=he.DISCONNECTED,clearTimeout(f);try{const g=yield fetch(c);if(g.status.toFixed(0).startsWith("4")){const v=yield g.text();d(new de(v,Z.NotAllowed,g.status))}else d(new de("Encountered unknown websocket error during connection: ".concat(p.toString()),Z.InternalError,g.status))}catch(g){d(new de(g instanceof Error?g.message:"server was not reachable",Z.ServerUnreachable))}return}this.handleWSError(p)}),this.ws.onmessage=p=>b(this,void 0,void 0,function*(){var g,v,_;let C;if(typeof p.data=="string"){const y=JSON.parse(p.data);C=yd.fromJson(y,{ignoreUnknownFields:!0})}else if(p.data instanceof ArrayBuffer)C=yd.fromBinary(new Uint8Array(p.data));else{this.log.error("could not decode websocket message: ".concat(typeof p.data),this.logContext);return}if(this.state!==he.CONNECTED){let y=!1;if(((g=C.message)===null||g===void 0?void 0:g.case)==="join"?(this.state=he.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=C.message.value.pingTimeout,this.pingIntervalDuration=C.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),l(C.message.value)):this.state===he.RECONNECTING&&C.message.case!=="leave"?(this.state=he.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((v=C.message)===null||v===void 0?void 0:v.case)==="reconnect"?l(C.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),l(void 0),y=!0)):this.isEstablishingConnection&&C.message.case==="leave"?d(new de("Received leave request while trying to (re)connect",Z.LeaveRequest,void 0,C.message.value.reason)):i.reconnect||d(new de("did not receive join response, got ".concat((_=C.message)===null||_===void 0?void 0:_.case," instead"),Z.InternalError)),!y)return}this.signalLatency&&(yield Ve(this.signalLatency)),this.handleSignalResponse(C)}),this.ws.onclose=p=>{this.isEstablishingConnection&&d(new de("Websocket got closed during a (re)connection attempt",Z.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:p.reason,code:p.code,wasClean:p.wasClean,state:this.state})),this.handleOnClose(p.reason)}}finally{u()}}))}close(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=he.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(o=>{e.ws?e.ws.onclose=()=>{o()}:o()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,Ve(250)])),e.ws=void 0}}finally{n&&(e.state=he.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Rr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Rr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Qo({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Zo({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return b(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new kd({requestId:a,metadata:i,name:r,attributes:s})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new Cd({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new wd({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:me.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new xd({timestamp:me.parse(Date.now()),rtt:me.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new _d({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new mr({reason:nt.CLIENT_INITIATED,action:$n.DISCONNECT})})}sendRequest(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!Wv(n)&&i.state===he.RECONNECTING){i.queuedRequests.push(()=>b(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ve(i.signalLatency)),!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const s=new mg({message:n});try{i.useJSON?i.ws.send(s.toJsonString()):i.ws.send(s.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const s=Fu(r.value);this.onAnswer&&this.onAnswer(s,r.value.id)}else if(r.case==="offer"){const s=Fu(r.value);this.onOffer&&this.onOffer(s,r.value.id)}else if(r.case==="trickle"){const s=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(s,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return b(this,void 0,void 0,function*(){if(this.state===he.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Oe.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Oe.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Oe.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Oe.clearInterval(this.pingInterval)}}function Fu(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Rr(t,e){return new kn({sdp:t.sdp,type:t.type,id:e})}function Hv(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",_t()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class Bu{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class zv{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,o]of i.entries())n.push(e(o,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var ot={},Ls={},Us={exports:{}},ju;function Fs(){if(ju)return Us.exports;ju=1;var t=Us.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Us.exports}var Vu;function Gv(){return Vu||(Vu=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var u=0;u<l.length;u+=1)a[u+1]!=null&&(c[l[u]]=e(a[u+1]))},i=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var u=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),u,a.names,a.name),a.push&&c[a.push].push(u)},r=Fs(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(o).forEach(function(u){var h=u[0],f=u.slice(2);h==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var m=0;m<(r[h]||[]).length;m+=1){var p=r[h][m];if(p.reg.test(f))return i(p,d,f)}}),c.media=l,c};var s=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,u=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),u=!0),{scid:d,paused:u}})})}}(Ls)),Ls}var Bs,qu;function Kv(){if(qu)return Bs;qu=1;var t=Fs(),e=/%[sdv%]/g,n=function(s){var a=1,c=arguments,l=c.length;return s.replace(e,function(d){if(a>=l)return d;var u=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(u);case"%d":return Number(u);case"%v":return""}})},i=function(s,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[s+"="+l];if(a.names)for(var u=0;u<a.names.length;u+=1){var h=a.names[u];a.name?d.push(c[a.name][h]):d.push(c[a.names[u]])}else d.push(c[a.name]);return n.apply(null,d)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return Bs=function(s,a){a=a||{},s.version==null&&(s.version=0),s.name==null&&(s.name=" "),s.media.forEach(function(u){u.payloads==null&&(u.payloads="")});var c=a.outerOrder||r,l=a.innerOrder||o,d=[];return c.forEach(function(u){t[u].forEach(function(h){h.name in s&&s[h.name]!=null?d.push(i(u,h,s)):h.push in s&&s[h.push]!=null&&s[h.push].forEach(function(f){d.push(i(u,h,f))})})}),s.media.forEach(function(u){d.push(i("m",t.m[0],u)),l.forEach(function(h){t[h].forEach(function(f){f.name in u&&u[f.name]!=null?d.push(i(h,f,u)):f.push in u&&u[f.push]!=null&&u[f.push].forEach(function(m){d.push(i(h,f,m))})})})}),d.join(`\r
`)+`\r
`},Bs}var $u;function Jv(){if($u)return ot;$u=1;var t=Gv(),e=Kv(),n=Fs();return ot.grammar=n,ot.write=e,ot.parse=t.parse,ot.parseParams=t.parseParams,ot.parseFmtpConfig=t.parseFmtpConfig,ot.parsePayloads=t.parsePayloads,ot.parseRemoteCandidates=t.parseRemoteCandidates,ot.parseImageAttributes=t.parseImageAttributes,ot.parseSimulcastStreamList=t.parseSimulcastStreamList,ot}var on=Jv();function js(t,e,n){var i,r,o;e===void 0&&(e=50),n===void 0&&(n={});var s=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,c=n.maxWait,l=Date.now(),d=[];function u(){if(c!==void 0){var f=Date.now()-l;if(f+e>=c)return c-f}return e}var h=function(){var f=[].slice.call(arguments),m=this;return new Promise(function(p,g){var v=s&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,l=Date.now(),!s){var C=t.apply(m,f);a&&a(C),d.forEach(function(y){return(0,y.resolve)(C)}),d=[]}},u()),v){var _=t.apply(m,f);return a&&a(_),p(_)}d.push({resolve:p,reject:g})})};return h.cancel=function(f){o!==void 0&&clearTimeout(o),d.forEach(function(m){return(0,m.reject)(f)}),d=[]},h}const Yv=.7,Xv=20,Xn={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Wu extends yt.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=X,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=js(r=>b(this,void 0,void 0,function*(){this.emit(Xn.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),Xv),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Lt((i=n.loggerName)!==null&&i!==void 0?i:rt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Ue}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return b(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return b(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:s}=Qv(e);this.remoteStereoMids=o,this.remoteNackMids=s}else if(e.type==="answer"){const o=on.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||s.mid!=a.transceiver.mid)return!1;let c=0;if(s.rtp.some(d=>d.codec.toUpperCase()===a.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let l=!1;for(const d of s.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),l=!0;break}return l||a.maxbr>0&&s.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=on.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Xn.NegotiationComplete),e.sdp&&on.parse(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(Xn.RTPVideoPayloadTypes,s.rtp)})),!0})}createAndSendOffer(e){return b(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{const r=this.latestOfferId+1;if(this.latestOfferId=r,this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const s=on.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(s.media.forEach(a=>{zu(a),a.type==="audio"?Hu(a,[],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(u=>u.codec.toUpperCase()===c.codec.toUpperCase()?(l=u.payload,!0):!1),l===0||(bt(c.codec)&&this.ensureVideoDDExtensionForSVC(a,s),c.codec!=="av1"))return!0;const d=Math.round(c.maxbr*Yv);for(const u of a.fmtp)if(u.payload===l){u.config.includes("x-google-start-bitrate")||(u.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,on.write(s)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=on.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{zu(r),r.type==="audio"&&Hu(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,on.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Pe("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Pe("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return b(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const s=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(s!==void 0)return r.get(s)})}setMungedSDP(e,n,i){return b(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const s={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(s.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:s})),new ps(o)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(s=>s.uri===Tu))){if(this.ddExtID===0){let s=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>s&&(s=l.value)}))}),this.ddExtID=s+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:Tu})}}}function Hu(t,e,n){let i=0;t.rtp.some(r=>r.codec==="opus"?(i=r.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(r=>r.payload===i&&r.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(r=>r.payload===i?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function Qv(t){var e;const n=[],i=[],r=on.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(s=>{var a;s.type==="audio"&&(s.rtp.some(c=>c.codec==="opus"?(o=c.payload,!0):!1),!((a=s.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===o&&c.type==="nack")&&i.push(s.mid),s.fmtp.some(c=>c.payload===o?(c.config.includes("sprop-stereo=1")&&n.push(s.mid),!0):!1))}),{stereoMids:n,nackMids:i}}function zu(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}const Vs="vp8",Zv={audioPreset:vs.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:bs.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Vs,backupCodec:!0,preConnectBuffer:!1},Gu={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Ku={deviceId:{ideal:"default"},resolution:xi.h720.resolution},ey={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new qg,disconnectOnPageLeave:!0,webAudioMix:!1},qs={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ye;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ye||(ye={}));class ty{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=qs.peerConnectionTimeout,this.log=X,this.updateState=()=>{var o;const s=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ye.CONNECTED:a.some(c=>c==="failed")?this.state=ye.FAILED:a.some(c=>c==="connecting")?this.state=ye.CONNECTING:a.every(c=>c==="closed")?this.state=ye.CLOSED:a.some(c=>c==="closed")?this.state=ye.CLOSING:a.every(c=>c==="new")&&(this.state=ye.NEW),s!==this.state&&(this.log.debug("pc state change: from ".concat(ye[s]," to ").concat(ye[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Lt((r=i.loggerName)!==null&&r!==void 0?r:rt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new Wu(e,i),this.subscriber=new Wu(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,o,it.PUBLISHER)},this.subscriber.onIceCandidate=o=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,o,it.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var s;(s=this.onDataChannel)===null||s===void 0||s.call(this,o)},this.subscriber.onTrack=o=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,o)},this.publisher.onOffer=(o,s)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,o,s)},this.state=ye.NEW,this.connectionLock=new Ue,this.remoteOfferLock=new Ue}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return b(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return b(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return b(this,void 0,void 0,function*(){n===it.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return b(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return b(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return b(this,void 0,void 0,function*(){return new Promise((n,i)=>b(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(Xn.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Xn.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(s=>{clearTimeout(r),i(s)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===it.PUBLISHER?this.publisher.getConnectedAddress():e===it.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return b(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((c,l)=>b(o,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),Oe.clearTimeout(u),l(new de("room connection has been cancelled",Z.Cancelled))};r!=null&&r.signal.aborted&&d(),r==null||r.signal.addEventListener("abort",d);const u=Oe.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",d),l(new de("could not establish pc connection",Z.InternalError))},s);for(;this.state!==ye.CONNECTED;)if(yield Ve(50),r!=null&&r.signal.aborted){l(new de("room connection has been cancelled",Z.Cancelled));return}Oe.clearTimeout(u),r==null||r.signal.removeEventListener("abort",d),c()}))}()})}}class be extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Yu(n,be.MAX_MESSAGE_BYTES),this.data=i?Yu(i,be.MAX_DATA_BYTES):void 0}static fromProto(e){return new be(e.code,e.message,e.data)}toProto(){return new cd({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new be(be.ErrorCode[e],be.ErrorMessage[e],n)}}be.MAX_MESSAGE_BYTES=256,be.MAX_DATA_BYTES=15360,be.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},be.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Ju=15360;function $s(t){return new TextEncoder().encode(t).length}function Yu(t,e){if($s(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:i=o-1}return t.slice(0,n)}const Ws=2e3;function xr(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Hs=typeof MediaRecorder<"u";class ny{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const iy=Hs?MediaRecorder:ny;class ry extends iy{constructor(e,n){if(!Hs)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const o=()=>r===void 0,s=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",s),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=c=>{r==null||r.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",s),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:c=>{r=c,i=l=>b(this,void 0,void 0,function*(){const d=yield l.data.arrayBuffer();o()||c.enqueue(new Uint8Array(d))}),this.addEventListener("dataavailable",i)},cancel:()=>{s()}}),this.addEventListener("stop",s),this.addEventListener("error",a)}}function oy(){return Hs}const sy=1e3,ay=1e4;class Xu extends P{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=js(()=>b(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>b(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(M.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Ue,this.pauseUpstreamLock=new Ue,this.processorLock=new Ue,this.restartLock=new Ue,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==P.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return b(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{zn(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const o=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Hn(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{o()}}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{Hn(r??e,o)}))})}waitForDimensions(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sy;return function*(){var i;if(e.kind===P.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ze())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ve(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield Ve(50)}throw new Ft("unable to get track dimensions after timeout")}()})}setDeviceId(e){return b(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===nn(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),nn(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===P.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===P.Kind.Audio?"audioinput":"videoinput";return n?xe.getInstance().normalizeDeviceId(o,i,r):i}()})}mute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return b(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return b(this,void 0,void 0,function*(){if(!this.sender)throw new Ft("unable to replace an unpublished track");let i,r;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return b(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=$g(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const s={audio:!1,video:!1};this.kind===P.Kind.Video?s.video=i||r?{deviceId:i,facingMode:r}:!0:s.audio=i?{deviceId:i}:!0,this.attachedElements.forEach(l=>{zn(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(s)).getTracks()[0];return yield c.applyConstraints(o),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(M.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),wu()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(M.UpstreamPaused,this);const i=ze();if((i==null?void 0:i.name)==="Safari"&&Ct(i.version,"12.0")<0)throw new fs("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(M.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o;const s=yield i.processorLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.stopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Hn(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:l}))),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const l of i.attachedElements)l!==i.processorElement&&r&&(zn(i._mediaStreamTrack,l),Hn(i.processor.processedTrack,l));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(M.TrackProcessorUpdate,i.processor)}finally{s()}}()})}getProcessor(){return this.processor}stopProcessor(){return b(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(M.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!oy()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(!this.localTrackRecorder)this.localTrackRecorder=new ry(this,{mimeType:"audio/webm;codecs=opus"});else{this.log.warn("preconnect buffer already started");return}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},ay)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}}class Ir extends Xu{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,P.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}s&&this.prevStats&&(this._currentBitrate=xr(s,this.prevStats)),this.prevStats=s}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(M.AudioTrackFeatureUpdate,this,Re.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(M.AudioTrackFeatureUpdate,this,Re.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===P.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==nn(this._constraints.deviceId);return this.source===P.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return b(this,void 0,void 0,function*(){let n;if(e){const i=Os({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return b(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){qe()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Ws)))}setProcessor(e){return b(this,void 0,void 0,function*(){var n;const i=yield this.processorLock.lock();try{if(!_t()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(M.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return b(this,void 0,void 0,function*(){const e=yield Mu(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(M.AudioSilenceDetected)),e})}}function cy(t,e,n){switch(t.kind){case"audio":return new Ir(t,e,!1,void 0,n);case"video":return new Ar(t,e,!1,n);default:throw new Ft("unsupported track type: ".concat(t.kind))}}const ly=Object.values(xi),dy=Object.values(ys),uy=Object.values(bs),hy=[xi.h180,xi.h360],fy=[ys.h180,ys.h360],py=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new re(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),zs=["q","h","f"];function Gs(t,e,n,i){var r,o;let s=i==null?void 0:i.videoEncoding;t&&(s=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,c=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!s&&!a&&!c||!e||!n)return[{}];s||(s=gy(t,e,n,l),X.debug("using video encoding",s));const d=s.maxFramerate,u=new re(e,n,s.maxBitrate,s.maxFramerate,s.priority);if(c&&bt(l)){const m=new eh(c),p=[];if(m.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const g=ze();if(Ss()||_t()||(g==null?void 0:g.name)==="Chrome"&&Ct(g==null?void 0:g.version,"113")<0){const v=m.suffix=="h"?2:3,_=_v(g);for(let C=0;C<m.spatial;C+=1)p.push({rid:zs[2-C],maxBitrate:s.maxBitrate/Math.pow(v,C),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:_?Math.pow(2,C):void 0});p[0].scalabilityMode=c}else p.push({maxBitrate:s.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(p[0].priority=u.encoding.priority,p[0].networkPriority=u.encoding.priority),X.debug("using svc encoding",{encodings:p}),p}if(!a)return[s];let h=[];t?h=(r=Zu(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Qu(t,u):h=(o=Zu(i==null?void 0:i.videoSimulcastLayers))!==null&&o!==void 0?o:Qu(t,u);let f;if(h.length>0){const m=h[0];h.length>1&&([,f]=h);const p=Math.max(e,n);if(p>=960&&f)return Ks(e,n,[m,f,u],d);if(p>=480)return Ks(e,n,[m,u],d)}return Ks(e,n,[u])}function my(t,e,n){var i,r,o,s;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&X.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,l=(o=a.height)!==null&&o!==void 0?o:(s=t.dimensions)===null||s===void 0?void 0:s.height;return t.source===P.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Gs(t.source===P.Source.ScreenShare,c,l,n)}function gy(t,e,n,i){const r=vy(t,e,n);let{encoding:o}=r[0];const s=Math.max(e,n);for(let a=0;a<r.length;a+=1){const c=r[a];if(o=c.encoding,c.width>=s)break}if(i)switch(i){case"av1":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function vy(t,e,n){if(t)return uy;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?ly:dy}function Qu(t,e){if(t)return py(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?hy:fy}function Ks(t,e,n,i){const r=[];if(n.forEach((o,s)=>{if(s>=zs.length)return;const a=Math.min(t,e),l={rid:zs[s],scaleResolutionDownBy:Math.max(1,a/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},d=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;d&&(l.maxFramerate=d);const u=Gn()||s===0;o.encoding.priority&&u&&(l.priority=o.encoding.priority,l.networkPriority=o.encoding.priority),r.push(l)}),_t()&&Pu()==="ios"){let o;r.forEach(a=>{o?a.maxFramerate&&a.maxFramerate>o&&(o=a.maxFramerate):o=a.maxFramerate});let s=!0;r.forEach(a=>{var c;a.maxFramerate!=o&&(s&&(s=!1,X.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),X.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(o)),a.maxFramerate=o)})}return r}function Zu(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class eh{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function yy(t){return t.source===P.Source.ScreenShare||t.constraints.height&&nn(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const by=5e3;class Ar extends Xu{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,P.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>b(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const s=new Map(o.map(c=>[c.rid,c])),a=o.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(M.CpuConstrained)),this.prevStats){let c=0;s.forEach((l,d)=>{var u;const h=(u=this.prevStats)===null||u===void 0?void 0:u.get(d);c+=xr(l,h)}),this._currentBitrate=c}this.prevStats=s}),this.senderLock=new Ue}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!qe())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Ws))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return b(this,void 0,void 0,function*(){var n,i,r,o,s;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Ut(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)o=l.value,a=!1,yield(s=o.sender)===null||s===void 0?void 0:s.replaceTrack(null)}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return b(this,void 0,void 0,function*(){var n,i,r,o,s;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Ut(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){o=l.value,a=!1;const d=o;yield(s=d.sender)===null||s===void 0?void 0:s.replaceTrack(d.mediaStreamTrack)}}catch(d){i={error:d}}finally{try{!a&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===P.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return b(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===P.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return b(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const s={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(s.jitter=a.jitter,s.packetsLost=a.packetsLost,s.roundTripTime=a.roundTripTime),n.push(s)}}),n.sort((r,o)=>{var s,a;return((s=o.frameWidth)!==null&&s!==void 0?s:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=et.LOW;i<=et.HIGH;i+=1)n.push(new ts({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(bt(this.codec),n)}restartTrack(e){return b(this,void 0,void 0,function*(){var n,i,r,o,s;let a;if(e){const u=Os({video:e});typeof u.video!="boolean"&&(a=u.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=Ut(this.simulcastCodecs.values()),d;d=yield l.next(),n=d.done,!n;c=!0){o=d.value,c=!1;const u=o;u.sender&&((s=u.sender.transport)===null||s===void 0?void 0:s.state)!=="closed"&&(u.mediaStreamTrack=this.mediaStreamTrack.clone(),yield u.sender.replaceTrack(u.mediaStreamTrack))}}catch(u){i={error:u}}finally{try{!c&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return b(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s,a,c,l,d,u;if(yield n.setProcessor.call(r,i,o),!((d=r.processor)===null||d===void 0)&&d.processedTrack)try{for(var h=!0,f=Ut(r.simulcastCodecs.values()),m;m=yield f.next(),s=m.done,!s;h=!0)l=m.value,h=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(r.processor.processedTrack)}catch(p){a={error:p}}finally{try{!h&&!s&&(c=f.return)&&(yield c.call(f))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return b(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},by))}setPublishingCodecs(e){return b(this,void 0,void 0,function*(){var n,i,r,o,s,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(bt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,i=Ut(e);r=yield i.next(),o=r.done,!o;n=!0){c=r.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(bt(d.codec),d.qualities);else{const u=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:u})),!u||!u.sender){for(const h of d.qualities)if(h.enabled){l.push(d.codec);break}}else u.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield th(u.sender,u.encodings,d.qualities,this.senderLock,bt(d.codec),this.log,this.logContext))}}}catch(d){s={error:d}}finally{try{!n&&!o&&(a=i.return)&&(yield a.call(i))}finally{if(s)throw s.error}}return l})}setPublishingLayers(e,n){return b(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield th(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return b(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&bt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),wu()&&this.isInBackground&&this.source===P.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function th(t,e,n,i,r,o,s){return b(this,void 0,void 0,function*(){const a=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:l,senderEncodings:e}));return}let d=!1;!1&&l[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),l.forEach((h,f)=>{var m;let p=(m=h.rid)!==null&&m!==void 0?m:"";p===""&&(p="q");const g=nh(p),v=n.find(_=>_.quality===g);v&&h.active!==v.enabled&&(d=!0,h.active=v.enabled,o.debug("setting layer ".concat(v.quality," to ").concat(h.active?"enabled":"disabled"),s),Gn()&&(v.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),d&&(c.encodings=l,o.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function nh(t){switch(t){case"f":return et.HIGH;case"h":return et.MEDIUM;case"q":return et.LOW;default:return et.HIGH}}function ih(t,e,n,i){if(!n)return[new Cn({quality:et.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,o=new eh(r),s=[],a=o.suffix=="h"?1.5:2,c=o.suffix=="h"?2:3;for(let l=0;l<o.spatial;l+=1)s.push(new Cn({quality:Math.min(et.HIGH,o.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return s}return n.map(r=>{var o,s,a;const c=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let l=nh((s=r.rid)!==null&&s!==void 0?s:"");return new Cn({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const rh="_lossy",oh="_reliable",_y=2*1e3,Js="leave-reconnect",Cy=3e4;var st;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(st||(st={}));class ky extends yt.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=qs.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=st.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=X,this.reliableDataSequence=1,this.reliableMessageBuffer=new Bu,this.reliableReceivedState=new zv(Cy),this.handleDataChannel=i=>b(this,[i],void 0,function(r){var o=this;let{channel:s}=r;return function*(){if(s){if(s.label===oh)o.reliableDCSub=s;else if(s.label===rh)o.lossyDCSub=s;else return;o.log.debug("on data channel ".concat(s.id,", ").concat(s.label),o.logContext),s.onmessage=o.handleDataMessage}}()}),this.handleDataMessage=i=>b(this,void 0,void 0,function*(){var r,o;const s=yield this.dataProcessLock.lock();try{let a;if(i.data instanceof ArrayBuffer)a=i.data;else if(i.data instanceof Blob)a=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const c=je.fromBinary(new Uint8Array(a));if(c.sequence>0&&c.participantSid!==""){const l=this.reliableReceivedState.get(c.participantSid);if(l&&c.sequence<=l)return;this.reliableReceivedState.set(c.participantSid,c.sequence)}((r=c.value)===null||r===void 0?void 0:r.case)==="speaker"?this.emit(N.ActiveSpeakersUpdate,c.value.value.speakers):(((o=c.value)===null||o===void 0?void 0:o.case)==="user"&&Ty(c,c.value.value),this.emit(N.DataPacketReceived,c))}finally{s()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:s}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:s}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?K.LOSSY:K.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(N.Disconnected),this.close()},s=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:s,retryCount:this.reconnectAttempts});if(a===null){o(s);return}i===Js&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Oe.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===st.Connected&&i();const o=()=>{this.off(N.Disconnected,s),i()},s=()=>{this.off(N.Restarted,o),r()};this.once(N.Restarted,o),this.once(N.Disconnected,s)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(N.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===K.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===he.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(jn.RR_SIGNAL_DISCONNECTED))},this.log=Lt((n=e.loggerName)!==null&&n!==void 0?n:rt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Ns(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Ue,this.dataProcessLock=new Ue,this.dcBufferStatus=new Map([[K.LOSSY,!0],[K.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(N.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(N.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(N.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(N.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(N.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(N.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(N.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(N.SignalRequestResponse,i)}get logContext(){var e,n,i,r,o,s;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(s=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||s===void 0?void 0:s.identity,pID:this.participantSid}}join(e,n,i,r){return b(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate(),this.clientConfiguration=o.clientConfiguration,this.emit(N.SignalConnected,o),o}catch(o){if(o instanceof de&&o.reason===Z.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw o}})}close(){return b(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(N.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return b(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Bu,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return b(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ft("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new de("publication of local track timed out, no response from server",Z.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return b(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return b(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==ye.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new ty(r,e.subscriberPrimary,this.loggerOptions),this.emit(N.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,s)=>{this.client.sendIceCandidate(o,s)},this.pcManager.onPublisherOffer=(o,s)=>{this.client.sendOffer(o,s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,s,a)=>b(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(s)&&(this.publisherConnectionPromise=void 0),o===ye.CONNECTED){const d=this.pcState===st.New;this.pcState=st.Connected,d&&this.emit(N.Connected,e)}else o===ye.FAILED&&this.pcState===st.Connected&&(this.pcState=st.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?jn.RR_SUBSCRIBER_FAILED:jn.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===he.RECONNECTING,l=[ye.FAILED,ye.CLOSING,ye.CLOSED].includes(o);c&&l&&!this._isClosed&&this.emit(N.Offline)}),this.pcManager.onTrack=o=>{this.emit(N.MediaTrackAdded,o.track,o.streams[0],o.receiver)},Sy((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>b(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>b(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(N.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(N.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(N.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(N.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(N.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",jn.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case $n.DISCONNECT:this.emit(N.Disconnected,e==null?void 0:e.reason),this.close();break;case $n.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Js);break;case $n.RESUME:this.handleDisconnect(Js)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const s={urls:o.urls};o.username&&(s.username=o.username),o.credential&&(s.credential=o.credential),r.push(s)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Si.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(rh,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(oh,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return b(this,void 0,void 0,function*(){if(_s())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Cs())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return b(this,void 0,void 0,function*(){if(_s())return this.createSimulcastTransceiverSender(e,n,i,r);if(Cs())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),wn(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,i,r){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const s=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,s.sender),s.sender})}createRTCRtpSender(e){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return b(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){X.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Si.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ye.NEW)===ye.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let s=!0;o instanceof Pe?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),s=!1):o instanceof Qn||(this.fullReconnectOnNext=!0),s?this.handleDisconnect("reconnect",jn.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(N.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return b(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(N.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Qn;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(s){throw s instanceof de&&s.reason===Z.NotAllowed?new Pe("could not reconnect, token might be expired"):new Qn}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(N.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==he.CONNECTED)throw new Qn("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(N.Restarted)}catch(o){const s=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(s){yield this.restartConnection(s);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return b(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");if(!this.pcManager)throw new Pe("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(N.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof de&&r.reason===Z.NotAllowed?new Pe("could not reconnect, token might be expired"):r instanceof de&&r.reason===Z.LeaveRequest?r:new Qn(o)}if(this.emit(N.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==he.CONNECTED)throw new Qn("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(N.Resumed)})}waitForPCInitialConnection(e,n){return b(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return b(this,void 0,void 0,function*(){this.pcState=st.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ve(_y),!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=st.Connected}catch(e){throw this.pcState=st.Disconnected,new de("could not establish PC connection, ".concat(e.message),Z.InternalError)}})}publishRpcResponse(e,n,i,r){return b(this,void 0,void 0,function*(){const o=new je({destinationIdentities:[e],kind:K.RELIABLE,value:{case:"rpcResponse",value:new ad({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,K.RELIABLE)})}publishRpcAck(e,n){return b(this,void 0,void 0,function*(){const i=new je({destinationIdentities:[e],kind:K.RELIABLE,value:{case:"rpcAck",value:new sd({requestId:n})}});yield this.sendDataPacket(i,K.RELIABLE)})}sendDataPacket(e,n){return b(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(n),n===K.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===K.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return b(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(K.RELIABLE);const n=this.dataChannelForKind(K.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(K.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>b(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(N.Closing,r);!this.dcBufferStatus.get(e);)yield Ve(10);this.off(N.Closing,r),n()}}))}ensureDataTransportConnected(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var o;if(!i.pcManager)throw new Pe("PC manager is closed");const s=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!s)throw new de("".concat(a," connection not set"),Z.InternalError);let c=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),c=!0),!c&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate();const l=i.dataChannelForKind(n,r);if((l==null?void 0:l.readyState)==="open")return;const d=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<d;){if(s.isICEConnected&&((o=i.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Ve(50)}throw new de("could not establish ".concat(a," connection, state: ").concat(s.getICEConnectionState()),Z.InternalError)}()})}ensurePublisherConnected(e){return b(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ye.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return b(this,void 0,void 0,function*(){return new Promise((e,n)=>b(this,void 0,void 0,function*(){if(!this.pcManager){n(new ps("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(N.Closing,r),this.pcManager.publisher.once(Xn.RTPVideoPayloadTypes,o=>{const s=new Map;o.forEach(a=>{const c=a.codec.toLowerCase();wv(c)&&s.set(a.payload,c)}),this.emit(N.RTPVideoMapUpdate,s)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof ps&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",jn.RR_UNKNOWN),n(o)}finally{this.off(N.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===K.LOSSY)return this.lossyDCSub;if(e===K.RELIABLE)return this.reliableDCSub}else{if(e===K.LOSSY)return this.lossyDC;if(e===K.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const o=this.pcManager.subscriber.getLocalDescription(),s=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,c=new Array,l=new Array;e.forEach(d=>{d.isDesired!==a&&c.push(d.trackSid),d.isEnabled||l.push(d.trackSid)}),this.client.sendSyncState(new Ed({answer:o?Rr({sdp:o.sdp,type:o.type}):void 0,offer:s?Rr({sdp:s.sdp,type:s.type}):void 0,subscription:new pr({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:Mv(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l,datachannelReceiveStates:this.reliableReceivedState.map((d,u)=>new Pd({publisherSid:u,lastSeq:d}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new Rd({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(K.LOSSY),it.PUBLISHER),n(this.dataChannelForKind(K.RELIABLE),it.PUBLISHER),n(this.dataChannelForKind(K.LOSSY,!0),it.SUBSCRIBER),n(this.dataChannelForKind(K.RELIABLE,!0),it.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Oe.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){qe()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){qe()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Qn extends Error{}function Sy(t){return t!==void 0&&t>13}function Ty(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Ys{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Ts(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return b(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),X.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return b(this,void 0,void 0,function*(){const n=yield fetch("".concat(wy(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new de("Could not fetch region settings: ".concat(n.statusText),n.status===401?Z.NotAllowed:Z.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function wy(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class sh{get info(){return this._info}constructor(e,n,i){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0}}class Ey extends sh{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength;const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();return{next:()=>b(this,void 0,void 0,function*(){try{const{done:n,value:i}=yield e.read();return n?{done:!0,value:void 0}:(this.handleChunkReceived(i),{done:!1,value:i.content})}catch{return{done:!0,value:void 0}}}),return(){return b(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return b(this,void 0,void 0,function*(){var e,n,i,r;let o=new Set;try{for(var s=!0,a=Ut(this),c;c=yield a.next(),e=c.done,!e;s=!0){r=c.value,s=!1;const l=r;o.add(l)}}catch(l){n={error:l}}finally{try{!s&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return Array.from(o)})}}class Py extends sh{constructor(e,n,i){super(e,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Er(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength;const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder;return{next:()=>b(this,void 0,void 0,function*(){try{const{done:i,value:r}=yield e.read();return i?{done:!0,value:void 0}:(this.handleChunkReceived(r),{done:!1,value:n.decode(r.content)})}catch{return{done:!0,value:void 0}}}),return(){return b(this,void 0,void 0,function*(){return e.releaseLock(),{done:!0,value:void 0}})}}}readAll(){return b(this,void 0,void 0,function*(){var e,n,i,r;let o="";try{for(var s=!0,a=Ut(this),c;c=yield a.next(),e=c.done,!e;s=!0)r=c.value,s=!1,o+=r}catch(l){n={error:l}}finally{try{!s&&!e&&(i=a.return)&&(yield i.call(a))}finally{if(n)throw n.error}}return o})}}class ah{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return b(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class Ry extends ah{}class xy extends ah{}class ch extends P{constructor(e,n,i,r,o){super(e,i,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?M.Muted:M.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(M.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return b(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Ws)),Nv()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(M.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class Iy extends ch{constructor(e,n,i,r,o,s){super(e,n,P.Kind.Audio,i,s),this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=xr(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;_t()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(_t())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return b(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(ks(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&ks(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(M.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(M.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Xs=100;class Ay extends ch{constructor(e,n,i,r,o){super(e,n,P.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>b(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=xr(s,this.prevStats)),this.prevStats=s}),this.debouncedHandleResize=js(()=>{this.updateDimensions()},Xs),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?zn(this._mediaStreamTrack,n):Hn(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new Oy(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return b(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return b(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const i=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),r=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,o=this.elementInfos.some(a=>a.pictureInPicture),s=this.elementInfos.some(a=>a.visible)&&!r||o;if(this.lastVisible!==s){if(!s&&Date.now()-i<Xs){Oe.setTimeout(()=>{this.updateVisibility()},Xs);return}this.lastVisible=s,this.emit(M.VisibilityChanged,s,this)}}updateDimensions(){var e,n;let i=0,r=0;const o=this.getPixelDensity();for(const s of this.elementInfos){const a=s.width()*o,c=s.height()*o;a+c>i+r&&(i=a,r=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(M.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Ru():n||(Ru()>2?2:1)}}class Oy{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:s}=i;o===this.element&&(this.isIntersecting=s,this.isPiP=Oi(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Oi(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Oi(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Qs(e),this.isPiP=qe()&&Oi(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Qs(this.element),this.isPiP=Oi(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Iu().observe(this.element),xu().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,o;(e=Iu())===null||e===void 0||e.unobserve(this.element),(n=xu())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Oi(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Qs(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Qs(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,s=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+s>n.pageYOffset&&r+o>n.pageXOffset&&!a&&c!=="none"}class jt extends yt.EventEmitter{constructor(e,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=He.NONE,this.log=X,this.handleMuted=()=>{this.emit(M.Muted)},this.handleUnmuted=()=>{this.emit(M.Unmuted)},this.log=Lt((o=r==null?void 0:r.loggerName)!==null&&o!==void 0?o:rt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=P.Source.Unknown}setTrack(e){this.track&&(this.track.off(M.Muted,this.handleMuted),this.track.off(M.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(M.Muted,this.handleMuted),e.on(M.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),J(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==He.NONE}get audioTrack(){if(kt(this.track))return this.track}get videoTrack(){if(wn(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=P.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===P.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(jt||(jt={}));class Zs extends jt{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(M.Ended)},this.handleCpuConstrained=()=>{this.track&&wn(this.track)&&this.emit(M.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(M.Ended,this.handleTrackEnded),this.track.off(M.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(M.Ended,this.handleTrackEnded),e.on(M.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return b(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return b(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(kt(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Re.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Re.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Re.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Re.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Re.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Re.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Or(t,e){return b(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=Lu(t);let s=o.audio,a=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const u=o.audio.deviceId;o.audio.deviceId={exact:u},n=!0,s=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:u}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const u=o.video.deviceId;o.video.deviceId={exact:u},n=!0,a=Object.assign(Object.assign({},o.video),{deviceId:{ideal:u}})}(o.audio===!0||typeof o.audio=="object"&&!o.audio.deviceId)&&(o.audio={deviceId:"default"}),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const c=Du(o,Gu,Ku),l=Os(c),d=navigator.mediaDevices.getUserMedia(l);o.audio&&(xe.userMediaPromiseMap.set("audioinput",d),d.catch(()=>xe.userMediaPromiseMap.delete("audioinput"))),o.video&&(xe.userMediaPromiseMap.set("videoinput",d),d.catch(()=>xe.userMediaPromiseMap.delete("videoinput")));try{const u=yield d;return yield Promise.all(u.getTracks().map(h=>b(this,void 0,void 0,function*(){const f=h.kind==="audio";let m=f?c.audio:c.video;(typeof m=="boolean"||!m)&&(m={});let p;const g=f?l.audio:l.video;typeof g!="boolean"&&(p=g);const v=h.getSettings().deviceId;p!=null&&p.deviceId&&nn(p.deviceId)!==v?p.deviceId=v:p||(p={deviceId:v});const _=cy(h,p,e);return _.kind===P.Kind.Video?_.source=P.Source.Camera:_.kind===P.Kind.Audio&&(_.source=P.Source.Microphone),_.mediaStream=u,kt(_)&&i?yield _.setProcessor(i):wn(_)&&r&&(yield _.setProcessor(r)),_})))}catch(u){if(!n)throw u;return Or(Object.assign(Object.assign({},t),{audio:s,video:a}),e)}})}function Dy(t){return b(this,void 0,void 0,function*(){return(yield Or({audio:!1,video:!0}))[0]})}function lh(t){return b(this,void 0,void 0,function*(){return(yield Or({audio:t??!0,video:!1}))[0]})}var sn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(sn||(sn={}));function My(t){switch(t){case ki.EXCELLENT:return sn.Excellent;case ki.GOOD:return sn.Good;case ki.POOR:return sn.Poor;case ki.LOST:return sn.Lost;default:return sn.Unknown}}class dh extends yt.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Ti.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Vn.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,o,s){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ti.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=sn.Unknown,this.log=X,this.log=Lt((c=s==null?void 0:s.loggerName)!==null&&c!==void 0?c:rt.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Jn,this.once(L.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(P.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(P.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(P.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Vn.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Vn.ACTIVE&&this.emit(L.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(L.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(L.ParticipantNameChanged,e)}_setAttributes(e){const n=Lv(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(L.AttributesChanged,n)}setPermissions(e){var n,i,r,o,s,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((s=this.permissions)===null||s===void 0?void 0:s.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,u)=>{var h;return d!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[u])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(L.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(L.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=My(e),n!==this._connectionQuality&&this.emit(L.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>kt(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(M.Muted,()=>{this.emit(L.TrackMuted,e)}),e.on(M.Unmuted,()=>{this.emit(L.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case P.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case P.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function Ny(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Td({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}const uh=15e3;class Ly extends dh{constructor(e,n,i,r,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=He.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Jn)},this.handleReconnected=()=>{var s,a;(a=(s=this.reconnectFuture)===null||s===void 0?void 0:s.resolve)===null||a===void 0||a.call(s),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var s,a,c,l,d,u;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(a=(s=this.reconnectFuture)===null||s===void 0?void 0:s.reject)===null||a===void 0||a.call(s,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((l=(c=this.signalConnectedFuture).reject)===null||l===void 0||l.call(c,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(u=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||u===void 0||u.call(d,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=s=>{var a,c;s.participant&&this.updateInfo(s.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Jn),(c=(a=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(a)},this.handleSignalRequestResponse=s=>{const{requestId:a,reason:c,message:l}=s,d=this.pendingSignalRequests.get(a);d&&(c!==ns.OK&&d.reject(new Cu(l,c)),this.pendingSignalRequests.delete(a))},this.handleDataPacket=s=>{switch(s.value.case){case"rpcResponse":let a=s.value.value,c=null,l=null;a.value.case==="payload"?c=a.value.value:a.value.case==="error"&&(l=be.fromProto(a.value.value)),this.handleIncomingRpcResponse(a.requestId,c,l);break;case"rpcAck":let d=s.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(s=>Ny(s)))},this.onTrackUnmuted=s=>{this.onTrackMuted(s,s.isUpstreamPaused)},this.onTrackMuted=(s,a)=>{if(a===void 0&&(a=!0),!s.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),J(s)));return}this.engine.updateMuteStatus(s.sid,a)},this.onTrackUpstreamPaused=s=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),J(s))),this.onTrackMuted(s,!0)},this.onTrackUpstreamResumed=s=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),J(s))),this.onTrackMuted(s,s.isMuted)},this.onTrackFeatureUpdate=s=>{const a=this.audioTrackPublications.get(s.sid);if(!a){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(s.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(a.trackSid,a.getTrackFeatures())},this.onTrackCpuConstrained=(s,a)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),J(a))),this.emit(L.LocalTrackCpuConstrained,s,a)},this.handleSubscribedQualityUpdate=s=>b(this,void 0,void 0,function*(){var a,c,l,d,u;if(!(!((u=this.roomOptions)===null||u===void 0)&&u.dynacast))return;const h=this.videoTrackPublications.get(s.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}if(!h.videoTrack)return;const f=yield h.videoTrack.setPublishingCodecs(s.subscribedCodecs);try{for(var m=!0,p=Ut(f),g;g=yield p.next(),a=g.done,!a;m=!0){d=g.value,m=!1;const v=d;fv(v)&&(this.log.debug("publish ".concat(v," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),J(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,v,h.options))}}catch(v){c={error:v}}finally{try{!m&&!a&&(l=p.return)&&(yield l.call(p))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=s=>{const a=this.trackPublications.get(s.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=s=>b(this,void 0,void 0,function*(){if(s.source===P.Source.ScreenShare||s.source===P.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),J(s))),this.unpublishTrack(s);else if(s.isUserProvided)yield s.mute();else if(Bt(s)||rn(s))try{if(qe())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:s.source===P.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(s.source),Object.assign(Object.assign({},this.logContext),J(s))),a.onchange=()=>{a.state!=="denied"&&(s.isMuted||s.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}s.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),J(s))),Bt(s)?yield s.restartTrack({deviceId:"default"}):yield s.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),J(s))),yield s.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==He.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on(N.RemoteMute,(n,i)=>{const r=this.trackPublications.get(n);!r||!r.track||(i?r.mute():r.unmute())}),this.engine.on(N.Connected,this.handleReconnected).on(N.SignalConnected,this.handleSignalConnected).on(N.SignalRestarted,this.handleReconnected).on(N.SignalResumed,this.handleReconnected).on(N.Restarting,this.handleReconnecting).on(N.Resuming,this.handleReconnecting).on(N.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(N.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(N.Disconnected,this.handleDisconnected).on(N.SignalRequestResponse,this.handleSignalRequestResponse).on(N.DataPacketReceived,this.handleDataPacket),this.signalConnectedFuture=void 0}setMetadata(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return b(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return b(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:o,attributes:s}=n;return function*(){return new Promise((a,c)=>b(i,void 0,void 0,function*(){var l,d;try{let u=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((l=r??this.metadata)!==null&&l!==void 0?l:"",(d=o??this.name)!==null&&d!==void 0?d:"",s),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:m=>{c(m),u=!0},values:{name:o,metadata:r,attributes:s}});performance.now()-f<5e3&&!u;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!s||Object.entries(s).every(m=>{let[p,g]=m;return this.attributes[p]===g||g===""&&!this.attributes[p]}))){this.pendingSignalRequests.delete(h),a();return}yield Ve(50)}c(new Cu("Request to update local metadata timed out","TimeoutError"))}catch(u){u instanceof Error&&c(u)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(P.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(P.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(P.Source.ScreenShare,e,n,i)}setPermissions(e){const n=this.permissions,i=super.setPermissions(e);return i&&n&&this.emit(L.ParticipantPermissionsChanged,n),i}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){this.encryptionType=e?He.GCM:He.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return b(this,void 0,void 0,function*(){var o,s;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case P.Source.Camera:c=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case P.Source.Microphone:c=yield this.createTracks({audio:(s=i)!==null&&s!==void 0?s:!0});break;case P.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Ft(e)}}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l instanceof Error&&this.emit(L.MediaDevicesError,l,Ds(e)),this.pendingPublishing.delete(e),l}for(const l of c)e===P.Source.Microphone&&kt(l)&&(r!=null&&r.preConnectBuffer)&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer());try{const l=[];for(const u of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),J(u))),l.push(this.publishTrack(u,r));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(d=>{d.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===P.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(P.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return b(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(P.Source.Camera)||this.pendingPublishing.has(P.Source.Microphone))){this.pendingPublishing.add(P.Source.Camera),this.pendingPublishing.add(P.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(P.Source.Camera),this.pendingPublishing.delete(P.Source.Microphone)}}})}createTracks(e){return b(this,void 0,void 0,function*(){var n,i;e??(e={});const r=Du(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Or(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(kt(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=P.Source.Microphone,this.emit(L.AudioStreamAcquired)),wn(a)&&(this.cameraError=void 0,a.source=P.Source.Camera),a))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return b(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new fs("getDisplayMedia not supported");e.resolution===void 0&&!bv()&&(e.resolution=bs.h1080fps30.resolution);const n=Dv(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Ft("no video track found");const o=new Ar(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=P.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const s=[o];if(i.getAudioTracks().length>0){this.emit(L.AudioStreamAcquired);const a=new Ir(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=P.Source.ScreenShareAudio,s.push(a)}return s})}publishTrack(e,n){return b(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return b(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,d;Bt(i)&&i.setAudioContext(o.audioContext),yield(a=o.reconnectFuture)===null||a===void 0?void 0:a.promise,o.republishPromise&&!s&&(yield o.republishPromise),Yn(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let u;if(i instanceof MediaStreamTrack)u=i.getConstraints();else{u=i.constraints;let v;switch(i.source){case P.Source.Microphone:v="audioinput";break;case P.Source.Camera:v="videoinput"}v&&o.activeDeviceMap.has(v)&&(u=Object.assign(Object.assign({},u),{deviceId:o.activeDeviceMap.get(v)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Ir(i,u,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Ar(i,u,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Ft("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let h;if(o.trackPublications.forEach(v=>{v.track&&v.track===i&&(h=v)}),h)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),J(h))),h;const f="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,m=(c=r==null?void 0:r.forceStereo)!==null&&c!==void 0?c:f;m&&(r||(r={}),r.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),J(i))),r.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=r.dtx)!==null&&l!==void 0||(r.dtx=!1),(d=r.red)!==null&&d!==void 0||(r.red=!1));const p=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r);!Cv()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const g=new Promise((v,_)=>b(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==he.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:J(i)}));const C=setTimeout(()=>{_(new _u("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(C);const y=yield this.publish(i,p,m);v(y)}else try{const C=yield this.publish(i,p,m);v(C)}catch(C){_(C)}}catch(C){_(C)}}));o.pendingPublishPromises.set(i,g);try{return yield g}catch(v){throw v}finally{o.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Jn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),J(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>Uv(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),J(e))),!1)}publish(e,n,i){return b(this,void 0,void 0,function*(){var r,o,s,a,c,l,d,u,h,f;if(!this.hasPermissionsToPublish(e))throw new _u("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(x=>Yn(e)&&x.source===e.source)&&e.source!==P.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),J(e))),n.stopMicTrackOnMute&&kt(e)&&(e.stopOnMute=!0),e.source===P.Source.ScreenShare&&Gn()&&(n.simulcast=!1),n.videoCodec==="av1"&&!gv()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!vv()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Vs),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(x=>n.videoCodec===Pr(x.mime))||(n.videoCodec=Pr(this.enabledPublishVideoCodecs[0].mime)));const p=n.videoCodec;e.on(M.Muted,this.onTrackMuted),e.on(M.Unmuted,this.onTrackUnmuted),e.on(M.Ended,this.handleTrackEnded),e.on(M.UpstreamPaused,this.onTrackUpstreamPaused),e.on(M.UpstreamResumed,this.onTrackUpstreamResumed),e.on(M.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const g=[],v=!(!((r=n.dtx)!==null&&r!==void 0)||r),_=e.getSourceTrackSettings();_.autoGainControl&&g.push(Re.TF_AUTO_GAIN_CONTROL),_.echoCancellation&&g.push(Re.TF_ECHO_CANCELLATION),_.noiseSuppression&&g.push(Re.TF_NOISE_SUPPRESSION),_.channelCount&&_.channelCount>1&&g.push(Re.TF_STEREO),v&&g.push(Re.TF_NO_DTX),Bt(e)&&e.hasPreConnectBuffer&&g.push(Re.TF_PRECONNECT_BUFFER);const C=new Xo({cid:e.mediaStreamTrack.id,name:n.name,type:P.kindToProto(e.kind),muted:e.isMuted,source:P.sourceToProto(e.source),disableDtx:v,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:g});let y;if(e.kind===P.Kind.Video){let x={width:0,height:0};try{x=yield e.waitForDimensions()}catch{const O=(a=(s=this.roomOptions.videoCaptureDefaults)===null||s===void 0?void 0:s.resolution)!==null&&a!==void 0?a:xi.h720.resolution;x={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{dims:x}))}C.width=x.width,C.height=x.height,rn(e)&&(bt(p)&&(e.source===P.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),J(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),C.simulcastCodecs=[new Yo({codec:p,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Vs}),n.backupCodec&&p!==n.backupCodec.codec&&C.encryption===He.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),C.simulcastCodecs.push(new Yo({codec:n.backupCodec.codec,cid:""})))),y=Gs(e.source===P.Source.ScreenShare,C.width,C.height,n),C.layers=ih(C.width,C.height,y,bt(n.videoCodec))}else e.kind===P.Kind.Audio&&(y=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(u=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&u!==void 0?u:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const k=()=>b(this,void 0,void 0,function*(){var x,D,O;if(!this.engine.pcManager)throw new Pe("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,y),this.emit(L.LocalSenderCreated,e.sender,e),rn(e)&&((x=n.degradationPreference)!==null&&x!==void 0||(n.degradationPreference=yy(e)),e.setDegradationPreference(n.degradationPreference)),y)if(Gn()&&e.kind===P.Kind.Audio){let U;for(const $ of this.engine.pcManager.publisher.getTransceivers())if($.sender===e.sender){U=$;break}U&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:U,codec:"opus",maxbr:!((D=y[0])===null||D===void 0)&&D.maxBitrate?y[0].maxBitrate/1e3:0})}else e.codec&&bt(e.codec)&&(!((O=y[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:C.cid,codec:e.codec,maxbr:y[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const E=new Promise((x,D)=>b(this,void 0,void 0,function*(){var O;try{T=yield this.engine.addTrack(C),x(T)}catch(U){e.sender&&(!((O=this.engine.pcManager)===null||O===void 0)&&O.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch($=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{error:$}))})),D(U)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([E,k()]))[0];else{T=yield E;let x;if(T.codecs.forEach(D=>{x===void 0&&(x=D.mimeType)}),x&&e.kind===P.Kind.Video){const D=Pr(x);D!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{codec:D})),n.videoCodec=D,y=Gs(e.source===P.Source.ScreenShare,C.width,C.height,n))}yield k()}const I=new Zs(e.kind,T,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(I.on(M.CpuConstrained,x=>this.onTrackCpuConstrained(x,I)),I.options=n,e.sid=T.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:y,trackInfo:T})),rn(e)?e.startMonitor(this.engine.client):Bt(e)&&e.startMonitor(),this.addTrackPublication(I),this.emit(L.LocalTrackPublished,I),Bt(e)&&T.audioFeatures.includes(Re.TF_PRECONNECT_BUFFER)){const x=e.getPreConnectBuffer();this.on(L.LocalTrackSubscribed,D=>{if(D.trackSid===T.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),J(e))),e.stopPreConnectBuffer()}}),x&&new Promise((O,U)=>b(this,void 0,void 0,function*(){var $,H,te,W,Q,V;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),J(e)));const Je=setTimeout(()=>{U(new Error("agent not active within 10 seconds"))},1e4),Pt=yield this.waitUntilActiveAgentPresent();clearTimeout(Je),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),J(e)));const Me=yield this.streamBytes({name:"preconnect-buffer",mimeType:"audio/opus",topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Pt.identity],attributes:{trackId:I.trackSid,sampleRate:String((Q=_.sampleRate)!==null&&Q!==void 0?Q:"48000"),channels:String((V=_.channelCount)!==null&&V!==void 0?V:"1")}});try{for(var ne=!0,Te=Ut(x),we;we=yield Te.next(),$=we.done,!$;ne=!0){W=we.value,ne=!1;const Ye=W;yield Me.write(Ye)}}catch(Ye){H={error:Ye}}finally{try{!ne&&!$&&(te=Te.return)&&(yield te.call(Te))}finally{if(H)throw H.error}}yield Me.close(),O()}catch(Je){U(Je)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),J(e)))}).catch(O=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),J(e)),{error:O}))})}return I})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return b(this,void 0,void 0,function*(){var r;if(this.encryptionType!==He.NONE)return;let o;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(o=f)}),!o)throw new Ft("track is not published");if(!rn(e))throw new Ft("track is not a video track");const s=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=my(e,n,s);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),J(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new Xo({cid:c.mediaStreamTrack.id,type:P.kindToProto(e.kind),muted:e.isMuted,source:P.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=ih(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const d=()=>b(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,s,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(l),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return b(this,void 0,void 0,function*(){var i,r;if(Yn(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),J(e))),yield l)}const o=this.getPublicationForTrack(e),s=o?J(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),s)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),s));return}e=o.track,e.off(M.Muted,this.onTrackMuted),e.off(M.Unmuted,this.onTrackUnmuted),e.off(M.Ended,this.handleTrackEnded),e.off(M.UpstreamPaused,this.onTrackUpstreamPaused),e.off(M.UpstreamResumed,this.onTrackUpstreamResumed),e.off(M.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ye.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),rn(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),s),{error:l}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case P.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case P.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(L.LocalTrackUnpublished,o),o.setTrack(void 0),a&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return b(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((o,s)=>b(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>b(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),r&&!l.isMuted&&l.source!==P.Source.ScreenShare&&l.source!==P.Source.ScreenShareAudio&&(Bt(l)||rn(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),o()}catch(a){s(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return b(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const o=r.reliable?K.RELIABLE:K.LOSSY,s=r.destinationIdentities,a=r.topic,c=new je({kind:o,value:{case:"user",value:new id({participantIdentity:i.identity,payload:n,destinationIdentities:s,topic:a})}});yield i.engine.sendDataPacket(c,o)}()})}publishDtmf(e,n){return b(this,void 0,void 0,function*(){const i=new je({kind:K.RELIABLE,value:{case:"sipDtmf",value:new rd({code:e,digit:n})}});yield this.engine.sendDataPacket(i,K.RELIABLE)})}sendChatMessage(e,n){return b(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new je({value:{case:"chatMessage",value:new Wo(Object.assign(Object.assign({},i),{timestamp:me.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,K.RELIABLE),this.emit(L.ChatMessage,i),i})}editChatMessage(e,n){return b(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new je({value:{case:"chatMessage",value:new Wo(Object.assign(Object.assign({},i),{timestamp:me.parse(i.timestamp),editTimestamp:me.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,K.RELIABLE),this.emit(L.ChatMessage,i),i})}sendText(e,n){return b(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),s=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(u,h)=>{var f;c[h]=u;const m=c.reduce((p,g)=>p+g,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,m)},d=yield this.streamText({streamId:r,totalSize:s,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield d.write(e),l(1,0),yield d.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((u,h)=>b(this,void 0,void 0,function*(){return this._sendFile(a[h],u,{topic:n.topic,mimeType:u.type,onProgress:f=>{l(f,h+1)}})})))),d.info})}streamText(e){return b(this,void 0,void 0,function*(){var n,i;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes},s=new zo({streamId:r,mimeType:o.mimeType,topic:o.topic,timestamp:Tn(o.timestamp),totalLength:Tn(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new gd({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Ho.UPDATE:Ho.CREATE})}}),a=e==null?void 0:e.destinationIdentities,c=new je({destinationIdentities:a,value:{case:"streamHeader",value:s}});yield this.engine.sendDataPacket(c,K.RELIABLE);let l=0;const d=this,u=new WritableStream({write(m){return b(this,void 0,void 0,function*(){for(const p of Av(m,uh)){yield d.engine.waitForBufferStatusLow(K.RELIABLE);const g=new Go({content:p,streamId:r,chunkIndex:Tn(l)}),v=new je({destinationIdentities:a,value:{case:"streamChunk",value:g}});yield d.engine.sendDataPacket(v,K.RELIABLE),l+=1}})},close(){return b(this,void 0,void 0,function*(){const m=new Ko({streamId:r}),p=new je({destinationIdentities:a,value:{case:"streamTrailer",value:m}});yield d.engine.sendDataPacket(p,K.RELIABLE)})},abort(m){console.log("Sink error:",m)}});let h=()=>b(this,void 0,void 0,function*(){yield f.close()});d.engine.once(N.Closing,h);const f=new Ry(u,o,()=>this.engine.off(N.Closing,h));return f})}sendFile(e,n){return b(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return b(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),s=n.stream().getReader();for(;;){const{done:a,value:c}=yield s.read();if(a)break;yield o.write(c)}return yield o.close(),o.info})}streamBytes(e){return b(this,void 0,void 0,function*(){var n,i,r,o,s;const a=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,l={id:a,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(o=e==null?void 0:e.name)!==null&&o!==void 0?o:"unknown"},d=new zo({totalLength:Tn((s=l.size)!==null&&s!==void 0?s:0),mimeType:l.mimeType,streamId:a,topic:l.topic,timestamp:Tn(Date.now()),attributes:l.attributes,contentHeader:{case:"byteHeader",value:new vd({name:l.name})}}),u=new je({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(u,K.RELIABLE);let h=0;const f=new Ue,m=this.engine,p=this.log,g=new WritableStream({write(_){return b(this,void 0,void 0,function*(){const C=yield f.lock();let y=0;try{for(;y<_.byteLength;){const k=_.slice(y,y+uh);yield m.waitForBufferStatusLow(K.RELIABLE);const T=new je({destinationIdentities:c,value:{case:"streamChunk",value:new Go({content:k,streamId:a,chunkIndex:Tn(h)})}});yield m.sendDataPacket(T,K.RELIABLE),h+=1,y+=k.byteLength}}finally{C()}})},close(){return b(this,void 0,void 0,function*(){const _=new Ko({streamId:a}),C=new je({destinationIdentities:c,value:{case:"streamTrailer",value:_}});yield m.sendDataPacket(C,K.RELIABLE)})},abort(_){p.error("Sink error:",_)}});return new xy(g,l)})}performRpc(e){return b(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:o,payload:s,responseTimeout:a=1e4}=n;return function*(){return new Promise((l,d)=>b(i,void 0,void 0,function*(){var u,h,f,m;if($s(s)>Ju){d(be.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||h===void 0)&&h.version&&Ct((m=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||m===void 0?void 0:m.version,"1.8.0")<0){d(be.builtIn("UNSUPPORTED_SERVER"));return}const p=crypto.randomUUID();yield this.publishRpcRequest(r,p,o,s,a-2e3);const g=setTimeout(()=>{this.pendingAcks.delete(p),d(be.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(p),clearTimeout(v)},2e3);this.pendingAcks.set(p,{resolve:()=>{clearTimeout(g)},participantIdentity:r});const v=setTimeout(()=>{this.pendingResponses.delete(p),d(be.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(p,{resolve:(_,C)=>{clearTimeout(v),this.pendingAcks.has(p)&&(console.warn("RPC response received before ack",p),this.pendingAcks.delete(p),clearTimeout(g)),C?d(C):l(_??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,o){return b(this,void 0,void 0,function*(){const s=new je({destinationIdentities:[e],kind:K.RELIABLE,value:{case:"rpcRequest",value:new od({id:n,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(s,K.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,be.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const o=this.trackPublications.get(n.sid);if(o){const s=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);s!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),J(o)),{mutedOnServer:s})),this.engine.client.sendMuteTrack(n.sid,s))}}),!0):!1}setActiveAgent(e){var n,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Jn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Bt(r)||rn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return b(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[s]=o;return s.source===e});if(r)return r[1];yield Ve(20)}})}}class Uy extends jt{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=et.HIGH,this.handleEnded=o=>{this.setTrack(void 0),this.emit(M.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.disabled=!o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensions=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new pr({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ld({participantSid:"",trackSids:[this.trackSid]})]});this.emit(M.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?jt.SubscriptionStatus.Unsubscribed:super.isSubscribed?jt.SubscriptionStatus.Subscribed:jt.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?jt.PermissionStatus.Allowed:jt.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.videoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Is(this.track)&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Is(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(M.VisibilityChanged,this.handleVisibilityChange),r.off(M.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(M.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(M.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(M.VisibilityChanged,this.handleVisibilityChange),e.on(M.Ended,this.handleEnded),this.emit(M.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(M.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?M.Muted:M.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(M.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(M.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===P.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Is(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new bd({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=et.HIGH,this.emit(M.UpdateSettings,e)}}class Dr extends dh{static fromParticipantInfo(e,n,i){return new Dr(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,o,s,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ti.STANDARD;super(n,i||"",r,o,s,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(M.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),J(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(M.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(M.SubscriptionPermissionChanged,n=>{this.emit(L.TrackSubscriptionPermissionChanged,e,n)}),e.on(M.SubscriptionStatusChanged,n=>{this.emit(L.TrackSubscriptionStatusChanged,e,n)}),e.on(M.Subscribed,n=>{this.emit(L.TrackSubscribed,n,e)}),e.on(M.Unsubscribed,n=>{this.emit(L.TrackUnsubscribed,n,e)}),e.on(M.SubscriptionFailed,n=>{this.emit(L.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:P.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,o,s){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(s===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(L.TrackSubscriptionFailed,n);return}s===void 0&&(s=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,o,s-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),J(a))),this.emit(L.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new Ay(e,n,r,o):l=new Iy(e,n,r,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(i),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&xs(l)&&kt(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var o,s;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const c=P.kindFromProto(r.type);if(!c)return;a=new Uy(c,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(s=this.loggerOptions)===null||s===void 0?void 0:s.loggerName}),a.updateInfo(r),i.set(r.sid,a);const l=Array.from(this.trackPublications.values()).find(d=>d.source===(a==null?void 0:a.source));l&&a.source!==P.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:J(l),newTrack:J(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),J(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(L.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case P.Kind.Audio:this.audioTrackPublications.delete(e);break;case P.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(L.TrackUnpublished,i)}setAudioOutput(e){return b(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;kt(i.track)&&xs(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ee;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ee||(ee={}));const Fy=4*1e3;class Zn extends yt.EventEmitter{constructor(e){var n,i,r,o;if(super(),n=this,this.state=ee.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=X,this.bufferedEvents=[],this.isResuming=!1,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map,this.rpcHandlers=new Map,this.connect=(s,a,c)=>b(this,void 0,void 0,function*(){var l;if(!yv())throw _t()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ee.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ee.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==s&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Ts(new URL(s))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ys(s,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(f=>{var m;(m=this.regionUrlProvider)===null||m===void 0||m.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const u=(f,m,p)=>b(this,void 0,void 0,function*(){var g,v;this.abortController&&this.abortController.abort();const _=new AbortController;this.abortController=_,d==null||d();try{yield this.attemptConnection(p??s,a,c,_),this.abortController=void 0,f()}catch(C){if(this.regionUrlProvider&&C instanceof de&&C.reason!==Z.Cancelled&&C.reason!==Z.NotAllowed){let y=null;try{y=yield this.regionUrlProvider.getNextBestRegionUrl((g=this.abortController)===null||g===void 0?void 0:g.signal)}catch(k){if(k instanceof de&&(k.status===401||k.reason===Z.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),m(k);return}}y&&!(!((v=this.abortController)===null||v===void 0)&&v.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(C.message,". Retrying with another region: ").concat(y),this.logContext),this.recreateEngine(),yield u(f,m,y)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ou(C)),m(C))}else{let y=nt.UNKNOWN_REASON;C instanceof de&&(y=Ou(C)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,y),m(C)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Jn((f,m)=>{u(f,m,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(s,a,c,l,d,u)=>b(this,void 0,void 0,function*(){var h,f,m;const p=yield c.join(s,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout},u.signal);let g=p.serverInfo;if(g||(g={version:p.serverVersion,region:p.serverRegion}),this.serverInfo=g,this.log.debug("connected to Livekit Server ".concat(Object.entries(g).map(v=>{let[_,C]=v;return"".concat(_,": ").concat(C)}).join(", ")),{room:(h=p.room)===null||h===void 0?void 0:h.name,roomSid:(f=p.room)===null||f===void 0?void 0:f.sid,identity:(m=p.participant)===null||m===void 0?void 0:m.identity}),!g.version)throw new iv("unknown server version");return g.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),p}),this.applyJoinResponse=s=>{const a=s.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(s.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(s.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...s.otherParticipants]),s.room&&this.handleRoomUpdate(s.room)},this.attemptConnection=(s,a,c,l)=>b(this,void 0,void 0,function*(){var d,u;this.state===ee.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((u=this.regionUrlProvider)===null||u===void 0)&&u.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},qs),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(s,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(A.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new de("could not establish signal connection",Z.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof de&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new de("Connection attempt aborted",Z.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}qe()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),qe()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ee.Connected),this.emit(A.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return b(n,[...a],void 0,function(){var l=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var u,h,f,m;const p=yield l.disconnectLock.lock();try{if(l.state===ee.Disconnected){l.log.debug("already disconnected",l.logContext);return}l.log.info("disconnect from room",Object.assign({},l.logContext)),(l.state===ee.Connecting||l.state===ee.Reconnecting||l.isResuming)&&(l.log.warn("abort connection attempt",l.logContext),(u=l.abortController)===null||u===void 0||u.abort(),(f=(h=l.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new de("Client initiated disconnect",Z.Cancelled)),l.connectFuture=void 0),!((m=l.engine)===null||m===void 0)&&m.client.isDisconnected||(yield l.engine.client.sendLeave()),l.engine&&(yield l.engine.close()),l.handleDisconnect(d,nt.CLIENT_INITIATED),l.engine=void 0}finally{p()}}()})},this.onPageLeave=()=>b(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>b(this,void 0,void 0,function*(){const s=[],a=ze();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const d=Ps();d.enabled=!0;const u=new MediaStream([d]);l.srcObject=u,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:u,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(A.Disconnected,()=>{l==null||l.remove(),l=null})}s.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(d=>{s.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...s.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>b(this,void 0,void 0,function*(){const s=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(d=>{s.includes(d)||s.push(d)})});yield Promise.all(s.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const s of this.remoteParticipants.values())this.handleParticipantDisconnected(s.identity,s);this.setAndEmitConnectionState(ee.Reconnecting)&&this.emit(A.Reconnecting)},this.handleSignalRestarted=s=>b(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(s.serverRegion),Object.assign(Object.assign({},this.logContext),{region:s.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(s);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:s.serverRegion}))}catch{return}this.setAndEmitConnectionState(ee.Connected),this.emit(A.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=s=>{s.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===Vn.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=s=>{const a=[],c={};s.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(l.sid);d&&(d.audioLevel=l.level,d.setIsSpeaking(!0),a.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(A.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=s=>{const a=new Map;this.activeSpeakers.forEach(l=>{const d=this.remoteParticipants.get(l.identity);d&&d.sid!==l.sid||a.set(l.sid,l)}),s.forEach(l=>{let d=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=l.level,d.setIsSpeaking(l.active),l.active?a.set(l.sid,d):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,d)=>d.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(A.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=s=>{s.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const d=P.streamStateFromProto(a.state);d!==l.track.streamState&&(l.track.streamState=d,c.emit(L.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(A.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=s=>{const a=this.getRemoteParticipantBySid(s.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(s.trackSid);c&&c.setAllowed(s.allowed)},this.handleSubscriptionError=s=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(s.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(s.trackSid);c&&c.setSubscriptionError(s.err)},this.handleDataPacket=s=>{const a=this.remoteParticipants.get(s.participantIdentity);if(s.value.case==="user")this.handleUserPacket(a,s.value.value,s.kind);else if(s.value.case==="transcription")this.handleTranscription(a,s.value.value);else if(s.value.case==="sipDtmf")this.handleSipDtmf(a,s.value.value);else if(s.value.case==="chatMessage")this.handleChatMessage(a,s.value.value);else if(s.value.case==="metrics")this.handleMetrics(s.value.value,a);else if(s.value.case==="streamHeader")this.handleStreamHeader(s.value.value,s.participantIdentity);else if(s.value.case==="streamChunk")this.handleStreamChunk(s.value.value);else if(s.value.case==="streamTrailer")this.handleStreamTrailer(s.value.value);else if(s.value.case==="rpcRequest"){const c=s.value.value;this.handleIncomingRpcRequest(s.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(s,a,c)=>{this.emit(A.DataReceived,a.payload,s,c,a.topic),s==null||s.emit(L.DataReceived,a.payload,c)},this.handleSipDtmf=(s,a)=>{this.emit(A.SipDTMFReceived,a,s),s==null||s.emit(L.SipDTMFReceived,a)},this.bufferedSegments=new Map,this.handleTranscription=(s,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c==null?void 0:c.trackPublications.get(a.trackId),d=Pv(a,this.transcriptionReceivedTimes);l==null||l.emit(M.TranscriptionReceived,d),c==null||c.emit(L.TranscriptionReceived,d,l),this.emit(A.TranscriptionReceived,d,c,l)},this.handleChatMessage=(s,a)=>{const c=Rv(a);this.emit(A.ChatMessage,c,s)},this.handleMetrics=(s,a)=>{this.emit(A.MetricsReceived,s,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(A.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=s=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:s})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(A.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(A.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(A.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>b(this,void 0,void 0,function*(){var s;((s=ze())===null||s===void 0?void 0:s.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(A.MediaDevicesChanged)}),this.handleRoomUpdate=s=>{const a=this.roomInfo;this.roomInfo=s,a&&a.metadata!==s.metadata&&this.emitWhenConnected(A.RoomMetadataChanged,s.metadata),(a==null?void 0:a.activeRecording)!==s.activeRecording&&this.emitWhenConnected(A.RecordingStatusChanged,s.activeRecording)},this.handleConnectionQualityUpdate=s=>{s.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=s=>{this.emit(A.ParticipantMetadataChanged,s,this.localParticipant)},this.onLocalParticipantNameChanged=s=>{this.emit(A.ParticipantNameChanged,s,this.localParticipant)},this.onLocalAttributesChanged=s=>{this.emit(A.ParticipantAttributesChanged,s,this.localParticipant)},this.onLocalTrackMuted=s=>{this.emit(A.TrackMuted,s,this.localParticipant)},this.onLocalTrackUnmuted=s=>{this.emit(A.TrackUnmuted,s,this.localParticipant)},this.onTrackProcessorUpdate=s=>{var a;(a=s==null?void 0:s.onPublish)===null||a===void 0||a.call(s,this)},this.onLocalTrackPublished=s=>b(this,void 0,void 0,function*(){var a,c,l,d,u,h;(a=s.track)===null||a===void 0||a.on(M.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=s.track)===null||c===void 0||c.on(M.Restarted,this.onLocalTrackRestarted),(u=(d=(l=s.track)===null||l===void 0?void 0:l.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||u===void 0||u.call(d,this),this.emit(A.LocalTrackPublished,s,this.localParticipant),Bt(s.track)&&(yield s.track.checkForSilence())&&this.emit(A.LocalAudioSilenceDetected,s);const f=yield(h=s.track)===null||h===void 0?void 0:h.getDeviceId(!1),m=Ds(s.source);m&&f&&f!==this.localParticipant.activeDeviceMap.get(m)&&(this.localParticipant.activeDeviceMap.set(m,f),this.emit(A.ActiveDeviceChanged,m,f))}),this.onLocalTrackUnpublished=s=>{var a,c;(a=s.track)===null||a===void 0||a.off(M.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=s.track)===null||c===void 0||c.off(M.Restarted,this.onLocalTrackRestarted),this.emit(A.LocalTrackUnpublished,s,this.localParticipant)},this.onLocalTrackRestarted=s=>b(this,void 0,void 0,function*(){const a=yield s.getDeviceId(!1),c=Ds(s.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(A.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=s=>{this.emit(A.ConnectionQualityChanged,s,this.localParticipant)},this.onMediaDevicesError=(s,a)=>{this.emit(A.MediaDevicesError,s,a)},this.onLocalParticipantPermissionsChanged=s=>{this.emit(A.ParticipantPermissionsChanged,s,this.localParticipant)},this.onLocalChatMessageSent=s=>{this.emit(A.ChatMessage,s,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},ey),e),this.log=Lt((i=this.options.loggerName)!==null&&i!==void 0?i:rt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Gu),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Ku),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Zv),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Ue,this.localParticipant=new Ly("","",this.engine,this.options,this.rpcHandlers),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",nn(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",nn(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",nn(this.options.audioOutput.deviceId)).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),qe()){const s=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:s.signal}),Zn.cleanupRegistry&&Zn.cleanupRegistry.register(this,()=>{s.abort()})}}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new TypeError('A text stream handler for topic "'.concat(e,'" has already been set.'));this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new TypeError('A byte stream handler for topic "'.concat(e,'" has already been set.'));this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}handleIncomingRpcRequest(e,n,i,r,o,s){return b(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),s!==1){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});$s(d)>Ju?(c=be.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):l=d}catch(d){d instanceof be?c=d:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),d),c=be.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}setE2EEEnabled(e){return b(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new Fv(this.options.e2ee),this.e2eeManager.on(en.ParticipantEncryptionStatusChanged,(n,i)=>{Iv(i)&&(this.isE2EEEnabled=n),this.emit(A.ParticipantEncryptionStatusChanged,n,i)}),this.e2eeManager.on(en.EncryptionError,n=>this.emit(A.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return b(this,void 0,void 0,function*(){return this.state===ee.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(N.RoomUpdate,i),e(r.sid))};this.engine.on(N.RoomUpdate,i),this.once(A.Disconnected,()=>{this.engine.off(N.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new ky(this.options),this.engine.on(N.ParticipantUpdate,this.handleParticipantUpdates).on(N.RoomUpdate,this.handleRoomUpdate).on(N.SpeakersChanged,this.handleSpeakersChanged).on(N.StreamStateChanged,this.handleStreamStateUpdate).on(N.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(N.SubscriptionError,this.handleSubscriptionError).on(N.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(N.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(N.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(N.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(N.DataPacketReceived,this.handleDataPacket).on(N.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ee.SignalReconnecting)&&this.emit(A.SignalReconnecting)}).on(N.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ee.Connected)&&this.emit(A.Reconnected)}).on(N.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ee.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(N.Restarting,this.handleRestarting).on(N.SignalRestarted,this.handleSignalRestarted).on(N.Offline,()=>{this.setAndEmitConnectionState(ee.Reconnecting)&&this.emit(A.Reconnecting)}).on(N.DCBufferStatusChanged,(e,n)=>{this.emit(A.DCBufferStatusChanged,e,n)}).on(N.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(L.LocalTrackSubscribed,n),this.emitWhenConnected(A.LocalTrackSubscribed,n,this.localParticipant)}).on(N.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(A.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return xe.getInstance().getDevices(e,n)}prepareConnection(e,n){return b(this,void 0,void 0,function*(){if(this.state===ee.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Ts(new URL(e))&&n){this.regionUrlProvider=new Ys(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ee.Disconnected&&(this.regionUrl=i,yield fetch(Rs(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Rs(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return b(this,void 0,void 0,function*(){let i=()=>{},r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new vt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new vt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new vt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new vt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new vt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>b(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new vt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new vt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>b(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new mr({reason:nt.CLIENT_INITIATED,action:$n.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new vt({scenario:{case:"subscriberBandwidth",value:Tn(n)}});break;case"leave-full-reconnect":r=new vt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return b(this,arguments,void 0,function(i,r){var o=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,c,l,d,u,h,f;let m=!0,p=!1;const g=s?{exact:r}:r;if(i==="audioinput"){p=o.localParticipant.audioTrackPublications.size===0;const v=(a=o.getActiveDevice(i))!==null&&a!==void 0?a:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=g;const _=Array.from(o.localParticipant.audioTrackPublications.values()).filter(y=>y.source===P.Source.Microphone);try{m=(yield Promise.all(_.map(y=>{var k;return(k=y.audioTrack)===null||k===void 0?void 0:k.setDeviceId(g)}))).every(y=>y===!0)}catch(y){throw o.options.audioCaptureDefaults.deviceId=v,y}const C=_.some(y=>{var k,T;return(T=(k=y.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});m&&C&&(p=!0)}else if(i==="videoinput"){p=o.localParticipant.videoTrackPublications.size===0;const v=(c=o.getActiveDevice(i))!==null&&c!==void 0?c:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=g;const _=Array.from(o.localParticipant.videoTrackPublications.values()).filter(C=>C.source===P.Source.Camera);try{m=(yield Promise.all(_.map(C=>{var y;return(y=C.videoTrack)===null||y===void 0?void 0:y.setDeviceId(g)}))).every(C=>C===!0)}catch(C){throw o.options.videoCaptureDefaults.deviceId=v,C}}else if(i==="audiooutput"){if(p=!0,!ks()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");o.options.webAudioMix&&(r=(l=yield xe.getInstance().normalizeDeviceId("audiooutput",r))!==null&&l!==void 0?l:""),(d=(f=o.options).audioOutput)!==null&&d!==void 0||(f.audioOutput={});const v=(u=o.getActiveDevice(i))!==null&&u!==void 0?u:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((h=o.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(_=>_.setAudioOutput({deviceId:r})))}catch(_){throw o.options.audioOutput.deviceId=v,_}}return p&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(A.ActiveDeviceChanged,i,r)),m}()})}setupLocalParticipantEvents(){this.localParticipant.on(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(L.AttributesChanged,this.onLocalAttributesChanged).on(L.TrackMuted,this.onLocalTrackMuted).on(L.TrackUnmuted,this.onLocalTrackUnmuted).on(L.LocalTrackPublished,this.onLocalTrackPublished).on(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(L.MediaDevicesError,this.onMediaDevicesError).on(L.AudioStreamAcquired,this.startAudio).on(L.ChatMessage,this.onLocalChatMessageSent).on(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ee.Connecting||this.state===ee.Reconnecting){const d=()=>{this.onTrackAdded(e,n,i),u()},u=()=>{this.off(A.Reconnected,d),this.off(A.Connected,d),this.off(A.Disconnected,u)};this.once(A.Reconnected,d),this.once(A.Connected,d),this.once(A.Disconnected,u);return}if(this.state===ee.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=mv(n.id),o=r[0];let s=r[1],a=e.id;if(s&&s.startsWith("TR")&&(a=s),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(d=>d.sid===o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,i,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==ee.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,s,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(s=r.track)===null||s===void 0||s.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(L.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(L.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(L.AttributesChanged,this.onLocalAttributesChanged).off(L.TrackMuted,this.onLocalTrackMuted).off(L.TrackUnmuted,this.onLocalTrackUnmuted).off(L.LocalTrackPublished,this.onLocalTrackPublished).off(L.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(L.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(L.MediaDevicesError,this.onMediaDevicesError).off(L.AudioStreamAcquired,this.startAudio).off(L.ChatMessage,this.onLocalChatMessageSent).off(L.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),qe()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ee.Disconnected),this.emit(A.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(A.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleStreamHeader(e,n){return b(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const s={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Er(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{o=c,this.byteStreamControllers.set(e.streamId,{info:s,controller:o,startTime:Date.now()})}});r(new Ey(s,a,Er(e.totalLength)),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const s={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:c=>{o=c,this.textStreamControllers.set(e.streamId,{info:s,controller:o,startTime:Date.now()})}});r(new Py(s,a,Er(e.totalLength)),{identity:n})}})}handleStreamChunk(e){const n=this.byteStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e);const i=this.textStreamControllers.get(e.streamId);i&&e.content.length>0&&i.controller.enqueue(e)}handleStreamTrailer(e){const n=this.textStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.textStreamControllers.delete(e.streamId));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.byteStreamControllers.delete(e.streamId))}selectDefaultDevices(){return b(this,void 0,void 0,function*(){var e,n,i;const r=xe.getInstance().previousDevices,o=yield xe.getInstance().getDevices(void 0,!1),s=ze();if((s==null?void 0:s.name)==="Chrome"&&s.os!=="iOS")for(let c of o){const l=r.find(d=>d.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(A.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=Ov(c),d=this.localParticipant.getTrackPublication(l);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const u=o.filter(f=>f.kind===c),h=this.getActiveDevice(c);if(h===((n=r.filter(f=>f.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&u.length>0&&((i=u[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(c,u[0].deviceId);continue}c==="audioinput"&&!Ss()||c==="videoinput"||u.length>0&&!u.find(f=>f.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Ss())&&(yield this.switchActiveDevice(c,u[0].deviceId))}})}acquireAudioContext(){return b(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Nu())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ve(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(A.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Dr.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Dr(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(A.ParticipantConnected,i),i.on(L.TrackPublished,r=>{this.emitWhenConnected(A.TrackPublished,r,i)}).on(L.TrackSubscribed,(r,o)=>{r.kind===P.Kind.Audio?(r.on(M.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(M.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===P.Kind.Video&&(r.on(M.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(M.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(A.TrackSubscribed,r,o,i)}).on(L.TrackUnpublished,r=>{this.emit(A.TrackUnpublished,r,i)}).on(L.TrackUnsubscribed,(r,o)=>{this.emit(A.TrackUnsubscribed,r,o,i)}).on(L.TrackMuted,r=>{this.emitWhenConnected(A.TrackMuted,r,i)}).on(L.TrackUnmuted,r=>{this.emitWhenConnected(A.TrackUnmuted,r,i)}).on(L.ParticipantMetadataChanged,r=>{this.emitWhenConnected(A.ParticipantMetadataChanged,r,i)}).on(L.ParticipantNameChanged,r=>{this.emitWhenConnected(A.ParticipantNameChanged,r,i)}).on(L.AttributesChanged,r=>{this.emitWhenConnected(A.ParticipantAttributesChanged,r,i)}).on(L.ConnectionQualityChanged,r=>{this.emitWhenConnected(A.ConnectionQualityChanged,r,i)}).on(L.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(A.ParticipantPermissionsChanged,r,i)}).on(L.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(A.TrackSubscriptionStatusChanged,r,o,i)}).on(L.TrackSubscriptionFailed,(r,o)=>{this.emit(A.TrackSubscriptionFailed,r,i,o)}).on(L.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(A.TrackSubscriptionPermissionChanged,r,o,i)}).on(L.Active,()=>{this.emitWhenConnected(A.ParticipantActive,i),i.kind===Ti.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&xv(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Oe.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,nt.STATE_MISMATCH))):e=0},Fy)}clearConnectionReconcile(){this.connectionReconcileInterval&&Oe.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(A.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ee.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ee.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return b(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new hr({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:me.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new _n({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(A.SignalConnected),this.emit(A.Connected),this.setAndEmitConnectionState(ee.Connected),r.video){const s=new Zs(P.Kind.Video,new qn({source:ke.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO,name:"video-dummy"}),new Ar(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Au(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(s),this.localParticipant.emit(L.LocalTrackPublished,s)}if(r.audio){const s=new Zs(P.Kind.Audio,new qn({source:ke.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO}),new Ir(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Ps(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(s),this.localParticipant.emit(L.LocalTrackPublished,s)}for(let s=0;s<o.count-1;s+=1){let a=new _n({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(s),state:Vn.ACTIVE,tracks:[],joinedAt:me.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(o.video){const l=Au(160*((i=o.aspectRatios[s%o.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),d=new qn({source:ke.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}if(o.audio){const l=Ps(),d=new qn({source:ke.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:tt.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==A.ActiveSpeakersChanged&&e!==A.TranscriptionReceived){const o=hh(i).filter(s=>s!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}Zn.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function hh(t){return t.map(e=>{if(e)return Array.isArray(e)?hh(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var at;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(at||(at={}));class an extends yt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=at.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Zn(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return b(this,void 0,void 0,function*(){if(this.status!==at.IDLE)throw Error("check is running already");this.setStatus(at.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==at.SKIPPED&&this.setStatus(this.isSuccess()?at.SUCCESS:at.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return b(this,void 0,void 0,function*(){return this.room.state===ee.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return b(this,void 0,void 0,function*(){this.room&&this.room.state!==ee.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(at.SKIPPED)}switchProtocol(e){return b(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(A.Reconnecting,()=>{n=!0}),this.room.once(A.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Ve(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class By extends an{get description(){return"Cloud regions"}perform(){return b(this,void 0,void 0,function*(){const e=new Ys(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let o=0;o<3;o++){const s=yield e.getNextBestRegionUrl();if(!s)break;if(i.has(s))continue;i.add(s);const a=yield this.checkCloudRegion(s);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((o,s)=>(o.duration-s.duration)*.5+(o.rtt-s.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return b(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),s=1e3,c=1e6/s,l="A".repeat(s),d=Date.now();for(let m=0;m<c;m++)yield o.write(l);yield o.close();const u=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:u-d};return h==null||h.forEach(m=>{m.type==="candidate-pair"&&m.nominated&&(f.rtt=m.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const ea=1e4;class jy extends an{get description(){return"Connection via UDP vs TCP"}perform(){return b(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(ea/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(ea/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return b(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},u=setInterval(()=>b(this,void 0,void 0,function*(){const h=yield l.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(d.packetsSent=f.packetsSent,d.qualityLimitationDurations=f.qualityLimitationDurations,d.bitrateTotal+=f.targetBitrate,d.count++):f.type==="remote-inbound-rtp"&&(d.packetsLost=f.packetsLost,d.rttTotal+=f.roundTripTime,d.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,ea)),clearInterval(u),a.stop(),n.remove(),yield this.disconnect(),d})}}class Vy extends an{get description(){return"Can publish audio"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield lh();if(yield Mu(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let s=0;if(o.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(s=a.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class qy extends an{get description(){return"Can publish video"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield Dy();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(s=>setTimeout(s,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(s=>{s.type==="outbound-rtp"&&(s.kind==="video"||!s.kind&&s.mediaType==="video")&&(o+=s.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return b(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,s,a,c;const l=document.createElement("canvas"),d=e.getSettings(),u=(s=(o=d.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&s!==void 0?s:1280,h=(c=(a=d.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;l.width=u,l.height=h;const f=l.getContext("2d");f.drawImage(i,0,0);const p=f.getImageData(0,0,l.width,l.height).data;let g=!0;for(let v=0;v<p.length;v+=4)if(p[v]!==0||p[v+1]!==0||p[v+2]!==0){g=!1;break}g?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class $y extends an{get description(){return"Resuming connection after interruption"}perform(){return b(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,o;const s=new Promise(l=>{setTimeout(l,5e3),o=l}),a=()=>{i=!0};n.on(A.SignalReconnecting,a).on(A.Reconnecting,a).on(A.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield s,i){if(!r||n.state!==ee.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Wy extends an{get description(){return"Can connect via TURN"}perform(){return b(this,void 0,void 0,function*(){var e,n;const i=new Ns,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let o=!1,s=!1,a=!1;for(let c of r.iceServers)for(let l of c.urls)l.startsWith("turn:")?(s=!0,a=!0):l.startsWith("turns:")&&(s=!0,a=!0,o=!0),l.startsWith("stun:")&&(a=!0);a?s&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||s?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class Hy extends an{get description(){return"Establishing WebRTC connection"}perform(){return b(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(A.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,o)=>{if(r.candidate){const s=new RTCIceCandidate(r);let a="".concat(s.protocol," ").concat(s.address,":").concat(s.port," ").concat(s.type);s.address&&(zy(s.address)?a+=" (private)":s.protocol==="tcp"&&s.tcpType==="passive"?(e=!0,a+=" (passive)"):s.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,o)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),X.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function zy(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class Gy extends an{get description(){return"Connecting to signal connection via WebSocket"}perform(){return b(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Ns;const o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===ud.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class ak extends yt.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:at.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==at.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return b(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=s=>{this.updateCheck(n,s)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Gy)})}checkWebRTC(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Hy)})}checkTURN(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Wy)})}checkReconnect(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck($y)})}checkPublishAudio(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(Vy)})}checkPublishVideo(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(qy)})}checkConnectionProtocol(){return b(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(jy);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return b(this,void 0,void 0,function*(){return this.createAndRunCheck(By)})}}function Vt(){return Vt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Vt.apply(null,arguments)}const fh=new Uint8Array(0);class Di{static getFullOptions(e){return Vt({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(o){i.onError(`Unexpected error in client tool call handling: ${o instanceof Error?o.message:String(o)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return fh}getOutputByteFrequencyData(){return fh}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}class ph{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function Mr(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const mh="0.14.0-beta.0";function ta(t){return!!t.type}const gh="conversation_initiation_client_data";function vh(t){var e;const n={type:gh};var i,r,o,s,a,c,l,d;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(o=t.overrides.agent)==null?void 0:o.language},tts:{voice_id:(s=t.overrides.tts)==null?void 0:s.voiceId,speed:(a=t.overrides.tts)==null?void 0:a.speed,stability:(c=t.overrides.tts)==null?void 0:c.stability,similarity_boost:(l=t.overrides.tts)==null?void 0:l.similarityBoost},conversation:{text_only:(d=t.overrides.conversation)==null?void 0:d.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}class yh extends Error{constructor(e,n){super(e),this.closeCode=void 0,this.closeReason=void 0,this.name="SessionConnectionError",this.closeCode=n==null?void 0:n.closeCode,this.closeReason=n==null?void 0:n.closeReason}}class Mi extends ph{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",o=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:o}),0)}),this.socket.addEventListener("close",o=>{this.disconnect(o.code===1e3?{reason:"agent",context:o,closeCode:o.code,closeReason:o.reason||void 0}:{reason:"error",message:o.reason||"The connection was closed by the server.",context:o,closeCode:o.code,closeReason:o.reason||void 0})}),this.socket.addEventListener("message",o=>{try{const s=JSON.parse(o.data);if(!ta(s))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:o.data});this.handleMessage(s)}catch(s){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:s instanceof Error?s.message:String(s),data:o.data})}})}static async create(e){let n=null;try{var i,r,o;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let c;const l=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||mh,d=((o=e.overrides)==null||(o=o.client)==null?void 0:o.source)||"js_sdk";if(e.signedUrl){const _=e.signedUrl.includes("?")?"&":"?";c=`${e.signedUrl}${_}source=${d}&version=${l}`}else c=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${d}&version=${l}`;const u=["convai"];e.authorization&&u.push(`bearer.${e.authorization}`),n=new WebSocket(c,u);const h=await new Promise((_,C)=>{n.addEventListener("open",()=>{var y;const k=vh(e);(y=n)==null||y.send(JSON.stringify(k))},{once:!0}),n.addEventListener("error",y=>{setTimeout(()=>C(new yh("The connection was closed due to a socket error.")),0)}),n.addEventListener("close",y=>{C(new yh(y.reason||(y.code===1e3?"Connection closed normally before session could be established.":"Connection closed unexpectedly before session could be established."),{closeCode:y.code,closeReason:y.reason||void 0}))}),n.addEventListener("message",y=>{const k=JSON.parse(y.data);ta(k)&&(k.type==="conversation_initiation_metadata"?_(k.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:f,agent_output_audio_format:m,user_input_audio_format:p}=h,g=Mr(p??"pcm_16000"),v=Mr(m);return new Mi(n,f,g,v)}catch(a){var s;throw(s=n)==null||s.close(),a}}close(){this.socket.close(1e3,"User ended conversation")}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}}function bh(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function Ky(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Nr=new Map;function _h(t,e){return async(n,i)=>{const r=Nr.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Nr.set(t,i)}catch(a){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${a}`)}const o=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(o);try{return await n.addModule(s),void Nr.set(t,s)}catch{URL.revokeObjectURL(s)}try{const a=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(a),Nr.set(t,a)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const Ch=_h("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @chato/voice-client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 10;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class qt extends ph{constructor(e,n,i,r,o={}){super(o),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,o;const l=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||mh,d=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",u=`${s=(o=e.origin)!=null?o:"https://api.elevenlabs.io",s.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${d}&version=${l}`,h=await fetch(u);if(!h.ok)throw new Error(`Voice API returned ${h.status} ${h.statusText}`);if(n=(await h.json()).token,!n)throw new Error("No conversation token received from API")}catch(l){let d=l instanceof Error?l.message:String(l);throw l instanceof Error&&l.message.includes("401")&&(d="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${d}`)}}var s;const a=new Zn;try{const l=`room_${Date.now()}`,d=Mr("pcm_48000"),u=Mr("pcm_48000"),h=new qt(a,l,d,u,e),f=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await a.connect(f,n),await new Promise(p=>{if(h.isConnected)p();else{const g=()=>{a.off(A.Connected,g),p()};a.on(A.Connected,g)}}),a.name&&(h.conversationId=((c=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||a.name),e.textOnly||await a.localParticipant.setMicrophoneEnabled(!0);const m=vh(e);return h.debug({type:gh,message:m}),await h.sendMessage(m),h}catch(l){throw await a.disconnect(),l}}setupRoomEventListeners(){var e=this;this.room.on(A.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(A.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(A.ConnectionStateChanged,n=>{n===ee.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(A.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;ta(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(A.TrackSubscribed,async function(n,i,r){if(n.kind===P.Kind.Audio&&r.identity.includes("agent")){const o=n,s=o.attach();if(s.autoplay=!0,s.controls=!1,e.outputDeviceId&&s.setSinkId)try{await s.setSinkId(e.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}s.style.display="none",document.body.appendChild(s),e.audioElements.push(s),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(o)}}),this.room.on(A.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(A.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(P.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await Ch(n.audioWorklet);const o=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(o),o.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),o.port.onmessage=s=>{const[a,c]=s.data;if(c>.01){const l=bh(a.buffer),d=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:l,event_id:d}})}},r.connect(o)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(P.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await lh(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:P.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function kh(t){const e=function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"}(t);switch(e){case"websocket":return Mi.create(t);case"webrtc":return qt.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function na(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Sh(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(na()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class ia extends Di{static async startSession(e){const n=Di.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await Sh(n.connectionDelay),i=await kh(e),new ia(n,i)}catch(o){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),o}}}const Th={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class ei{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:o,libsampleratePath:s,onError:a}){let c=null,l=null;try{const h=Vt({sampleRate:{ideal:e}},Th);if(na()&&i){const C=(await window.navigator.mediaDevices.enumerateDevices()).find(y=>y.kind==="audioinput"&&["airpod","headphone","earphone"].find(k=>y.label.toLowerCase().includes(k)));C&&(h.deviceId={ideal:C.deviceId})}r&&(h.deviceId=ei.getDeviceIdConstraint(r));const f=navigator.mediaDevices.getSupportedConstraints().sampleRate;c=new window.AudioContext(f?{sampleRate:e}:{});const m=c.createAnalyser();if(!f){const C=s||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await c.audioWorklet.addModule(C)}await Ch(c.audioWorklet,o==null?void 0:o.rawAudioProcessor);const p=Vt({voiceIsolation:!0},h);l=await navigator.mediaDevices.getUserMedia({audio:p});const g=c.createMediaStreamSource(l),v=new AudioWorkletNode(c,"rawAudioProcessor");v.port.postMessage({type:"setFormat",format:n,sampleRate:e}),g.connect(m),m.connect(v),await c.resume();const _=await navigator.permissions.query({name:"microphone"});return new ei(c,m,v,l,g,_,a)}catch(h){var d,u;throw(d=l)==null||d.getTracks().forEach(f=>{f.stop()}),(u=c)==null||u.close(),h}}static getDeviceIdConstraint(e){if(e)return na()?{ideal:e}:{exact:e}}constructor(e,n,i,r,o,s,a=console.error){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.permissions=void 0,this.onError=void 0,this.settingInput=!1,this.handlePermissionsChange=()=>{if(this.permissions.state==="denied")this.onError("Microphone permission denied");else if(!this.settingInput){var c;const[l]=this.inputStream.getAudioTracks(),{deviceId:d}=(c=l==null?void 0:l.getSettings())!=null?c:{};this.setInputDevice(d).catch(u=>{this.onError("Failed to reset input device after permission change:",u)})}},this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=o,this.permissions=s,this.onError=a,this.permissions.addEventListener("change",this.handlePermissionsChange)}forgetInputStreamAndSource(){for(const e of this.inputStream.getTracks())e.stop();this.mediaStreamSource.disconnect()}async close(){this.forgetInputStreamAndSource(),this.permissions.removeEventListener("change",this.handlePermissionsChange),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{if(this.settingInput)throw new Error("Input device is already being set");this.settingInput=!0;const n=Vt({},Th);e&&(n.deviceId=ei.getDeviceIdConstraint(e));const i=Vt({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.forgetInputStreamAndSource(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw this.onError("Failed to switch input device:",n),n}finally{this.settingInput=!1}}}const Jy=_h("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @chato/voice-client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class Lr{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let o=null,s=null;try{o=new AudioContext({sampleRate:e});const l=o.createAnalyser(),d=o.createGain();s=new Audio,s.src="",s.load(),s.autoplay=!0,s.style.display="none",document.body.appendChild(s);const u=o.createMediaStreamDestination();s.srcObject=u.stream,d.connect(l),l.connect(u),await Jy(o.audioWorklet,r==null?void 0:r.audioConcatProcessor);const h=new AudioWorkletNode(o,"audioConcatProcessor");return h.port.postMessage({type:"setFormat",format:n}),h.connect(d),await o.resume(),i&&s.setSinkId&&await s.setSinkId(i),new Lr(o,l,d,h,s)}catch(l){var a,c;throw(a=s)!=null&&a.parentNode&&s.parentNode.removeChild(s),(c=s)==null||c.pause(),o&&o.state!=="closed"&&await o.close(),l}}constructor(e,n,i,r,o){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=o}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Ni extends Di{static async requestWakeLock(){if("wakeLock"in navigator)try{return await navigator.wakeLock.request("screen")}catch{}return null}static async startSession(e){var n;const i=Di.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,o=null,s=null,a=null,c=null;((n=e.useWakeLock)==null||n)&&(c=await Ni.requestWakeLock());try{var l;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await Sh(i.connectionDelay),o=await kh(e),[r,s]=await Promise.all([ei.create(Vt({},o.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),Lr.create(Vt({},o.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(l=a)==null||l.getTracks().forEach(p=>{p.stop()}),a=null,new Ni(i,o,r,s,c)}catch(p){var d,u,h,f;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(d=a)==null||d.getTracks().forEach(g=>{g.stop()}),(u=o)==null||u.close(),await((h=r)==null?void 0:h.close()),await((f=s)==null?void 0:f.close());try{var m;await((m=c)==null?void 0:m.release()),c=null}catch{}throw p}}constructor(e,n,i,r,o){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.visibilityChangeHandler=null,this.onInputWorkletMessage=s=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:bh(s.data[0].buffer)})},this.onOutputWorkletMessage=({data:s})=>{s.type==="process"&&this.updateMode(s.finished?"listening":"speaking")},this.addAudioBase64Chunk=s=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:Ky(s)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=s=>{if(s.length===0)return 0;let a=0;for(let c=0;c<s.length;c++)a+=s[c]/255;return a/=s.length,a<0?0:a>1?1:a},this.setVolume=({volume:s})=>{const a=Number.isFinite(s)?Math.min(1,Math.max(0,s)):1;this.volume=a,this.connection instanceof qt?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=r,this.wakeLock=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage,o&&(this.visibilityChangeHandler=()=>{var s;document.visibilityState==="visible"&&(s=this.wakeLock)!=null&&s.released&&Ni.requestWakeLock().then(a=>{this.wakeLock=a})},document.addEventListener("visibilitychange",this.visibilityChangeHandler))}async handleEndSession(){await super.handleEndSession(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler);try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;super.handleAudio(e),e.audio_event.alignment&&this.options.onAudioAlignment&&this.options.onAudioAlignment(e.audio_event.alignment),this.lastInterruptTimestamp<=e.audio_event.event_id&&(e.audio_event.audio_base_64&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof qt||this.addAudioBase64Chunk(e.audio_event.audio_base_64)),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof qt?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof qt?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof Mi)try{return await this.input.setInputDevice(r),this.input}catch(s){console.warn("Failed to change device on existing input, recreating:",s)}this.connection instanceof qt&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const o=await ei.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath,onError:this.options.onError});return this.input=o,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(o){throw console.error("Error changing input device",o),o}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof Mi)try{return await this.output.setOutputDevice(i),this.output}catch(o){console.warn("Failed to change device on existing output, recreating:",o)}this.connection instanceof qt&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await Lr.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}function Yy(t,e,n="https://api.elevenlabs.io"){const i={};return typeof e=="boolean"?i.feedback=e?"like":"dislike":(i.rating=e.rating,i.comment=e.comment),fetch(`${n}/v1/convai/conversations/${t}/feedback`,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})}var wh;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(wh||(wh={}));var Eh,Ph;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(Eh||(Eh={})),function(t){t.MANUAL="manual",t.VAD="vad"}(Ph||(Ph={}));class Xy extends Di{static startSession(e){return e.textOnly?ia.startSession(e):Ni.startSession(e)}}const Rh=Ne(null);function Qy({children:t}){const e=bn(),n=We(()=>e.value.mic_muting_enabled??!1),i=At(!1),r=ce(()=>({isMuted:Ze(()=>n.value?i.value:!1),setIsMuted:o=>{i.value=o},isMutingEnabled:n}),[]);return S(Rh.Provider,{value:r,children:t})}function ra(){return mt(Rh)}const ti={en:{name:"English",flagCode:"us",languageCode:"en"},zh:{name:"Chinese",flagCode:"cn",languageCode:"zh"},es:{name:"Spanish",flagCode:"es",languageCode:"es"},hi:{name:"Hindi",flagCode:"in",languageCode:"hi"},pt:{name:"Portuguese (Portugal)",flagCode:"pt",languageCode:"pt"},"pt-br":{name:"Portuguese (Brazil)",flagCode:"br",languageCode:"pt-br"},fr:{name:"French",flagCode:"fr",languageCode:"fr"},de:{name:"German",flagCode:"de",languageCode:"de"},ja:{name:"Japanese",flagCode:"jp",languageCode:"ja"},ar:{name:"Arabic",flagCode:"ae",languageCode:"ar"},ru:{name:"Russian",flagCode:"ru",languageCode:"ru"},ko:{name:"Korean",flagCode:"kr",languageCode:"ko"},id:{name:"Indonesian",flagCode:"id",languageCode:"id"},it:{name:"Italian",flagCode:"it",languageCode:"it"},nl:{name:"Dutch",flagCode:"nl",languageCode:"nl"},tr:{name:"Turkish",flagCode:"tr",languageCode:"tr"},pl:{name:"Polish",flagCode:"pl",languageCode:"pl"},sv:{name:"Swedish",flagCode:"se",languageCode:"sv"},ms:{name:"Malay",flagCode:"my",languageCode:"ms"},ro:{name:"Romanian",flagCode:"ro",languageCode:"ro"},uk:{name:"Ukrainian",flagCode:"ua",languageCode:"uk"},el:{name:"Greek",flagCode:"gr",languageCode:"el"},cs:{name:"Czech",flagCode:"cz",languageCode:"cs"},da:{name:"Danish",flagCode:"dk",languageCode:"da"},fi:{name:"Finnish",flagCode:"fi",languageCode:"fi"},bg:{name:"Bulgarian",flagCode:"bg",languageCode:"bg"},hr:{name:"Croatian",flagCode:"hr",languageCode:"hr"},sk:{name:"Slovak",flagCode:"sk",languageCode:"sk"},fil:{name:"Filipino",flagCode:"ph",languageCode:"fil"},ta:{name:"Tamil",flagCode:"in",languageCode:"ta"},hu:{name:"Hungarian",flagCode:"hu",languageCode:"hu"},no:{name:"Norwegian",flagCode:"no",languageCode:"no"},vi:{name:"Vietnamese",flagCode:"vn",languageCode:"vi"},tl:{name:"Tagalog",flagCode:"ph",languageCode:"tl"},af:{name:"Afrikaans",flagCode:"za",languageCode:"af"},hy:{name:"Armenian",flagCode:"am",languageCode:"hy"},as:{name:"Assamese",flagCode:"in",languageCode:"as"},az:{name:"Azerbaijani",flagCode:"az",languageCode:"az"},be:{name:"Belarusian",flagCode:"by",languageCode:"be"},bn:{name:"Bengali",flagCode:"in",languageCode:"bn"},bs:{name:"Bosnian",flagCode:"ba",languageCode:"bs"},ca:{name:"Catalan",flagCode:"es-ct",languageCode:"ca"},et:{name:"Estonian",flagCode:"ee",languageCode:"et"},gl:{name:"Galician",flagCode:"es-ga",languageCode:"gl"},ka:{name:"Georgian",flagCode:"ge",languageCode:"ka"},gu:{name:"Gujarati",flagCode:"in",languageCode:"gu"},ha:{name:"Hausa",flagCode:"ng",languageCode:"ha"},he:{name:"Hebrew",flagCode:"il",languageCode:"he"},is:{name:"Icelandic",flagCode:"is",languageCode:"is"},ga:{name:"Irish",flagCode:"ie",languageCode:"ga"},jv:{name:"Javanese",flagCode:"id",languageCode:"jv"},kn:{name:"Kannada",flagCode:"in",languageCode:"kn"},kk:{name:"Kazakh",flagCode:"kz",languageCode:"kk"},ky:{name:"Kirghiz",flagCode:"kg",languageCode:"ky"},lv:{name:"Latvian",flagCode:"lv",languageCode:"lv"},lt:{name:"Lithuanian",flagCode:"lt",languageCode:"lt"},lb:{name:"Luxembourgish",flagCode:"lu",languageCode:"lb"},mk:{name:"Macedonian",flagCode:"mk",languageCode:"mk"},ml:{name:"Malayalam",flagCode:"in",languageCode:"ml"},mr:{name:"Marathi",flagCode:"in",languageCode:"mr"},ne:{name:"Nepali",flagCode:"np",languageCode:"ne"},ps:{name:"Pashto",flagCode:"af",languageCode:"ps"},fa:{name:"Persian",flagCode:"ir",languageCode:"fa"},pa:{name:"Punjabi",flagCode:"in",languageCode:"pa"},sr:{name:"Serbian",flagCode:"rs",languageCode:"sr"},sd:{name:"Sindhi",flagCode:"in",languageCode:"sd"},sl:{name:"Slovenian",flagCode:"si",languageCode:"sl"},so:{name:"Somali",flagCode:"so",languageCode:"so"},sw:{name:"Swahili",flagCode:"ke",languageCode:"sw"},te:{name:"Telugu",flagCode:"in",languageCode:"te"},th:{name:"Thai",flagCode:"th",languageCode:"th"},ur:{name:"Urdu",flagCode:"pk",languageCode:"ur"},cy:{name:"Welsh",flagCode:"gb-wls",languageCode:"cy"}};function Li(t){return Object.keys(ti).includes(t??"")}const xh=Ne(null);function Zy({children:t}){const e=bn(),n=Ae("language"),i=Ae("override-language"),r=At(n.peek()??e.peek().language),o=We(()=>(e.value.supported_language_overrides??[]).filter(Li)),s=We(()=>o.value.map(c=>ti[c]).sort((c,l)=>c.name.localeCompare(l.name))),a=ce(()=>({language:Ze(()=>{var c;return Li(i.value)?ti[i.value]:Li(r.value)&&o.value.includes(r.value)?ti[r.value]:(c=e.value)!=null&&c.language&&Li(e.value.language)?ti[e.value.language]:ti.en}),setLanguage:c=>{r.value=c},options:s,showPicker:Ze(()=>!Li(i.value)&&s.value.length>0)}),[]);return S(xh.Provider,{value:a,children:t})}function oa(){return mt(xh)}const Ih=Ne(null);function eb({children:t}){const{language:e}=oa(),n=Ae("override-prompt"),i=Ae("override-first-message"),r=Ae("override-voice-id"),o=We(()=>{var h;return{agent:{prompt:{prompt:n.value},firstMessage:i.value,language:(h=e.value)==null?void 0:h.languageCode},tts:{voiceId:r.value},client:{source:"widget",version:"0.0.1"}}}),s=Ae("dynamic-variables"),a=We(()=>{if(s.value)try{return JSON.parse(s.value)}catch(h){console.error(`[ConversationalAI] Cannot parse dynamic-variables: ${h==null?void 0:h.message}`)}}),{webSocketUrl:c}=Lo(),l=Ae("agent-id"),d=Ae("signed-url"),u=We(()=>{const h={dynamicVariables:a.value,overrides:o.value};return l.value?{agentId:l.value,connectionType:"websocket",origin:c.value,...h}:d.value?{signedUrl:d.value,...h}:(console.error("[ConversationalAI] Either agent-id or signed-url is required"),null)});return u.value?S(Ih.Provider,{value:u,children:t}):null}function tb(){return mt(Ih)}const Ah=Ne(null);function nb({children:t}){const e=ib();return S(Ah.Provider,{value:e,children:t})}function Ur(){return mt(Ah)}function ib(){const t=j(null),e=j(null),n=tb(),{isMuted:i}=ra();return yn(()=>{var r;i.value&&((r=t==null?void 0:t.current)==null||r.setMicMuted(i.value))}),G(()=>()=>{var r;(r=t.current)==null||r.endSession()},[]),ce(()=>{const r=Jt("disconnected"),o=Ze(()=>r.value==="disconnected"),s=Jt("listening"),a=Ze(()=>s.value==="speaking"),c=Jt(null),l=Jt(null),d=Jt(!1);return{status:r,isSpeaking:a,mode:s,isDisconnected:o,lastId:l,error:c,canSendFeedback:d,startSession:async u=>{var h;if((h=t.current)!=null&&h.isOpen())return t.current.getId();if(e.current)return(await e.current).getId();try{e.current=Xy.startSession({...rb(u,n.peek()),onModeChange:m=>{s.value=m.mode},onStatusChange:m=>{r.value=m.status},onCanSendFeedbackChange:m=>{d.value=m.canSendFeedback},onDisconnect:m=>{m.reason==="error"&&(c.value=m.message,console.error("[ConversationalAI] Disconnected due to an error:",m.message))}}),t.current=await e.current,i.peek()!==void 0&&t.current.setMicMuted(i.peek());const f=t.current.getId();return l.value=f,c.value=null,f}catch(f){let m="Could not start a conversation.";f instanceof CloseEvent?m=f.reason||m:f instanceof Error&&(m=f.message||m),c.value=m}finally{e.current=null}},endSession:async()=>{const u=t.current;t.current=null,await(u==null?void 0:u.endSession())},getInputVolume:()=>{var u;return((u=t.current)==null?void 0:u.getInputVolume())??0},getOutputVolume:()=>{var u;return((u=t.current)==null?void 0:u.getOutputVolume())??0},sendFeedback:u=>{var h;(h=t.current)==null||h.sendFeedback(u)}}},[n,i])}function rb(t,e){try{const n=new CustomEvent("chato-voice-agent:call",{bubbles:!0,composed:!0,detail:{config:structuredClone(e)}});return t.dispatchEvent(n),n.detail.config}catch(n){return console.error("[ConversationalAI] Could not trigger call event:",n),e}}const ob=`#version 300 es
precision highp float;

uniform float uTime;
uniform float uOffsets[7];
uniform vec3 uColor1;
uniform vec3 uColor2;
uniform sampler2D uPerlinTexture;

in vec2 vUv;

out vec4 outColor;

const float PI = 3.14159265358979323846;

// Draw a single oval with soft edges and calculate its gradient color
bool drawOval(vec2 polarUv, vec2 polarCenter, float a, float b, bool reverseGradient, float softness, out vec4 color) {
    vec2 p = polarUv - polarCenter;
    float oval = (p.x * p.x) / (a * a) + (p.y * p.y) / (b * b);
    
    float edge = smoothstep(1.0, 1.0 - softness, oval);
    
    if (edge > 0.0) {
        float gradient = reverseGradient ? (1.0 - (p.x / a + 1.0) / 2.0) : ((p.x / a + 1.0) / 2.0);
        color = vec4(vec3(gradient), 0.8 * edge);
        return true;
    }
    return false;
}

// Map grayscale value to a 4-color ramp (color1, color2, color3, color4)
vec3 colorRamp(float grayscale, vec3 color1, vec3 color2, vec3 color3, vec3 color4) {
    if (grayscale < 0.33) {
        return mix(color1, color2, grayscale * 3.0);
    } else if (grayscale < 0.66) {
        return mix(color2, color3, (grayscale - 0.33) * 3.0);
    } else {
        return mix(color3, color4, (grayscale - 0.66) * 3.0);
    }
}

vec2 hash2(vec2 p) {
    return fract(sin(vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)))) * 43758.5453);
}

// 2D noise for the ring
float noise2D(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    
    vec2 u = f * f * (3.0 - 2.0 * f);
    float n = mix(
        mix(dot(hash2(i + vec2(0.0, 0.0)), f - vec2(0.0, 0.0)),
            dot(hash2(i + vec2(1.0, 0.0)), f - vec2(1.0, 0.0)), u.x),
        mix(dot(hash2(i + vec2(0.0, 1.0)), f - vec2(0.0, 1.0)),
            dot(hash2(i + vec2(1.0, 1.0)), f - vec2(1.0, 1.0)), u.x),
        u.y
    );

    return 0.5 + 0.5 * n;
}

float sharpRing(vec2 uv, float theta, float time) {
    float ringStart = 1.0;
    float ringWidth = 0.5;
    float noiseScale = 5.0;
    
    vec2 noiseCoord = vec2(theta / (2.0 * PI), time * 0.1);
    noiseCoord *= noiseScale;
    
    float noise = noise2D(noiseCoord);
    noise = (noise - 0.5) * 4.0;
    
    return ringStart + noise * ringWidth * 1.5;
}

float smoothRing(vec2 uv, float time) {
    float angle = atan(uv.y, uv.x);
    if (angle < 0.0) angle += 2.0 * PI;
    
    vec2 noiseCoord = vec2(angle / (2.0 * PI), time * 0.1);
    noiseCoord *= 6.0;
    
    float noise = noise2D(noiseCoord);
    noise = (noise - 0.5) * 8.0;
    
    float ringStart = 0.9;
    float ringWidth = 0.3;
    
    return ringStart + noise * ringWidth;
}

void main() {
    // Normalize vUv to be centered around (0.0, 0.0)
    vec2 uv = vUv * 2.0 - 1.0;

    // Convert uv to polar coordinates
    float radius = length(uv);
    float theta = atan(uv.y, uv.x);
    if (theta < 0.0) theta += 2.0 * PI; // Normalize theta to [0, 2*PI]

    // Initialize the base color to white
    vec4 color = vec4(1.0, 1.0, 1.0, 1.0);

    // Original parameters for the ovals in polar coordinates
    float originalCenters[7] = float[7](0.0, 0.5 * PI, 1.0 * PI, 1.5 * PI, 2.0 * PI, 2.5 * PI, 3.0 * PI);

    // Parameters for the animated centers in polar coordinates
    float centers[7];
    for (int i = 0; i < 7; i++) {
        centers[i] = originalCenters[i] + 0.5 * sin(uTime / 20.0 + uOffsets[i]);
    }

    float a, b;
    vec4 ovalColor;

    // Check if the pixel is inside any of the ovals
    for (int i = 0; i < 7; i++) {
        float noise = texture(uPerlinTexture, vec2(mod(centers[i] + uTime * 0.05, 1.0), 0.5)).r;
        a = noise * 1.5; // Increased variance: goes from 0.0 to 1.0
        b = noise * 4.5; // Tall semi-minor axis
        bool reverseGradient = (i % 2 == 1); // Reverse gradient for every second oval

        // Calculate the distance in polar coordinates
        float distTheta = abs(theta - centers[i]);
        if (distTheta > PI) distTheta = 2.0 * PI - distTheta; // Shortest distance on circle
        float distRadius = radius;

        float softness = 0.4; // Controls edge softness (e.g. how much blur is applied to the ovals)

        // Check if the pixel is inside the oval in polar coordinates
        if (drawOval(vec2(distTheta, distRadius), vec2(0.0, 0.0), a, b, reverseGradient, softness, ovalColor)) {
            // Blend the oval color with the existing color
            color.rgb = mix(color.rgb, ovalColor.rgb, ovalColor.a);
            color.a = max(color.a, ovalColor.a); // Max alpha
        }
    }
    
    // Calculate both noisy rings
    float ringRadius1 = sharpRing(uv, theta, uTime);
    float ringRadius2 = smoothRing(uv, uTime);
    
    // Blend both rings
    float ringAlpha1 = (radius >= ringRadius1) ? 0.3 : 0.0;
    float ringAlpha2 = smoothstep(ringRadius2 - 0.05, ringRadius2 + 0.05, radius) * 0.25;
    
    float totalRingAlpha = max(ringAlpha1, ringAlpha2);
    
    // Apply screen blend mode for combined rings
    vec3 ringColor = vec3(1.0); // White ring color
    color.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - ringColor * totalRingAlpha);

    // Define colours to ramp against greyscale (could increase the amount of colours in the ramp)
    vec3 color1 = vec3(0.0, 0.0, 0.0); // Black
    vec3 color2 = uColor1; // Darker Color
    vec3 color3 = uColor2; // Lighter Color
    vec3 color4 = vec3(1.0, 1.0, 1.0); // White

    // Convert grayscale color to the color ramp
    float luminance = color.r; 
    color.rgb = colorRamp(luminance, color1, color2, color3, color4); // Apply the color ramp

    outColor = color;
}
`,sb=`#version 300 es
precision highp float;

in vec2 position;

out vec2 vUv;

void main() {
  vUv = position * 0.5 + 0.5;
  gl_Position = vec4(position, 0, 1);
}
`,Oh=0,ab=new Float32Array([-1,1,-1,-1,1,1,1,-1]),cb="https://storage.googleapis.com/eleven-public-cdn/images/perlin-noise.png",Et=class Et{constructor(e){Ht(this,"gl");Ht(this,"program");Ht(this,"startTime");Ht(this,"rafId",null);Ht(this,"resizeObserver");Ht(this,"copyNoiseImage",()=>{this.gl&&(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Et.noiseImage),this.gl.generateMipmap(this.gl.TEXTURE_2D))});Ht(this,"render",()=>{if(!this.gl){this.rafId=null;return}const e=(performance.now()-this.startTime)/1e3;this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uTime"),e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.rafId=requestAnimationFrame(this.render)});const n=e.getContext("webgl2",{depth:!1,stencil:!1});this.gl=n;const i=this.getShader(n.FRAGMENT_SHADER,ob),r=this.getShader(n.VERTEX_SHADER,sb);if(!i||!r)throw new Error("Failed to compile shaders");if(this.program=n.createProgram(),n.attachShader(this.program,i),n.attachShader(this.program,r),n.linkProgram(this.program),!n.getProgramParameter(this.program,n.LINK_STATUS))throw new Error("Failed to link program");const o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([128,128,128,255])),Et.noiseImage||(Et.noiseImage=new Image,Et.noiseImage.crossOrigin="anonymous",Et.noiseImage.src=cb),Et.noiseImage.complete?this.copyNoiseImage():Et.noiseImage.addEventListener("load",this.copyNoiseImage);const s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,ab,n.STATIC_DRAW),n.vertexAttribPointer(Oh,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(Oh),n.useProgram(this.program),n.uniform1i(n.getUniformLocation(this.program,"uPerlinTexture"),0),n.uniform1fv(n.getUniformLocation(this.program,"uOffsets"),new Float32Array(7).map(()=>Math.random()*Math.PI*2)),this.updateColors("#2792DC","#9CE6E6"),this.resizeObserver=new ResizeObserver(c=>{const l=c[0],d=l.devicePixelContentBoxSize?l.devicePixelContentBoxSize[0]:l.contentBoxSize[0];e.width=Math.min(512,d.inlineSize),e.height=Math.min(512,d.blockSize),this.updateViewport()});const a=e.parentElement;if(a)try{this.resizeObserver.observe(a,{box:"device-pixel-content-box"})}catch{this.resizeObserver.observe(a)}this.startTime=performance.now(),this.rafId=requestAnimationFrame(this.render)}dispose(){var e,n,i;this.rafId!==null&&cancelAnimationFrame(this.rafId),(e=this.resizeObserver)==null||e.disconnect(),(i=(n=this.gl)==null?void 0:n.getExtension("WEBGL_lose_context"))==null||i.loseContext(),this.gl=null,this.program=null}updateViewport(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}updateColors(e,n){this.updateColor("uColor1",e),this.updateColor("uColor2",n)}updateColor(e,n){try{const i=Number.parseInt(n.slice(1,3),16)/255,r=Number.parseInt(n.slice(3,5),16)/255,o=Number.parseInt(n.slice(5,7),16)/255;this.gl.uniform3fv(this.gl.getUniformLocation(this.program,e),[i**2.2,r**2.2,o**2.2])}catch(i){console.error(`[ConversationalAI] Failed to parse ${n} as color:`,i)}}getShader(e,n){const i=this.gl.createShader(e);return this.gl.shaderSource(i,n),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}};Ht(Et,"noiseImage");let sa=Et;const q={devHost:"_devHost_1968y_7",wrapper:"_wrapper_1968y_18",box:"_box_1968y_39",open:"_open_1968y_57",compact:"_compact_1968y_62",customContent:"_customContent_1968y_62",avatar:"_avatar_1968y_68",avatarBackground:"_avatarBackground_1968y_80",avatarImage:"_avatarImage_1968y_90",canvas:"_canvas_1968y_102",actions:"_actions_1968y_107",actionButtons:"_actionButtons_1968y_114",status:"_status_1968y_121",btn:"_btn_1968y_132",avatarButton:"_avatarButton_1968y_166",disabled:"_disabled_1968y_189",secondary:"_secondary_1968y_203",iconBtn:"_iconBtn_1968y_217",select:"_select_1968y_224",ellipsis:"_ellipsis_1968y_231",iconSlot:"_iconSlot_1968y_237",btnIcon:"_btnIcon_1968y_242",minimize:"_minimize_1968y_248",poweredBy:"_poweredBy_1968y_252",full:"_full_1968y_277",terms:"_terms_1968y_281",strong:"_strong_1968y_312",show:"_show_1968y_340",termsFooter:"_termsFooter_1968y_344",feedback:"_feedback_1968y_355",inlineFeedback:"_inlineFeedback_1968y_381",feedbackText:"_feedbackText_1968y_400",flag:"_flag_1968y_404",selectContent:"_selectContent_1968y_412",selectViewport:"_selectViewport_1968y_423",selectValue:"_selectValue_1968y_427",selectIcon:"_selectIcon_1968y_433",selectItem:"_selectItem_1968y_437",selectItemIndicator:"_selectItemIndicator_1968y_456",selectScrollButton:"_selectScrollButton_1968y_465",error:"_error_1968y_474"};function Dh(){const{getInputVolume:t,getOutputVolume:e,isSpeaking:n,isDisconnected:i}=Ur(),r=cm(),o=j(null),s=j(null);yn(()=>{if(i.value){o.current.style.transform="",s.current.style.transform="",s.current.style.opacity="";return}let c;function l(){const d=t(),u=e(),h=n.peek()?1:.5,f=n.peek()?1:1-d*.6,m=n.peek()?1+u*.6:1;o.current.style.transform=`scale(${m})`,s.current.style.transform=`scale(${f})`,s.current.style.opacity=`${h}`,c=requestAnimationFrame(l)}return l(),()=>{cancelAnimationFrame(c)}});const a=We(()=>({backgroundImage:r.value.type==="image"?`url(${r.value.url})`:r.value.type==="url"?`url(${r.value.custom_url})`:void 0}));return S("div",{className:q.avatar,children:[S("div",{ref:o,className:q.avatarBackground}),S("div",{ref:s,style:a,className:q.avatarImage,children:r.value.type==="orb"&&S(lb,{color1:r.value.color_1,color2:r.value.color_2})})]})}function lb({color1:t,color2:e}){const n=j(null),i=j(null);return G(()=>{var r;try{i.current=new sa(n.current)}catch{(r=i.current)==null||r.dispose(),i.current=null}return()=>{var o;(o=i.current)==null||o.dispose()}},[]),G(()=>{var r;(r=i.current)==null||r.updateColors(t,e)},[t,e]),S("canvas",{className:q.canvas,ref:n})}function db({value:t,children:e}){const[n,i]=B(!1);return G(()=>{if(n){const r=setTimeout(()=>{i(!1)},2e3);return()=>{clearTimeout(r)}}},[n]),S("button",{className:pt(q.btn,q.secondary),onClick:()=>{navigator.clipboard.writeText(t),i(!0)},children:n?"Copied!":e})}const ub={phone:hb,"phone-off":fb,"thumbs-up":pb,"thumbs-down":mb,mic:gb,"mic-off":vb,check:_b,"chevron-down":yb,"chevron-up":bb};function ni({name:t,className:e}){const n=ub[t];return S("slot",{name:`icon-${t}`,className:pt(q.iconSlot,e),children:S(n,{})})}function hb(t){return S("svg",{viewBox:"0 0 640 640",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",stroke:"currentColor",fill:"currentColor",...t,children:S("path",{d:"M 82.6 88.6 l 104 -24 c 11.3 -2.6 22.9 3.3 27.5 13.9 l 48 112 c 4.2 9.8 1.4 21.3 -6.9 28 l -60.6 49.6 c 36 76.7 98.9 140.5 177.2 177.2 l 49.6 -60.6 c 6.8 -8.3 18.2 -11.1 28 -6.9 l 112 48 C 572.1 430.5 578 442.1 575.4 453.4 l -24 104 C 548.9 568.2 539.3 576 528 576 c -256.1 0 -464 -207.5 -464 -464 c 0 -11.2 7.7 -20.9 18.6 -23.4 z"})})}function fb(t){return S("svg",{viewBox:"0 0 640 640",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",stroke:"currentColor",fill:"currentColor",...t,children:S("path",{d:"M 371.8 445.4 l 49.6 -60.6 c 6.8 -8.3 18.2 -11.1 28 -6.9 l 112 48 c 10.7 4.6 16.5 16.1 13.9 27.5 l -24 104 c -2.5 10.8 -12.1 18.6 -23.4 18.6 c -100.7 0 -193.7 -32.4 -269.7 -86.9 l 80 -61.8 c 10.9 6.5 22.1 12.7 33.6 18.1 z m -365.6 76.7 L 164.9 399.5 C 102.1 320.4 64 220.9 64 112 c 0 -11.2 7.7 -20.9 18.6 -23.4 l 104 -24 c 11.3 -2.6 22.9 3.3 27.5 13.9 l 48 112 c 4.2 9.8 1.4 21.3 -6.9 28 l -60.6 49.6 c 12.2 26.1 27.9 50.3 46 72.8 L 594.5 67.4 C 601.5 62 611.5 63.2 617 70.2 L 636.6 95.4 c 5.4 7 4.2 17 -2.8 22.4 l -588.4 454.7 c -7 5.4 -17 4.2 -22.5 -2.8 l -19.6 -25.3 c -5.4 -6.8 -4.1 -16.9 2.9 -22.3 z"})})}function pb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-thumbs-up",...t,children:[S("path",{d:"M7 10v12"}),S("path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"})]})}function mb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[S("path",{d:"M17 14V2"}),S("path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"})]})}function gb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[S("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),S("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),S("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function vb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[S("line",{x1:"2",x2:"22",y1:"2",y2:"22"}),S("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"}),S("path",{d:"M5 10v2a7 7 0 0 0 12 5"}),S("path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"}),S("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12"}),S("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function yb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:S("path",{d:"m6 9 6 6 6-6"})})}function bb(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:S("path",{d:"m18 15-6-6-6 6"})})}function _b(t){return S("svg",{xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:S("path",{d:"M20 6 9 17l-5-5"})})}const Cb={primary:"",secondary:q.secondary};function En({variant:t="secondary",children:e,icon:n,className:i,disabledStyle:r,truncate:o=!0,...s}){return S("button",{className:pt(q.btn,Cb[t],(s.disabled||r)&&q.disabled,i),type:"button",...s,children:[n&&S(ni,{className:q.btnIcon,name:n}),o?S("div",{className:q.ellipsis,children:e}):e]})}function kb(){const{error:t,lastId:e}=Ur();return S("div",{className:q.error,children:[S("h1",{children:"An error occurred"}),S("p",{children:t.value}),e.value&&S("p",{children:["Conversation ID: ",e.value]}),S("div",{className:q.termsFooter,children:[e.value&&S(db,{value:e.value,children:"Copy ID"}),S(En,{onClick:()=>{t.value=null},children:"Close"})]})]})}function aa({className:t,icon:e,...n}){return S(En,{className:pt(q.iconBtn,t),truncate:!1,...n,children:S(ni,{name:e})})}const Mh=1e3*30,Sb=1e3*5,Tb=1e3*60*5,Nh=Ne(null);function wb({children:t}){const e=bn(),{serverUrl:n}=Lo(),{canSendFeedback:i,sendFeedback:r,isDisconnected:o,error:s,lastId:a}=Ur(),c=At(0),l=At(!1);yn(()=>{a.value!==null&&(l.value=!0,c.value=0)}),yn(()=>{const g=Date.now()-c.value;if(g>=Mh)l.value=!0;else{l.value=!1;const v=setTimeout(()=>{l.value=!0},Mh-g);return()=>clearTimeout(v)}});const d=At(i.value);yn(()=>{if(i.value){const g=setTimeout(()=>{d.value=!0},Sb);return()=>clearTimeout(g)}d.value=!1});const u=At(!0);yn(()=>{if(o.value){const g=setTimeout(()=>{u.value=!1},Tb);return()=>clearTimeout(g)}u.value=!0});const h=At(null),f=We(()=>!!a.value&&h.value!==a.value&&s.value===null&&o.value&&(e.value.feedback_mode==="end"||e.value.feedback_mode==="during")),m=We(()=>!!a.value&&l.value&&s.value===null&&!o.value&&d.value&&e.value.feedback_mode==="during"),p=ce(()=>({endFeedbackActive:f,duringFeedbackActive:m,postEndFeedback:g=>{const v=a.peek();f.peek()&&v&&(h.value=v,Yy(v,g,n.peek()).catch(()=>{console.error(`[ConversationalAI] Cannot send feedback for conversation ${v}`)}))},postDuringFeedback:g=>{m.peek()&&(r(g),l.value=!1,c.value=Date.now())}}),[]);return S(Nh.Provider,{value:p,children:t})}function ca(){return mt(Nh)}const Eb=()=>{const{postEndFeedback:t}=ca();return S(Lh,{text:"Was the call helpful?",onSubmit:t,show:!0,inline:!0})},Pb=()=>{const{duringFeedbackActive:t,postDuringFeedback:e}=ca();return S(Lh,{text:"Is this response helpful?",onSubmit:e,show:t.value})},Lh=Zi(({onSubmit:t,text:e,show:n,inline:i})=>S("div",{className:pt(i?q.inlineFeedback:q.feedback,n&&q.show),children:[S("span",{className:q.feedbackText,children:e}),S(aa,{icon:"thumbs-up",variant:i?"primary":"secondary",title:"Yes",onClick:()=>t==null?void 0:t(!0)}),S(aa,{icon:"thumbs-down",variant:i?"primary":"secondary",title:"No",onClick:()=>t==null?void 0:t(!1)})]})),Uh=Ne(null);function Rb({children:t}){const e=bn(),n=bl(),i=ce(()=>Object.fromEntries(gl.map((r,o)=>[r,Ze(()=>n[vl[o]].value??e.value[r]??ml[r])])),[]);return S(Uh.Provider,{value:i,children:t})}function xb(){return mt(Uh)}function Fh(t,[e,n]){return Math.min(n,Math.max(e,t))}function Se(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function la(t,e=[]){let n=[];function i(o,s){const a=Ne(s),c=n.length;n=[...n,s];const l=u=>{var v;const{scope:h,children:f,...m}=u,p=((v=h==null?void 0:h[t])==null?void 0:v[c])||a,g=ce(()=>m,Object.values(m));return S(p.Provider,{value:g,children:f})};l.displayName=o+"Provider";function d(u,h){var p;const f=((p=h==null?void 0:h[t])==null?void 0:p[c])||a,m=Gt(f);if(m)return m;if(s!==void 0)return s;throw new Error(`\`${u}\` must be used within \`${o}\``)}return[l,d]}const r=()=>{const o=n.map(s=>Ne(s));return function(a){const c=(a==null?void 0:a[t])||o;return ce(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return r.scopeName=t,[i,Ib(r,...e)]}function Ib(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const s=i.reduce((a,{useScope:c,scopeName:l})=>{const u=c(o)[`__scope${l}`];return{...a,...u}},{});return ce(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}function Bh(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function jh(...t){return e=>{let n=!1;const i=t.map(r=>{const o=Bh(r,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let r=0;r<i.length;r++){const o=i[r];typeof o=="function"?o():Bh(t[r],null)}}}}function De(...t){return ie(jh(...t),t)}function Fr(t){const e=Ab(t),n=Y((i,r)=>{const{children:o,...s}=i,a=Yt.toArray(o),c=a.find(Db);if(c){const l=c.props.children,d=a.map(u=>u===c?Yt.count(l)>1?Yt.only(null):Ot(l)?l.props.children:null:u);return S(e,{...s,ref:r,children:Ot(l)?yi(l,void 0,d):null})}return S(e,{...s,ref:r,children:o})});return n.displayName=`${t}.Slot`,n}function Ab(t){const e=Y((n,i)=>{const{children:r,...o}=n;if(Ot(r)){const s=Nb(r),a=Mb(o,r.props);return r.type!==Ee&&(a.ref=i?jh(i,s):s),yi(r,a)}return Yt.count(r)>1?Yt.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Ob=Symbol("radix.slottable");function Db(t){return Ot(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ob}function Mb(t,e){const n={...e};for(const i in e){const r=t[i],o=e[i];/^on[A-Z]/.test(i)?r&&o?n[i]=(...a)=>{const c=o(...a);return r(...a),c}:r&&(n[i]=r):i==="style"?n[i]={...r,...o}:i==="className"&&(n[i]=[r,o].filter(Boolean).join(" "))}return{...t,...n}}function Nb(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Lb(t){const e=t+"CollectionProvider",[n,i]=la(e),[r,o]=n(e,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:g,children:v}=p,_=Dt.useRef(null),C=Dt.useRef(new Map).current;return S(r,{scope:g,itemMap:C,collectionRef:_,children:v})};s.displayName=e;const a=t+"CollectionSlot",c=Fr(a),l=Dt.forwardRef((p,g)=>{const{scope:v,children:_}=p,C=o(a,v),y=De(g,C.collectionRef);return S(c,{ref:y,children:_})});l.displayName=a;const d=t+"CollectionItemSlot",u="data-radix-collection-item",h=Fr(d),f=Dt.forwardRef((p,g)=>{const{scope:v,children:_,...C}=p,y=Dt.useRef(null),k=De(g,y),T=o(d,v);return Dt.useEffect(()=>(T.itemMap.set(y,{ref:y,...C}),()=>void T.itemMap.delete(y))),S(h,{[u]:"",ref:k,children:_})});f.displayName=d;function m(p){const g=o(t+"CollectionConsumer",p);return Dt.useCallback(()=>{const _=g.collectionRef.current;if(!_)return[];const C=Array.from(_.querySelectorAll(`[${u}]`));return Array.from(g.itemMap.values()).sort((T,E)=>C.indexOf(T.ref.current)-C.indexOf(E.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:s,Slot:l,ItemSlot:f},m,i]}var Ub=Ne(void 0);function Fb(t){const e=Gt(Ub);return t||e||"ltr"}var Bb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ce=Bb.reduce((t,e)=>{const n=Fr(`Primitive.${e}`),i=Y((r,o)=>{const{asChild:s,...a}=r,c=s?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S(c,{...a,ref:o})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function jb(t,e){t&&tr(()=>t.dispatchEvent(e))}function Pn(t){const e=j(t);return G(()=>{e.current=t}),ce(()=>(...n)=>{var i;return(i=e.current)==null?void 0:i.call(e,...n)},[])}function Vb(t,e=globalThis==null?void 0:globalThis.document){const n=Pn(t);G(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var qb="DismissableLayer",da="dismissableLayer.update",$b="dismissableLayer.pointerDownOutside",Wb="dismissableLayer.focusOutside",Vh,qh=Ne({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$h=Y((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:s,onDismiss:a,...c}=t,l=Gt(qh),[d,u]=B(null),h=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=B({}),m=De(e,E=>u(E)),p=Array.from(l.layers),[g]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),v=p.indexOf(g),_=d?p.indexOf(d):-1,C=l.layersWithOutsidePointerEventsDisabled.size>0,y=_>=v,k=Gb(E=>{const I=E.target,x=[...l.branches].some(D=>D.contains(I));!y||x||(r==null||r(E),s==null||s(E),E.defaultPrevented||a==null||a())},h),T=Kb(E=>{const I=E.target;[...l.branches].some(D=>D.contains(I))||(o==null||o(E),s==null||s(E),E.defaultPrevented||a==null||a())},h);return Vb(E=>{_===l.layers.size-1&&(i==null||i(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},h),G(()=>{if(d)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(Vh=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),Wh(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=Vh)}},[d,h,n,l]),G(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),Wh())},[d,l]),G(()=>{const E=()=>f({});return document.addEventListener(da,E),()=>document.removeEventListener(da,E)},[]),S(Ce.div,{...c,ref:m,style:{pointerEvents:C?y?"auto":"none":void 0,...t.style},onFocusCapture:Se(t.onFocusCapture,T.onFocusCapture),onBlurCapture:Se(t.onBlurCapture,T.onBlurCapture),onPointerDownCapture:Se(t.onPointerDownCapture,k.onPointerDownCapture)})});$h.displayName=qb;var Hb="DismissableLayerBranch",zb=Y((t,e)=>{const n=Gt(qh),i=j(null),r=De(e,i);return G(()=>{const o=i.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),S(Ce.div,{...t,ref:r})});zb.displayName=Hb;function Gb(t,e=globalThis==null?void 0:globalThis.document){const n=Pn(t),i=j(!1),r=j(()=>{});return G(()=>{const o=a=>{if(a.target&&!i.current){let c=function(){Hh($b,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);i.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function Kb(t,e=globalThis==null?void 0:globalThis.document){const n=Pn(t),i=j(!1);return G(()=>{const r=o=>{o.target&&!i.current&&Hh(Wb,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function Wh(){const t=new CustomEvent(da);document.dispatchEvent(t)}function Hh(t,e,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?jb(r,o):r.dispatchEvent(o)}var ua=0;function Jb(){G(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??zh()),document.body.insertAdjacentElement("beforeend",t[1]??zh()),ua++,()=>{ua===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),ua--}},[])}function zh(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var ha="focusScope.autoFocusOnMount",fa="focusScope.autoFocusOnUnmount",Gh={bubbles:!1,cancelable:!0},Yb="FocusScope",Kh=Y((t,e)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...s}=t,[a,c]=B(null),l=Pn(r),d=Pn(o),u=j(null),h=De(e,p=>c(p)),f=j({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;G(()=>{if(i){let p=function(C){if(f.paused||!a)return;const y=C.target;a.contains(y)?u.current=y:cn(u.current,{select:!0})},g=function(C){if(f.paused||!a)return;const y=C.relatedTarget;y!==null&&(a.contains(y)||cn(u.current,{select:!0}))},v=function(C){if(document.activeElement===document.body)for(const k of C)k.removedNodes.length>0&&cn(a)};document.addEventListener("focusin",p),document.addEventListener("focusout",g);const _=new MutationObserver(v);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",p),document.removeEventListener("focusout",g),_.disconnect()}}},[i,a,f.paused]),G(()=>{if(a){Xh.add(f);const p=document.activeElement;if(!a.contains(p)){const v=new CustomEvent(ha,Gh);a.addEventListener(ha,l),a.dispatchEvent(v),v.defaultPrevented||(Xb(n0(Jh(a)),{select:!0}),document.activeElement===p&&cn(a))}return()=>{a.removeEventListener(ha,l),setTimeout(()=>{const v=new CustomEvent(fa,Gh);a.addEventListener(fa,d),a.dispatchEvent(v),v.defaultPrevented||cn(p??document.body,{select:!0}),a.removeEventListener(fa,d),Xh.remove(f)},0)}}},[a,l,d,f]);const m=ie(p=>{if(!n&&!i||f.paused)return;const g=p.key==="Tab"&&!p.altKey&&!p.ctrlKey&&!p.metaKey,v=document.activeElement;if(g&&v){const _=p.currentTarget,[C,y]=Qb(_);C&&y?!p.shiftKey&&v===y?(p.preventDefault(),n&&cn(C,{select:!0})):p.shiftKey&&v===C&&(p.preventDefault(),n&&cn(y,{select:!0})):v===_&&p.preventDefault()}},[n,i,f.paused]);return S(Ce.div,{tabIndex:-1,...s,ref:h,onKeyDown:m})});Kh.displayName=Yb;function Xb(t,{select:e=!1}={}){const n=document.activeElement;for(const i of t)if(cn(i,{select:e}),document.activeElement!==n)return}function Qb(t){const e=Jh(t),n=Yh(e,t),i=Yh(e.reverse(),t);return[n,i]}function Jh(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Yh(t,e){for(const n of t)if(!Zb(n,{upTo:e}))return n}function Zb(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function e0(t){return t instanceof HTMLInputElement&&"select"in t}function cn(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&e0(t)&&e&&t.select()}}var Xh=t0();function t0(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=Qh(t,e),t.unshift(e)},remove(e){var n;t=Qh(t,e),(n=t[0])==null||n.resume()}}}function Qh(t,e){const n=[...t],i=n.indexOf(e);return i!==-1&&n.splice(i,1),n}function n0(t){return t.filter(e=>e.tagName!=="A")}var $e=globalThis!=null&&globalThis.document?ft:()=>{},i0=hl[" useId ".trim().toString()]||(()=>{}),r0=0;function pa(t){const[e,n]=B(i0());return $e(()=>{n(i=>i??String(r0++))},[t]),e?`radix-${e}`:""}const o0=["top","right","bottom","left"],ln=Math.min,Ge=Math.max,Br=Math.round,jr=Math.floor,dn=t=>({x:t,y:t}),s0={left:"right",right:"left",bottom:"top",top:"bottom"},a0={start:"end",end:"start"};function ma(t,e,n){return Ge(t,ln(e,n))}function $t(t,e){return typeof t=="function"?t(e):t}function Wt(t){return t.split("-")[0]}function ii(t){return t.split("-")[1]}function ga(t){return t==="x"?"y":"x"}function va(t){return t==="y"?"height":"width"}function un(t){return["top","bottom"].includes(Wt(t))?"y":"x"}function ya(t){return ga(un(t))}function c0(t,e,n){n===void 0&&(n=!1);const i=ii(t),r=ya(t),o=va(r);let s=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=Vr(s)),[s,Vr(s)]}function l0(t){const e=Vr(t);return[ba(t),e,ba(e)]}function ba(t){return t.replace(/start|end/g,e=>a0[e])}function d0(t,e,n){const i=["left","right"],r=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:i:e?i:r;case"left":case"right":return e?o:s;default:return[]}}function u0(t,e,n,i){const r=ii(t);let o=d0(Wt(t),n==="start",i);return r&&(o=o.map(s=>s+"-"+r),e&&(o=o.concat(o.map(ba)))),o}function Vr(t){return t.replace(/left|right|bottom|top/g,e=>s0[e])}function h0(t){return{top:0,right:0,bottom:0,left:0,...t}}function Zh(t){return typeof t!="number"?h0(t):{top:t,right:t,bottom:t,left:t}}function qr(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function ef(t,e,n){let{reference:i,floating:r}=t;const o=un(e),s=ya(e),a=va(s),c=Wt(e),l=o==="y",d=i.x+i.width/2-r.width/2,u=i.y+i.height/2-r.height/2,h=i[a]/2-r[a]/2;let f;switch(c){case"top":f={x:d,y:i.y-r.height};break;case"bottom":f={x:d,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:u};break;case"left":f={x:i.x-r.width,y:u};break;default:f={x:i.x,y:i.y}}switch(ii(e)){case"start":f[s]-=h*(n&&l?-1:1);break;case"end":f[s]+=h*(n&&l?-1:1);break}return f}const f0=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(e));let l=await s.getElementRects({reference:t,floating:e,strategy:r}),{x:d,y:u}=ef(l,i,c),h=i,f={},m=0;for(let p=0;p<a.length;p++){const{name:g,fn:v}=a[p],{x:_,y:C,data:y,reset:k}=await v({x:d,y:u,initialPlacement:i,placement:h,strategy:r,middlewareData:f,rects:l,platform:s,elements:{reference:t,floating:e}});d=_??d,u=C??u,f={...f,[g]:{...f[g],...y}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(h=k.placement),k.rects&&(l=k.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:r}):k.rects),{x:d,y:u}=ef(l,h,c)),p=-1)}return{x:d,y:u,placement:h,strategy:r,middlewareData:f}};async function Ui(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:o,rects:s,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:f=0}=$t(e,t),m=Zh(f),g=a[h?u==="floating"?"reference":"floating":u],v=qr(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(g)))==null||n?g:g.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:l,rootBoundary:d,strategy:c})),_=u==="floating"?{x:i,y:r,width:s.floating.width,height:s.floating.height}:s.reference,C=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),y=await(o.isElement==null?void 0:o.isElement(C))?await(o.getScale==null?void 0:o.getScale(C))||{x:1,y:1}:{x:1,y:1},k=qr(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:C,strategy:c}):_);return{top:(v.top-k.top+m.top)/y.y,bottom:(k.bottom-v.bottom+m.bottom)/y.y,left:(v.left-k.left+m.left)/y.x,right:(k.right-v.right+m.right)/y.x}}const p0=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:r,rects:o,platform:s,elements:a,middlewareData:c}=e,{element:l,padding:d=0}=$t(t,e)||{};if(l==null)return{};const u=Zh(d),h={x:n,y:i},f=ya(r),m=va(f),p=await s.getDimensions(l),g=f==="y",v=g?"top":"left",_=g?"bottom":"right",C=g?"clientHeight":"clientWidth",y=o.reference[m]+o.reference[f]-h[f]-o.floating[m],k=h[f]-o.reference[f],T=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let E=T?T[C]:0;(!E||!await(s.isElement==null?void 0:s.isElement(T)))&&(E=a.floating[C]||o.floating[m]);const I=y/2-k/2,x=E/2-p[m]/2-1,D=ln(u[v],x),O=ln(u[_],x),U=D,$=E-p[m]-O,H=E/2-p[m]/2+I,te=ma(U,H,$),W=!c.arrow&&ii(r)!=null&&H!==te&&o.reference[m]/2-(H<U?D:O)-p[m]/2<0,Q=W?H<U?H-U:H-$:0;return{[f]:h[f]+Q,data:{[f]:te,centerOffset:H-te-Q,...W&&{alignmentOffset:Q}},reset:W}}}),m0=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:o,rects:s,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...g}=$t(t,e);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const v=Wt(r),_=un(a),C=Wt(a)===a,y=await(c.isRTL==null?void 0:c.isRTL(l.floating)),k=h||(C||!p?[Vr(a)]:l0(a)),T=m!=="none";!h&&T&&k.push(...u0(a,p,m,y));const E=[a,...k],I=await Ui(e,g),x=[];let D=((i=o.flip)==null?void 0:i.overflows)||[];if(d&&x.push(I[v]),u){const H=c0(r,s,y);x.push(I[H[0]],I[H[1]])}if(D=[...D,{placement:r,overflows:x}],!x.every(H=>H<=0)){var O,U;const H=(((O=o.flip)==null?void 0:O.index)||0)+1,te=E[H];if(te)return{data:{index:H,overflows:D},reset:{placement:te}};let W=(U=D.filter(Q=>Q.overflows[0]<=0).sort((Q,V)=>Q.overflows[1]-V.overflows[1])[0])==null?void 0:U.placement;if(!W)switch(f){case"bestFit":{var $;const Q=($=D.filter(V=>{if(T){const ne=un(V.placement);return ne===_||ne==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(ne=>ne>0).reduce((ne,Te)=>ne+Te,0)]).sort((V,ne)=>V[1]-ne[1])[0])==null?void 0:$[0];Q&&(W=Q);break}case"initialPlacement":W=a;break}if(r!==W)return{reset:{placement:W}}}return{}}}};function tf(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function nf(t){return o0.some(e=>t[e]>=0)}const g0=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...r}=$t(t,e);switch(i){case"referenceHidden":{const o=await Ui(e,{...r,elementContext:"reference"}),s=tf(o,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:nf(s)}}}case"escaped":{const o=await Ui(e,{...r,altBoundary:!0}),s=tf(o,n.floating);return{data:{escapedOffsets:s,escaped:nf(s)}}}default:return{}}}}};async function v0(t,e){const{placement:n,platform:i,elements:r}=t,o=await(i.isRTL==null?void 0:i.isRTL(r.floating)),s=Wt(n),a=ii(n),c=un(n)==="y",l=["left","top"].includes(s)?-1:1,d=o&&c?-1:1,u=$t(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:m}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof m=="number"&&(f=a==="end"?m*-1:m),c?{x:f*d,y:h*l}:{x:h*l,y:f*d}}const y0=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:o,placement:s,middlewareData:a}=e,c=await v0(e,t);return s===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+c.x,y:o+c.y,data:{...c,placement:s}}}}},b0=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:g=>{let{x:v,y:_}=g;return{x:v,y:_}}},...c}=$t(t,e),l={x:n,y:i},d=await Ui(e,c),u=un(Wt(r)),h=ga(u);let f=l[h],m=l[u];if(o){const g=h==="y"?"top":"left",v=h==="y"?"bottom":"right",_=f+d[g],C=f-d[v];f=ma(_,f,C)}if(s){const g=u==="y"?"top":"left",v=u==="y"?"bottom":"right",_=m+d[g],C=m-d[v];m=ma(_,m,C)}const p=a.fn({...e,[h]:f,[u]:m});return{...p,data:{x:p.x-n,y:p.y-i,enabled:{[h]:o,[u]:s}}}}}},_0=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:r,rects:o,middlewareData:s}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=$t(t,e),d={x:n,y:i},u=un(r),h=ga(u);let f=d[h],m=d[u];const p=$t(a,e),g=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(c){const C=h==="y"?"height":"width",y=o.reference[h]-o.floating[C]+g.mainAxis,k=o.reference[h]+o.reference[C]-g.mainAxis;f<y?f=y:f>k&&(f=k)}if(l){var v,_;const C=h==="y"?"width":"height",y=["top","left"].includes(Wt(r)),k=o.reference[u]-o.floating[C]+(y&&((v=s.offset)==null?void 0:v[u])||0)+(y?0:g.crossAxis),T=o.reference[u]+o.reference[C]+(y?0:((_=s.offset)==null?void 0:_[u])||0)-(y?g.crossAxis:0);m<k?m=k:m>T&&(m=T)}return{[h]:f,[u]:m}}}},C0=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,i;const{placement:r,rects:o,platform:s,elements:a}=e,{apply:c=()=>{},...l}=$t(t,e),d=await Ui(e,l),u=Wt(r),h=ii(r),f=un(r)==="y",{width:m,height:p}=o.floating;let g,v;u==="top"||u==="bottom"?(g=u,v=h===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(v=u,g=h==="end"?"top":"bottom");const _=p-d.top-d.bottom,C=m-d.left-d.right,y=ln(p-d[g],_),k=ln(m-d[v],C),T=!e.middlewareData.shift;let E=y,I=k;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(I=C),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(E=_),T&&!h){const D=Ge(d.left,0),O=Ge(d.right,0),U=Ge(d.top,0),$=Ge(d.bottom,0);f?I=m-2*(D!==0||O!==0?D+O:Ge(d.left,d.right)):E=p-2*(U!==0||$!==0?U+$:Ge(d.top,d.bottom))}await c({...e,availableWidth:I,availableHeight:E});const x=await s.getDimensions(a.floating);return m!==x.width||p!==x.height?{reset:{rects:!0}}:{}}}};function $r(){return typeof window<"u"}function ri(t){return rf(t)?(t.nodeName||"").toLowerCase():"#document"}function Ke(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function St(t){var e;return(e=(rf(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function rf(t){return $r()?t instanceof Node||t instanceof Ke(t).Node:!1}function ct(t){return $r()?t instanceof Element||t instanceof Ke(t).Element:!1}function Tt(t){return $r()?t instanceof HTMLElement||t instanceof Ke(t).HTMLElement:!1}function of(t){return!$r()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ke(t).ShadowRoot}function Fi(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=lt(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(r)}function k0(t){return["table","td","th"].includes(ri(t))}function Wr(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function _a(t){const e=Ca(),n=ct(t)?lt(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function S0(t){let e=hn(t);for(;Tt(e)&&!oi(e);){if(_a(e))return e;if(Wr(e))return null;e=hn(e)}return null}function Ca(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function oi(t){return["html","body","#document"].includes(ri(t))}function lt(t){return Ke(t).getComputedStyle(t)}function Hr(t){return ct(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function hn(t){if(ri(t)==="html")return t;const e=t.assignedSlot||t.parentNode||of(t)&&t.host||St(t);return of(e)?e.host:e}function sf(t){const e=hn(t);return oi(e)?t.ownerDocument?t.ownerDocument.body:t.body:Tt(e)&&Fi(e)?e:sf(e)}function Bi(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=sf(t),o=r===((i=t.ownerDocument)==null?void 0:i.body),s=Ke(r);if(o){const a=ka(s);return e.concat(s,s.visualViewport||[],Fi(r)?r:[],a&&n?Bi(a):[])}return e.concat(r,Bi(r,[],n))}function ka(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function af(t){const e=lt(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=Tt(t),o=r?t.offsetWidth:n,s=r?t.offsetHeight:i,a=Br(n)!==o||Br(i)!==s;return a&&(n=o,i=s),{width:n,height:i,$:a}}function Sa(t){return ct(t)?t:t.contextElement}function si(t){const e=Sa(t);if(!Tt(e))return dn(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:o}=af(e);let s=(o?Br(n.width):n.width)/i,a=(o?Br(n.height):n.height)/r;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const T0=dn(0);function cf(t){const e=Ke(t);return!Ca()||!e.visualViewport?T0:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function w0(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ke(t)?!1:e}function Rn(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),o=Sa(t);let s=dn(1);e&&(i?ct(i)&&(s=si(i)):s=si(t));const a=w0(o,n,i)?cf(o):dn(0);let c=(r.left+a.x)/s.x,l=(r.top+a.y)/s.y,d=r.width/s.x,u=r.height/s.y;if(o){const h=Ke(o),f=i&&ct(i)?Ke(i):i;let m=h,p=ka(m);for(;p&&i&&f!==m;){const g=si(p),v=p.getBoundingClientRect(),_=lt(p),C=v.left+(p.clientLeft+parseFloat(_.paddingLeft))*g.x,y=v.top+(p.clientTop+parseFloat(_.paddingTop))*g.y;c*=g.x,l*=g.y,d*=g.x,u*=g.y,c+=C,l+=y,m=Ke(p),p=ka(m)}}return qr({width:d,height:u,x:c,y:l})}function E0(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const o=r==="fixed",s=St(i),a=e?Wr(e.floating):!1;if(i===s||a&&o)return n;let c={scrollLeft:0,scrollTop:0},l=dn(1);const d=dn(0),u=Tt(i);if((u||!u&&!o)&&((ri(i)!=="body"||Fi(s))&&(c=Hr(i)),Tt(i))){const h=Rn(i);l=si(i),d.x=h.x+i.clientLeft,d.y=h.y+i.clientTop}return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x,y:n.y*l.y-c.scrollTop*l.y+d.y}}function P0(t){return Array.from(t.getClientRects())}function Ta(t,e){const n=Hr(t).scrollLeft;return e?e.left+n:Rn(St(t)).left+n}function R0(t){const e=St(t),n=Hr(t),i=t.ownerDocument.body,r=Ge(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),o=Ge(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let s=-n.scrollLeft+Ta(t);const a=-n.scrollTop;return lt(i).direction==="rtl"&&(s+=Ge(e.clientWidth,i.clientWidth)-r),{width:r,height:o,x:s,y:a}}function x0(t,e){const n=Ke(t),i=St(t),r=n.visualViewport;let o=i.clientWidth,s=i.clientHeight,a=0,c=0;if(r){o=r.width,s=r.height;const l=Ca();(!l||l&&e==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}return{width:o,height:s,x:a,y:c}}function I0(t,e){const n=Rn(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,o=Tt(t)?si(t):dn(1),s=t.clientWidth*o.x,a=t.clientHeight*o.y,c=r*o.x,l=i*o.y;return{width:s,height:a,x:c,y:l}}function lf(t,e,n){let i;if(e==="viewport")i=x0(t,n);else if(e==="document")i=R0(St(t));else if(ct(e))i=I0(e,n);else{const r=cf(t);i={...e,x:e.x-r.x,y:e.y-r.y}}return qr(i)}function df(t,e){const n=hn(t);return n===e||!ct(n)||oi(n)?!1:lt(n).position==="fixed"||df(n,e)}function A0(t,e){const n=e.get(t);if(n)return n;let i=Bi(t,[],!1).filter(a=>ct(a)&&ri(a)!=="body"),r=null;const o=lt(t).position==="fixed";let s=o?hn(t):t;for(;ct(s)&&!oi(s);){const a=lt(s),c=_a(s);!c&&a.position==="fixed"&&(r=null),(o?!c&&!r:!c&&a.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||Fi(s)&&!c&&df(t,s))?i=i.filter(d=>d!==s):r=a,s=hn(s)}return e.set(t,i),i}function O0(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const s=[...n==="clippingAncestors"?Wr(e)?[]:A0(e,this._c):[].concat(n),i],a=s[0],c=s.reduce((l,d)=>{const u=lf(e,d,r);return l.top=Ge(u.top,l.top),l.right=ln(u.right,l.right),l.bottom=ln(u.bottom,l.bottom),l.left=Ge(u.left,l.left),l},lf(e,a,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function D0(t){const{width:e,height:n}=af(t);return{width:e,height:n}}function M0(t,e,n){const i=Tt(e),r=St(e),o=n==="fixed",s=Rn(t,!0,o,e);let a={scrollLeft:0,scrollTop:0};const c=dn(0);if(i||!i&&!o)if((ri(e)!=="body"||Fi(r))&&(a=Hr(e)),i){const f=Rn(e,!0,o,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else r&&(c.x=Ta(r));let l=0,d=0;if(r&&!i&&!o){const f=r.getBoundingClientRect();d=f.top+a.scrollTop,l=f.left+a.scrollLeft-Ta(r,f)}const u=s.left+a.scrollLeft-c.x-l,h=s.top+a.scrollTop-c.y-d;return{x:u,y:h,width:s.width,height:s.height}}function wa(t){return lt(t).position==="static"}function uf(t,e){if(!Tt(t)||lt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return St(t)===n&&(n=n.ownerDocument.body),n}function hf(t,e){const n=Ke(t);if(Wr(t))return n;if(!Tt(t)){let r=hn(t);for(;r&&!oi(r);){if(ct(r)&&!wa(r))return r;r=hn(r)}return n}let i=uf(t,e);for(;i&&k0(i)&&wa(i);)i=uf(i,e);return i&&oi(i)&&wa(i)&&!_a(i)?n:i||S0(t)||n}const N0=async function(t){const e=this.getOffsetParent||hf,n=this.getDimensions,i=await n(t.floating);return{reference:M0(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function L0(t){return lt(t).direction==="rtl"}const U0={convertOffsetParentRelativeRectToViewportRelativeRect:E0,getDocumentElement:St,getClippingRect:O0,getOffsetParent:hf,getElementRects:N0,getClientRects:P0,getDimensions:D0,getScale:si,isElement:ct,isRTL:L0};function F0(t,e){let n=null,i;const r=St(t);function o(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),o();const{left:l,top:d,width:u,height:h}=t.getBoundingClientRect();if(a||e(),!u||!h)return;const f=jr(d),m=jr(r.clientWidth-(l+u)),p=jr(r.clientHeight-(d+h)),g=jr(l),_={rootMargin:-f+"px "+-m+"px "+-p+"px "+-g+"px",threshold:Ge(0,ln(1,c))||1};let C=!0;function y(k){const T=k[0].intersectionRatio;if(T!==c){if(!C)return s();T?s(!1,T):i=setTimeout(()=>{s(!1,1e-7)},1e3)}C=!1}try{n=new IntersectionObserver(y,{..._,root:r.ownerDocument})}catch{n=new IntersectionObserver(y,_)}n.observe(t)}return s(!0),o}function B0(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=i,l=Sa(t),d=r||o?[...l?Bi(l):[],...Bi(e)]:[];d.forEach(v=>{r&&v.addEventListener("scroll",n,{passive:!0}),o&&v.addEventListener("resize",n)});const u=l&&a?F0(l,n):null;let h=-1,f=null;s&&(f=new ResizeObserver(v=>{let[_]=v;_&&_.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var C;(C=f)==null||C.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let m,p=c?Rn(t):null;c&&g();function g(){const v=Rn(t);p&&(v.x!==p.x||v.y!==p.y||v.width!==p.width||v.height!==p.height)&&n(),p=v,m=requestAnimationFrame(g)}return n(),()=>{var v;d.forEach(_=>{r&&_.removeEventListener("scroll",n),o&&_.removeEventListener("resize",n)}),u==null||u(),(v=f)==null||v.disconnect(),f=null,c&&cancelAnimationFrame(m)}}const j0=y0,V0=b0,q0=m0,$0=C0,W0=g0,ff=p0,H0=_0,z0=(t,e,n)=>{const i=new Map,r={platform:U0,...n},o={...r.platform,_c:i};return f0(t,e,{...r,platform:o})};var zr=typeof document<"u"?ft:G;function Gr(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!Gr(t[i],e[i]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const o=r[i];if(!(o==="_owner"&&t.$$typeof)&&!Gr(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function pf(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function mf(t,e){const n=pf(t);return Math.round(e*n)/n}function Ea(t){const e=j(t);return zr(()=>{e.current=t}),e}function G0(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:r,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[d,u]=B({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=B(i);Gr(h,i)||f(i);const[m,p]=B(null),[g,v]=B(null),_=ie(V=>{V!==T.current&&(T.current=V,p(V))},[]),C=ie(V=>{V!==E.current&&(E.current=V,v(V))},[]),y=o||m,k=s||g,T=j(null),E=j(null),I=j(d),x=c!=null,D=Ea(c),O=Ea(r),U=Ea(l),$=ie(()=>{if(!T.current||!E.current)return;const V={placement:e,strategy:n,middleware:h};O.current&&(V.platform=O.current),z0(T.current,E.current,V).then(ne=>{const Te={...ne,isPositioned:U.current!==!1};H.current&&!Gr(I.current,Te)&&(I.current=Te,tr(()=>{u(Te)}))})},[h,e,n,O,U]);zr(()=>{l===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,u(V=>({...V,isPositioned:!1})))},[l]);const H=j(!1);zr(()=>(H.current=!0,()=>{H.current=!1}),[]),zr(()=>{if(y&&(T.current=y),k&&(E.current=k),y&&k){if(D.current)return D.current(y,k,$);$()}},[y,k,$,D,x]);const te=ce(()=>({reference:T,floating:E,setReference:_,setFloating:C}),[_,C]),W=ce(()=>({reference:y,floating:k}),[y,k]),Q=ce(()=>{const V={position:n,left:0,top:0};if(!W.floating)return V;const ne=mf(W.floating,d.x),Te=mf(W.floating,d.y);return a?{...V,transform:"translate("+ne+"px, "+Te+"px)",...pf(W.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:ne,top:Te}},[n,a,W.floating,d.x,d.y]);return ce(()=>({...d,update:$,refs:te,elements:W,floatingStyles:Q}),[d,$,te,W,Q])}const K0=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:r}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?ff({element:i.current,padding:r}).fn(n):{}:i?ff({element:i,padding:r}).fn(n):{}}}},J0=(t,e)=>({...j0(t),options:[t,e]}),Y0=(t,e)=>({...V0(t),options:[t,e]}),X0=(t,e)=>({...H0(t),options:[t,e]}),Q0=(t,e)=>({...q0(t),options:[t,e]}),Z0=(t,e)=>({...$0(t),options:[t,e]}),e_=(t,e)=>({...W0(t),options:[t,e]}),t_=(t,e)=>({...K0(t),options:[t,e]});var n_="Arrow",gf=Y((t,e)=>{const{children:n,width:i=10,height:r=5,...o}=t;return S(Ce.svg,{...o,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:S("polygon",{points:"0,0 30,0 15,10"})})});gf.displayName=n_;var i_=gf;function r_(t){const[e,n]=B(void 0);return $e(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const o=r[0];let s,a;if("borderBoxSize"in o){const c=o.borderBoxSize,l=Array.isArray(c)?c[0]:c;s=l.inlineSize,a=l.blockSize}else s=t.offsetWidth,a=t.offsetHeight;n({width:s,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}var Pa="Popper",[vf,yf]=la(Pa),[o_,bf]=vf(Pa),_f=t=>{const{__scopePopper:e,children:n}=t,[i,r]=B(null);return S(o_,{scope:e,anchor:i,onAnchorChange:r,children:n})};_f.displayName=Pa;var Cf="PopperAnchor",kf=Y((t,e)=>{const{__scopePopper:n,virtualRef:i,...r}=t,o=bf(Cf,n),s=j(null),a=De(e,s),c=j(null);return G(()=>{const l=c.current;c.current=(i==null?void 0:i.current)||s.current,l!==c.current&&o.onAnchorChange(c.current)}),i?null:S(Ce.div,{...r,ref:a})});kf.displayName=Cf;var Ra="PopperContent",[s_,a_]=vf(Ra),Sf=Y((t,e)=>{var z,fe,Le,ue,oe,se;const{__scopePopper:n,side:i="bottom",sideOffset:r=0,align:o="center",alignOffset:s=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:m,...p}=t,g=bf(Ra,n),[v,_]=B(null),C=De(e,Xe=>_(Xe)),[y,k]=B(null),T=r_(y),E=(T==null?void 0:T.width)??0,I=(T==null?void 0:T.height)??0,x=i+(o!=="center"?"-"+o:""),D=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},O=Array.isArray(l)?l:[l],U=O.length>0,$={padding:D,boundary:O.filter(l_),altBoundary:U},{refs:H,floatingStyles:te,placement:W,isPositioned:Q,middlewareData:V}=G0({strategy:"fixed",placement:x,whileElementsMounted:(...Xe)=>B0(...Xe,{animationFrame:f==="always"}),elements:{reference:g.anchor},middleware:[J0({mainAxis:r+I,alignmentAxis:s}),c&&Y0({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?X0():void 0,...$}),c&&Q0({...$}),Z0({...$,apply:({elements:Xe,rects:Rt,availableWidth:Vi,availableHeight:qi})=>{const{width:$i,height:nk}=Rt.reference,oo=Xe.floating.style;oo.setProperty("--radix-popper-available-width",`${Vi}px`),oo.setProperty("--radix-popper-available-height",`${qi}px`),oo.setProperty("--radix-popper-anchor-width",`${$i}px`),oo.setProperty("--radix-popper-anchor-height",`${nk}px`)}}),y&&t_({element:y,padding:a}),d_({arrowWidth:E,arrowHeight:I}),h&&e_({strategy:"referenceHidden",...$})]}),[ne,Te]=Ef(W),we=Pn(m);$e(()=>{Q&&(we==null||we())},[Q,we]);const Je=(z=V.arrow)==null?void 0:z.x,Pt=(fe=V.arrow)==null?void 0:fe.y,Me=((Le=V.arrow)==null?void 0:Le.centerOffset)!==0,[Ye,An]=B();return $e(()=>{v&&An(window.getComputedStyle(v).zIndex)},[v]),S("div",{ref:H.setFloating,"data-radix-popper-content-wrapper":"",style:{...te,transform:Q?te.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ye,"--radix-popper-transform-origin":[(ue=V.transformOrigin)==null?void 0:ue.x,(oe=V.transformOrigin)==null?void 0:oe.y].join(" "),...((se=V.hide)==null?void 0:se.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:S(s_,{scope:n,placedSide:ne,onArrowChange:k,arrowX:Je,arrowY:Pt,shouldHideArrow:Me,children:S(Ce.div,{"data-side":ne,"data-align":Te,...p,ref:C,style:{...p.style,animation:Q?void 0:"none"}})})})});Sf.displayName=Ra;var Tf="PopperArrow",c_={top:"bottom",right:"left",bottom:"top",left:"right"},wf=Y(function(e,n){const{__scopePopper:i,...r}=e,o=a_(Tf,i),s=c_[o.placedSide];return S("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:S(i_,{...r,ref:n,style:{...r.style,display:"block"}})})});wf.displayName=Tf;function l_(t){return t!==null}var d_=t=>({name:"transformOrigin",options:t,fn(e){var g,v,_;const{placement:n,rects:i,middlewareData:r}=e,s=((g=r.arrow)==null?void 0:g.centerOffset)!==0,a=s?0:t.arrowWidth,c=s?0:t.arrowHeight,[l,d]=Ef(n),u={start:"0%",center:"50%",end:"100%"}[d],h=(((v=r.arrow)==null?void 0:v.x)??0)+a/2,f=(((_=r.arrow)==null?void 0:_.y)??0)+c/2;let m="",p="";return l==="bottom"?(m=s?u:`${h}px`,p=`${-c}px`):l==="top"?(m=s?u:`${h}px`,p=`${i.floating.height+c}px`):l==="right"?(m=`${-c}px`,p=s?u:`${f}px`):l==="left"&&(m=`${i.floating.width+c}px`,p=s?u:`${f}px`),{data:{x:m,y:p}}}});function Ef(t){const[e,n="center"]=t.split("-");return[e,n]}var u_=_f,h_=kf,f_=Sf,p_=wf,m_="Portal",Pf=Y((t,e)=>{var a;const{container:n,...i}=t,[r,o]=B(!1);$e(()=>o(!0),[]);const s=n||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return s?Dt.createPortal(S(Ce.div,{...i,ref:e}),s):null});Pf.displayName=m_;var g_=hl[" useInsertionEffect ".trim().toString()]||$e;function Rf({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,o,s]=v_({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:r;{const d=j(t!==void 0);G(()=>{const u=d.current;u!==a&&console.warn(`${i} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,i])}const l=ie(d=>{var u;if(a){const h=y_(d)?d(t):d;h!==t&&((u=s.current)==null||u.call(s,h))}else o(d)},[a,t,o,s]);return[c,l]}function v_({defaultProp:t,onChange:e}){const[n,i]=B(t),r=j(n),o=j(e);return g_(()=>{o.current=e},[e]),G(()=>{var s;r.current!==n&&((s=o.current)==null||s.call(o,n),r.current=n)},[n,r]),[n,i,o]}function y_(t){return typeof t=="function"}function b_(t){const e=j({value:t,previous:t});return ce(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var xf=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),__="VisuallyHidden",C_=Y((t,e)=>S(Ce.span,{...t,ref:e,style:{...xf,...t.style}}));C_.displayName=__;var k_=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},ai=new WeakMap,Kr=new WeakMap,Jr={},xa=0,If=function(t){return t&&(t.host||If(t.parentNode))},S_=function(t,e){return e.map(function(n){if(t.contains(n))return n;var i=If(n);return i&&t.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},T_=function(t,e,n,i){var r=S_(e,Array.isArray(t)?t:[t]);Jr[n]||(Jr[n]=new WeakMap);var o=Jr[n],s=[],a=new Set,c=new Set(r),l=function(u){!u||a.has(u)||(a.add(u),l(u.parentNode))};r.forEach(l);var d=function(u){!u||c.has(u)||Array.prototype.forEach.call(u.children,function(h){if(a.has(h))d(h);else try{var f=h.getAttribute(i),m=f!==null&&f!=="false",p=(ai.get(h)||0)+1,g=(o.get(h)||0)+1;ai.set(h,p),o.set(h,g),s.push(h),p===1&&m&&Kr.set(h,!0),g===1&&h.setAttribute(n,"true"),m||h.setAttribute(i,"true")}catch(v){console.error("aria-hidden: cannot operate on ",h,v)}})};return d(e),a.clear(),xa++,function(){s.forEach(function(u){var h=ai.get(u)-1,f=o.get(u)-1;ai.set(u,h),o.set(u,f),h||(Kr.has(u)||u.removeAttribute(i),Kr.delete(u)),f||u.removeAttribute(n)}),xa--,xa||(ai=new WeakMap,ai=new WeakMap,Kr=new WeakMap,Jr={})}},w_=function(t,e,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(t)?t:[t]),r=k_(t);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live]"))),T_(i,r,n,"aria-hidden")):function(){return null}},wt=function(){return wt=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},wt.apply(this,arguments)};function Af(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function E_(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,o;i<r;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Yr="right-scroll-bar-position",Xr="width-before-scroll-bar",P_="with-scroll-bars-hidden",R_="--removed-body-scroll-bar-size";function Ia(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function x_(t,e){var n=B(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(i){var r=n.value;r!==i&&(n.value=i,n.callback(i,r))}}}})[0];return n.callback=e,n.facade}var I_=typeof window<"u"?ft:G,Of=new WeakMap;function A_(t,e){var n=x_(null,function(i){return t.forEach(function(r){return Ia(r,i)})});return I_(function(){var i=Of.get(n);if(i){var r=new Set(i),o=new Set(t),s=n.current;r.forEach(function(a){o.has(a)||Ia(a,null)}),o.forEach(function(a){r.has(a)||Ia(a,s)})}Of.set(n,t)},[t]),n}function O_(t){return t}function D_(t,e){e===void 0&&(e=O_);var n=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var s=e(o,i);return n.push(s),function(){n=n.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(i=!0;n.length;){var s=n;n=[],s.forEach(o)}n={push:function(a){return o(a)},filter:function(){return n}}},assignMedium:function(o){i=!0;var s=[];if(n.length){var a=n;n=[],a.forEach(o),s=n}var c=function(){var d=s;s=[],d.forEach(o)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(d){s.push(d),l()},filter:function(d){return s=s.filter(d),n}}}};return r}function M_(t){t===void 0&&(t={});var e=D_(null);return e.options=wt({async:!0,ssr:!1},t),e}var Df=function(t){var e=t.sideCar,n=Af(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return pe(i,wt({},n))};Df.isSideCarExport=!0;function N_(t,e){return t.useMedium(e),Df}var Mf=M_(),Aa=function(){},Qr=Y(function(t,e){var n=j(null),i=B({onScrollCapture:Aa,onWheelCapture:Aa,onTouchMoveCapture:Aa}),r=i[0],o=i[1],s=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,u=t.shards,h=t.sideCar,f=t.noIsolation,m=t.inert,p=t.allowPinchZoom,g=t.as,v=g===void 0?"div":g,_=t.gapMode,C=Af(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),y=h,k=A_([n,e]),T=wt(wt({},C),r);return pe(Ee,null,d&&pe(y,{sideCar:Mf,removeScrollBar:l,shards:u,noIsolation:f,inert:m,setCallbacks:o,allowPinchZoom:!!p,lockRef:n,gapMode:_}),s?yi(Yt.only(a),wt(wt({},T),{ref:k})):pe(v,wt({},T,{className:c,ref:k}),a))});Qr.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Qr.classNames={fullWidth:Xr,zeroRight:Yr};var L_=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function U_(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=L_();return e&&t.setAttribute("nonce",e),t}function F_(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function B_(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var j_=function(){var t=0,e=null;return{add:function(n){t==0&&(e=U_())&&(F_(e,n),B_(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},V_=function(){var t=j_();return function(e,n){G(function(){return t.add(e),function(){t.remove()}},[e&&n])}},Nf=function(){var t=V_(),e=function(n){var i=n.styles,r=n.dynamic;return t(i,r),null};return e},q_={left:0,top:0,right:0,gap:0},Oa=function(t){return parseInt(t||"",10)||0},$_=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],i=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[Oa(n),Oa(i),Oa(r)]},W_=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return q_;var e=$_(t),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-n+e[2]-e[0])}},H_=Nf(),ci="data-scroll-locked",z_=function(t,e,n,i){var r=t.left,o=t.top,s=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(P_,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(ci,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Yr,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(Xr,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(Yr," .").concat(Yr,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(Xr," .").concat(Xr,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(ci,`] {
    `).concat(R_,": ").concat(a,`px;
  }
`)},Lf=function(){var t=parseInt(document.body.getAttribute(ci)||"0",10);return isFinite(t)?t:0},G_=function(){G(function(){return document.body.setAttribute(ci,(Lf()+1).toString()),function(){var t=Lf()-1;t<=0?document.body.removeAttribute(ci):document.body.setAttribute(ci,t.toString())}},[])},K_=function(t){var e=t.noRelative,n=t.noImportant,i=t.gapMode,r=i===void 0?"margin":i;G_();var o=ce(function(){return W_(r)},[r]);return pe(H_,{styles:z_(o,!e,r,n?"":"!important")})},Da=!1;if(typeof window<"u")try{var Zr=Object.defineProperty({},"passive",{get:function(){return Da=!0,!0}});window.addEventListener("test",Zr,Zr),window.removeEventListener("test",Zr,Zr)}catch{Da=!1}var li=Da?{passive:!1}:!1,J_=function(t){return t.tagName==="TEXTAREA"},Uf=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!J_(t)&&n[e]==="visible")},Y_=function(t){return Uf(t,"overflowY")},X_=function(t){return Uf(t,"overflowX")},Ff=function(t,e){var n=e.ownerDocument,i=e;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var r=Bf(t,i);if(r){var o=jf(t,i),s=o[1],a=o[2];if(s>a)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},Q_=function(t){var e=t.scrollTop,n=t.scrollHeight,i=t.clientHeight;return[e,n,i]},Z_=function(t){var e=t.scrollLeft,n=t.scrollWidth,i=t.clientWidth;return[e,n,i]},Bf=function(t,e){return t==="v"?Y_(e):X_(e)},jf=function(t,e){return t==="v"?Q_(e):Z_(e)},eC=function(t,e){return t==="h"&&e==="rtl"?-1:1},tC=function(t,e,n,i,r){var o=eC(t,window.getComputedStyle(e).direction),s=o*i,a=n.target,c=e.contains(a),l=!1,d=s>0,u=0,h=0;do{var f=jf(t,a),m=f[0],p=f[1],g=f[2],v=p-g-o*m;(m||v)&&Bf(t,a)&&(u+=v,h+=m),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(u)<1||!d&&Math.abs(h)<1)&&(l=!0),l},eo=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},Vf=function(t){return[t.deltaX,t.deltaY]},qf=function(t){return t&&"current"in t?t.current:t},nC=function(t,e){return t[0]===e[0]&&t[1]===e[1]},iC=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},rC=0,di=[];function oC(t){var e=j([]),n=j([0,0]),i=j(),r=B(rC++)[0],o=B(Nf)[0],s=j(t);G(function(){s.current=t},[t]),G(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var p=E_([t.lockRef.current],(t.shards||[]).map(qf),!0).filter(Boolean);return p.forEach(function(g){return g.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),p.forEach(function(g){return g.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var a=ie(function(p,g){if("touches"in p&&p.touches.length===2||p.type==="wheel"&&p.ctrlKey)return!s.current.allowPinchZoom;var v=eo(p),_=n.current,C="deltaX"in p?p.deltaX:_[0]-v[0],y="deltaY"in p?p.deltaY:_[1]-v[1],k,T=p.target,E=Math.abs(C)>Math.abs(y)?"h":"v";if("touches"in p&&E==="h"&&T.type==="range")return!1;var I=Ff(E,T);if(!I)return!0;if(I?k=E:(k=E==="v"?"h":"v",I=Ff(E,T)),!I)return!1;if(!i.current&&"changedTouches"in p&&(C||y)&&(i.current=k),!k)return!0;var x=i.current||k;return tC(x,g,p,x==="h"?C:y)},[]),c=ie(function(p){var g=p;if(!(!di.length||di[di.length-1]!==o)){var v="deltaY"in g?Vf(g):eo(g),_=e.current.filter(function(k){return k.name===g.type&&(k.target===g.target||g.target===k.shadowParent)&&nC(k.delta,v)})[0];if(_&&_.should){g.cancelable&&g.preventDefault();return}if(!_){var C=(s.current.shards||[]).map(qf).filter(Boolean).filter(function(k){return k.contains(g.target)}),y=C.length>0?a(g,C[0]):!s.current.noIsolation;y&&g.cancelable&&g.preventDefault()}}},[]),l=ie(function(p,g,v,_){var C={name:p,delta:g,target:v,should:_,shadowParent:sC(v)};e.current.push(C),setTimeout(function(){e.current=e.current.filter(function(y){return y!==C})},1)},[]),d=ie(function(p){n.current=eo(p),i.current=void 0},[]),u=ie(function(p){l(p.type,Vf(p),p.target,a(p,t.lockRef.current))},[]),h=ie(function(p){l(p.type,eo(p),p.target,a(p,t.lockRef.current))},[]);G(function(){return di.push(o),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",c,li),document.addEventListener("touchmove",c,li),document.addEventListener("touchstart",d,li),function(){di=di.filter(function(p){return p!==o}),document.removeEventListener("wheel",c,li),document.removeEventListener("touchmove",c,li),document.removeEventListener("touchstart",d,li)}},[]);var f=t.removeScrollBar,m=t.inert;return pe(Ee,null,m?pe(o,{styles:iC(r)}):null,f?pe(K_,{gapMode:t.gapMode}):null)}function sC(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const aC=N_(Mf,oC);var $f=Y(function(t,e){return pe(Qr,wt({},t,{ref:e,sideCar:aC}))});$f.classNames=Qr.classNames;var cC=[" ","Enter","ArrowUp","ArrowDown"],lC=[" ","Enter"],xn="Select",[to,no,dC]=Lb(xn),[ui,uC]=la(xn,[dC,yf]),io=yf(),[hC,fn]=ui(xn),[fC,pC]=ui(xn),Ma=t=>{const{__scopeSelect:e,children:n,open:i,defaultOpen:r,onOpenChange:o,value:s,defaultValue:a,onValueChange:c,dir:l,name:d,autoComplete:u,disabled:h,required:f,form:m}=t,p=io(e),[g,v]=B(null),[_,C]=B(null),[y,k]=B(!1),T=Fb(l),[E,I]=Rf({prop:i,defaultProp:r??!1,onChange:o,caller:xn}),[x,D]=Rf({prop:s,defaultProp:a,onChange:c,caller:xn}),O=j(null),U=g?m||!!g.closest("form"):!0,[$,H]=B(new Set),te=Array.from($).map(W=>W.props.value).join(";");return S(u_,{...p,children:S(hC,{required:f,scope:e,trigger:g,onTriggerChange:v,valueNode:_,onValueNodeChange:C,valueNodeHasChildren:y,onValueNodeHasChildrenChange:k,contentId:pa(),value:x,onValueChange:D,open:E,onOpenChange:I,dir:T,triggerPointerDownPosRef:O,disabled:h,children:[S(to.Provider,{scope:e,children:S(fC,{scope:t.__scopeSelect,onNativeOptionAdd:ie(W=>{H(Q=>new Set(Q).add(W))},[]),onNativeOptionRemove:ie(W=>{H(Q=>{const V=new Set(Q);return V.delete(W),V})},[]),children:n})}),U?S(ep,{"aria-hidden":!0,required:f,tabIndex:-1,name:d,autoComplete:u,value:x,onChange:W=>D(W.target.value),disabled:h,form:m,children:[x===void 0?S("option",{value:""}):null,Array.from($)]},te):null]})})};Ma.displayName=xn;var Wf="SelectTrigger",Na=Y((t,e)=>{const{__scopeSelect:n,disabled:i=!1,...r}=t,o=io(n),s=fn(Wf,n),a=s.disabled||i,c=De(e,s.onTriggerChange),l=no(n),d=j("touch"),[u,h,f]=np(p=>{const g=l().filter(C=>!C.disabled),v=g.find(C=>C.value===s.value),_=ip(g,p,v);_!==void 0&&s.onValueChange(_.value)}),m=p=>{a||(s.onOpenChange(!0),f()),p&&(s.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return S(h_,{asChild:!0,...o,children:S(Ce.button,{type:"button",role:"combobox","aria-controls":s.contentId,"aria-expanded":s.open,"aria-required":s.required,"aria-autocomplete":"none",dir:s.dir,"data-state":s.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":tp(s.value)?"":void 0,...r,ref:c,onClick:Se(r.onClick,p=>{p.currentTarget.focus(),d.current!=="mouse"&&m(p)}),onPointerDown:Se(r.onPointerDown,p=>{d.current=p.pointerType;const g=p.target;g.hasPointerCapture(p.pointerId)&&g.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(m(p),p.preventDefault())}),onKeyDown:Se(r.onKeyDown,p=>{const g=u.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&h(p.key),!(g&&p.key===" ")&&cC.includes(p.key)&&(m(),p.preventDefault())})})})});Na.displayName=Wf;var Hf="SelectValue",La=Y((t,e)=>{const{__scopeSelect:n,className:i,style:r,children:o,placeholder:s="",...a}=t,c=fn(Hf,n),{onValueNodeHasChildrenChange:l}=c,d=o!==void 0,u=De(e,c.onValueNodeChange);return $e(()=>{l(d)},[l,d]),S(Ce.span,{...a,ref:u,style:{pointerEvents:"none"},children:tp(c.value)?S(Ee,{children:s}):o})});La.displayName=Hf;var mC="SelectIcon",Ua=Y((t,e)=>{const{__scopeSelect:n,children:i,...r}=t;return S(Ce.span,{"aria-hidden":!0,...r,ref:e,children:i||""})});Ua.displayName=mC;var gC="SelectPortal",Fa=t=>S(Pf,{asChild:!0,...t});Fa.displayName=gC;var In="SelectContent",Ba=Y((t,e)=>{const n=fn(In,t.__scopeSelect),[i,r]=B();if($e(()=>{r(new DocumentFragment)},[]),!n.open){const o=i;return o?er(S(zf,{scope:t.__scopeSelect,children:S(to.Slot,{scope:t.__scopeSelect,children:S("div",{children:t.children})})}),o):null}return S(Gf,{...t,ref:e})});Ba.displayName=In;var dt=10,[zf,pn]=ui(In),vC="SelectContentImpl",yC=Fr("SelectContent.RemoveScroll"),Gf=Y((t,e)=>{const{__scopeSelect:n,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:o,onPointerDownOutside:s,side:a,sideOffset:c,align:l,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:f,sticky:m,hideWhenDetached:p,avoidCollisions:g,...v}=t,_=fn(In,n),[C,y]=B(null),[k,T]=B(null),E=De(e,z=>y(z)),[I,x]=B(null),[D,O]=B(null),U=no(n),[$,H]=B(!1),te=j(!1);G(()=>{if(C)return w_(C)},[C]),Jb();const W=ie(z=>{const[fe,...Le]=U().map(se=>se.ref.current),[ue]=Le.slice(-1),oe=document.activeElement;for(const se of z)if(se===oe||(se==null||se.scrollIntoView({block:"nearest"}),se===fe&&k&&(k.scrollTop=0),se===ue&&k&&(k.scrollTop=k.scrollHeight),se==null||se.focus(),document.activeElement!==oe))return},[U,k]),Q=ie(()=>W([I,C]),[W,I,C]);G(()=>{$&&Q()},[$,Q]);const{onOpenChange:V,triggerPointerDownPosRef:ne}=_;G(()=>{if(C){let z={x:0,y:0};const fe=ue=>{var oe,se;z={x:Math.abs(Math.round(ue.pageX)-(((oe=ne.current)==null?void 0:oe.x)??0)),y:Math.abs(Math.round(ue.pageY)-(((se=ne.current)==null?void 0:se.y)??0))}},Le=ue=>{z.x<=10&&z.y<=10?ue.preventDefault():C.contains(ue.target)||V(!1),document.removeEventListener("pointermove",fe),ne.current=null};return ne.current!==null&&(document.addEventListener("pointermove",fe),document.addEventListener("pointerup",Le,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",fe),document.removeEventListener("pointerup",Le,{capture:!0})}}},[C,V,ne]),G(()=>{const z=()=>V(!1);return window.addEventListener("blur",z),window.addEventListener("resize",z),()=>{window.removeEventListener("blur",z),window.removeEventListener("resize",z)}},[V]);const[Te,we]=np(z=>{const fe=U().filter(oe=>!oe.disabled),Le=fe.find(oe=>oe.ref.current===document.activeElement),ue=ip(fe,z,Le);ue&&setTimeout(()=>ue.ref.current.focus())}),Je=ie((z,fe,Le)=>{const ue=!te.current&&!Le;(_.value!==void 0&&_.value===fe||ue)&&(x(z),ue&&(te.current=!0))},[_.value]),Pt=ie(()=>C==null?void 0:C.focus(),[C]),Me=ie((z,fe,Le)=>{const ue=!te.current&&!Le;(_.value!==void 0&&_.value===fe||ue)&&O(z)},[_.value]),Ye=i==="popper"?ja:Kf,An=Ye===ja?{side:a,sideOffset:c,align:l,alignOffset:d,arrowPadding:u,collisionBoundary:h,collisionPadding:f,sticky:m,hideWhenDetached:p,avoidCollisions:g}:{};return S(zf,{scope:n,content:C,viewport:k,onViewportChange:T,itemRefCallback:Je,selectedItem:I,onItemLeave:Pt,itemTextRefCallback:Me,focusSelectedItem:Q,selectedItemText:D,position:i,isPositioned:$,searchRef:Te,children:S($f,{as:yC,allowPinchZoom:!0,children:S(Kh,{asChild:!0,trapped:_.open,onMountAutoFocus:z=>{z.preventDefault()},onUnmountAutoFocus:Se(r,z=>{var fe;(fe=_.trigger)==null||fe.focus({preventScroll:!0}),z.preventDefault()}),children:S($h,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:s,onFocusOutside:z=>z.preventDefault(),onDismiss:()=>_.onOpenChange(!1),children:S(Ye,{role:"listbox",id:_.contentId,"data-state":_.open?"open":"closed",dir:_.dir,onContextMenu:z=>z.preventDefault(),...v,...An,onPlaced:()=>H(!0),ref:E,style:{display:"flex",flexDirection:"column",outline:"none",...v.style},onKeyDown:Se(v.onKeyDown,z=>{const fe=z.ctrlKey||z.altKey||z.metaKey;if(z.key==="Tab"&&z.preventDefault(),!fe&&z.key.length===1&&we(z.key),["ArrowUp","ArrowDown","Home","End"].includes(z.key)){let ue=U().filter(oe=>!oe.disabled).map(oe=>oe.ref.current);if(["ArrowUp","End"].includes(z.key)&&(ue=ue.slice().reverse()),["ArrowUp","ArrowDown"].includes(z.key)){const oe=z.target,se=ue.indexOf(oe);ue=ue.slice(se+1)}setTimeout(()=>W(ue)),z.preventDefault()}})})})})})})});Gf.displayName=vC;var bC="SelectItemAlignedPosition",Kf=Y((t,e)=>{const{__scopeSelect:n,onPlaced:i,...r}=t,o=fn(In,n),s=pn(In,n),[a,c]=B(null),[l,d]=B(null),u=De(e,E=>d(E)),h=no(n),f=j(!1),m=j(!0),{viewport:p,selectedItem:g,selectedItemText:v,focusSelectedItem:_}=s,C=ie(()=>{if(o.trigger&&o.valueNode&&a&&l&&p&&g&&v){const E=o.trigger.getBoundingClientRect(),I=l.getBoundingClientRect(),x=o.valueNode.getBoundingClientRect(),D=v.getBoundingClientRect();if(o.dir!=="rtl"){const oe=D.left-I.left,se=x.left-oe,Xe=E.left-se,Rt=E.width+Xe,Vi=Math.max(Rt,I.width),qi=window.innerWidth-dt,$i=Fh(se,[dt,Math.max(dt,qi-Vi)]);a.style.minWidth=Rt+"px",a.style.left=$i+"px"}else{const oe=I.right-D.right,se=window.innerWidth-x.right-oe,Xe=window.innerWidth-E.right-se,Rt=E.width+Xe,Vi=Math.max(Rt,I.width),qi=window.innerWidth-dt,$i=Fh(se,[dt,Math.max(dt,qi-Vi)]);a.style.minWidth=Rt+"px",a.style.right=$i+"px"}const O=h(),U=window.innerHeight-dt*2,$=p.scrollHeight,H=window.getComputedStyle(l),te=parseInt(H.borderTopWidth,10),W=parseInt(H.paddingTop,10),Q=parseInt(H.borderBottomWidth,10),V=parseInt(H.paddingBottom,10),ne=te+W+$+V+Q,Te=Math.min(g.offsetHeight*5,ne),we=window.getComputedStyle(p),Je=parseInt(we.paddingTop,10),Pt=parseInt(we.paddingBottom,10),Me=E.top+E.height/2-dt,Ye=U-Me,An=g.offsetHeight/2,z=g.offsetTop+An,fe=te+W+z,Le=ne-fe;if(fe<=Me){const oe=O.length>0&&g===O[O.length-1].ref.current;a.style.bottom="0px";const se=l.clientHeight-p.offsetTop-p.offsetHeight,Xe=Math.max(Ye,An+(oe?Pt:0)+se+Q),Rt=fe+Xe;a.style.height=Rt+"px"}else{const oe=O.length>0&&g===O[0].ref.current;a.style.top="0px";const Xe=Math.max(Me,te+p.offsetTop+(oe?Je:0)+An)+Le;a.style.height=Xe+"px",p.scrollTop=fe-Me+p.offsetTop}a.style.margin=`${dt}px 0`,a.style.minHeight=Te+"px",a.style.maxHeight=U+"px",i==null||i(),requestAnimationFrame(()=>f.current=!0)}},[h,o.trigger,o.valueNode,a,l,p,g,v,o.dir,i]);$e(()=>C(),[C]);const[y,k]=B();$e(()=>{l&&k(window.getComputedStyle(l).zIndex)},[l]);const T=ie(E=>{E&&m.current===!0&&(C(),_==null||_(),m.current=!1)},[C,_]);return S(CC,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:f,onScrollButtonChange:T,children:S("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:y},children:S(Ce.div,{...r,ref:u,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});Kf.displayName=bC;var _C="SelectPopperPosition",ja=Y((t,e)=>{const{__scopeSelect:n,align:i="start",collisionPadding:r=dt,...o}=t,s=io(n);return S(f_,{...s,...o,ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});ja.displayName=_C;var[CC,Va]=ui(In,{}),qa="SelectViewport",$a=Y((t,e)=>{const{__scopeSelect:n,nonce:i,...r}=t,o=pn(qa,n),s=Va(qa,n),a=De(e,o.onViewportChange),c=j(0);return S(Ee,{children:[S("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),S(to.Slot,{scope:n,children:S(Ce.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:Se(r.onScroll,l=>{const d=l.currentTarget,{contentWrapper:u,shouldExpandOnScrollRef:h}=s;if(h!=null&&h.current&&u){const f=Math.abs(c.current-d.scrollTop);if(f>0){const m=window.innerHeight-dt*2,p=parseFloat(u.style.minHeight),g=parseFloat(u.style.height),v=Math.max(p,g);if(v<m){const _=v+f,C=Math.min(m,_),y=_-C;u.style.height=C+"px",u.style.bottom==="0px"&&(d.scrollTop=y>0?y:0,u.style.justifyContent="flex-end")}}}c.current=d.scrollTop})})})]})});$a.displayName=qa;var Jf="SelectGroup",[kC,SC]=ui(Jf),Wa=Y((t,e)=>{const{__scopeSelect:n,...i}=t,r=pa();return S(kC,{scope:n,id:r,children:S(Ce.div,{role:"group","aria-labelledby":r,...i,ref:e})})});Wa.displayName=Jf;var Yf="SelectLabel",Ha=Y((t,e)=>{const{__scopeSelect:n,...i}=t,r=SC(Yf,n);return S(Ce.div,{id:r.id,...i,ref:e})});Ha.displayName=Yf;var ro="SelectItem",[TC,Xf]=ui(ro),za=Y((t,e)=>{const{__scopeSelect:n,value:i,disabled:r=!1,textValue:o,...s}=t,a=fn(ro,n),c=pn(ro,n),l=a.value===i,[d,u]=B(o??""),[h,f]=B(!1),m=De(e,_=>{var C;return(C=c.itemRefCallback)==null?void 0:C.call(c,_,i,r)}),p=pa(),g=j("touch"),v=()=>{r||(a.onValueChange(i),a.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return S(TC,{scope:n,value:i,disabled:r,textId:p,isSelected:l,onItemTextChange:ie(_=>{u(C=>C||((_==null?void 0:_.textContent)??"").trim())},[]),children:S(to.ItemSlot,{scope:n,value:i,disabled:r,textValue:d,children:S(Ce.div,{role:"option","aria-labelledby":p,"data-highlighted":h?"":void 0,"aria-selected":l&&h,"data-state":l?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...s,ref:m,onFocus:Se(s.onFocus,()=>f(!0)),onBlur:Se(s.onBlur,()=>f(!1)),onClick:Se(s.onClick,()=>{g.current!=="mouse"&&v()}),onPointerUp:Se(s.onPointerUp,()=>{g.current==="mouse"&&v()}),onPointerDown:Se(s.onPointerDown,_=>{g.current=_.pointerType}),onPointerMove:Se(s.onPointerMove,_=>{var C;g.current=_.pointerType,r?(C=c.onItemLeave)==null||C.call(c):g.current==="mouse"&&_.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Se(s.onPointerLeave,_=>{var C;_.currentTarget===document.activeElement&&((C=c.onItemLeave)==null||C.call(c))}),onKeyDown:Se(s.onKeyDown,_=>{var y;((y=c.searchRef)==null?void 0:y.current)!==""&&_.key===" "||(lC.includes(_.key)&&v(),_.key===" "&&_.preventDefault())})})})})});za.displayName=ro;var ji="SelectItemText",Ga=Y((t,e)=>{const{__scopeSelect:n,className:i,style:r,...o}=t,s=fn(ji,n),a=pn(ji,n),c=Xf(ji,n),l=pC(ji,n),[d,u]=B(null),h=De(e,v=>u(v),c.onItemTextChange,v=>{var _;return(_=a.itemTextRefCallback)==null?void 0:_.call(a,v,c.value,c.disabled)}),f=d==null?void 0:d.textContent,m=ce(()=>S("option",{value:c.value,disabled:c.disabled,children:f},c.value),[c.disabled,c.value,f]),{onNativeOptionAdd:p,onNativeOptionRemove:g}=l;return $e(()=>(p(m),()=>g(m)),[p,g,m]),S(Ee,{children:[S(Ce.span,{id:c.textId,...o,ref:h}),c.isSelected&&s.valueNode&&!s.valueNodeHasChildren?er(o.children,s.valueNode):null]})});Ga.displayName=ji;var Qf="SelectItemIndicator",Ka=Y((t,e)=>{const{__scopeSelect:n,...i}=t;return Xf(Qf,n).isSelected?S(Ce.span,{"aria-hidden":!0,...i,ref:e}):null});Ka.displayName=Qf;var Ja="SelectScrollUpButton",Ya=Y((t,e)=>{const n=pn(Ja,t.__scopeSelect),i=Va(Ja,t.__scopeSelect),[r,o]=B(!1),s=De(e,i.onScrollButtonChange);return $e(()=>{if(n.viewport&&n.isPositioned){let a=function(){const l=c.scrollTop>0;o(l)};const c=n.viewport;return a(),c.addEventListener("scroll",a),()=>c.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?S(Zf,{...t,ref:s,onAutoScroll:()=>{const{viewport:a,selectedItem:c}=n;a&&c&&(a.scrollTop=a.scrollTop-c.offsetHeight)}}):null});Ya.displayName=Ja;var Xa="SelectScrollDownButton",Qa=Y((t,e)=>{const n=pn(Xa,t.__scopeSelect),i=Va(Xa,t.__scopeSelect),[r,o]=B(!1),s=De(e,i.onScrollButtonChange);return $e(()=>{if(n.viewport&&n.isPositioned){let a=function(){const l=c.scrollHeight-c.clientHeight,d=Math.ceil(c.scrollTop)<l;o(d)};const c=n.viewport;return a(),c.addEventListener("scroll",a),()=>c.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?S(Zf,{...t,ref:s,onAutoScroll:()=>{const{viewport:a,selectedItem:c}=n;a&&c&&(a.scrollTop=a.scrollTop+c.offsetHeight)}}):null});Qa.displayName=Xa;var Zf=Y((t,e)=>{const{__scopeSelect:n,onAutoScroll:i,...r}=t,o=pn("SelectScrollButton",n),s=j(null),a=no(n),c=ie(()=>{s.current!==null&&(window.clearInterval(s.current),s.current=null)},[]);return G(()=>()=>c(),[c]),$e(()=>{var d;const l=a().find(u=>u.ref.current===document.activeElement);(d=l==null?void 0:l.ref.current)==null||d.scrollIntoView({block:"nearest"})},[a]),S(Ce.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:Se(r.onPointerDown,()=>{s.current===null&&(s.current=window.setInterval(i,50))}),onPointerMove:Se(r.onPointerMove,()=>{var l;(l=o.onItemLeave)==null||l.call(o),s.current===null&&(s.current=window.setInterval(i,50))}),onPointerLeave:Se(r.onPointerLeave,()=>{c()})})}),wC="SelectSeparator",Za=Y((t,e)=>{const{__scopeSelect:n,...i}=t;return S(Ce.div,{"aria-hidden":!0,...i,ref:e})});Za.displayName=wC;var ec="SelectArrow",tc=Y((t,e)=>{const{__scopeSelect:n,...i}=t,r=io(n),o=fn(ec,n),s=pn(ec,n);return o.open&&s.position==="popper"?S(p_,{...r,...i,ref:e}):null});tc.displayName=ec;var EC="SelectBubbleInput",ep=Y(({__scopeSelect:t,value:e,...n},i)=>{const r=j(null),o=De(i,r),s=b_(e);return G(()=>{const a=r.current;if(!a)return;const c=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(c,"value").set;if(s!==e&&d){const u=new Event("change",{bubbles:!0});d.call(a,e),a.dispatchEvent(u)}},[s,e]),S(Ce.select,{...n,style:{...xf,...n.style},ref:o,defaultValue:e})});ep.displayName=EC;function tp(t){return t===""||t===void 0}function np(t){const e=Pn(t),n=j(""),i=j(0),r=ie(s=>{const a=n.current+s;e(a),function c(l){n.current=l,window.clearTimeout(i.current),l!==""&&(i.current=window.setTimeout(()=>c(""),1e3))}(a)},[e]),o=ie(()=>{n.current="",window.clearTimeout(i.current)},[]);return G(()=>()=>window.clearTimeout(i.current),[]),[n,r,o]}function ip(t,e,n){const r=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,o=n?t.indexOf(n):-1;let s=PC(t,Math.max(o,0));r.length===1&&(s=s.filter(l=>l!==n));const c=s.find(l=>l.textValue.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function PC(t,e){return t.map((n,i)=>t[(e+i)%t.length])}var RC=Ma,xC=Na,IC=La,AC=Ua,OC=Fa,DC=Ba,MC=$a,NC=Wa,LC=Ha,UC=za,FC=Ga,BC=Ka,jC=Ya,VC=Qa,qC=Za,$C=tc;const WC=Object.freeze(Object.defineProperty({__proto__:null,Arrow:$C,Content:DC,Group:NC,Icon:AC,Item:UC,ItemIndicator:BC,ItemText:FC,Label:LC,Portal:OC,Root:RC,ScrollDownButton:VC,ScrollUpButton:jC,Select:Ma,SelectArrow:tc,SelectContent:Ba,SelectGroup:Wa,SelectIcon:Ua,SelectItem:za,SelectItemIndicator:Ka,SelectItemText:Ga,SelectLabel:Ha,SelectPortal:Fa,SelectScrollDownButton:Qa,SelectScrollUpButton:Ya,SelectSeparator:Za,SelectTrigger:Na,SelectValue:La,SelectViewport:$a,Separator:qC,Trigger:xC,Value:IC,Viewport:MC,createSelectScope:uC},Symbol.toStringTag,{value:"Module"}));function rp({flagCode:t}){return S("img",{className:q.flag,src:`https://cdn.jsdelivr.net/gh/lipis/flag-icons/flags/4x3/${t}.svg`,alt:`${t.toUpperCase()} flag`})}const ut=WC;function HC({portal:t}){var a,c,l;const[e,n]=B(!1),{language:i,setLanguage:r,options:o,showPicker:s}=oa();return!s.value||!i.value?null:S(ut.Root,{open:e,value:(a=i.value)==null?void 0:a.languageCode,onValueChange:d=>{r(d),n(!1)},onOpenChange:d=>{d&&n(!0)},children:[S(ut.Trigger,{className:pt(q.btn,q.secondary,q.select),"aria-label":"Food",children:[S(rp,{flagCode:(c=i.value)==null?void 0:c.flagCode}),S("span",{className:q.selectValue,children:(l=i.value)==null?void 0:l.name}),S(ut.Icon,{className:q.selectIcon,children:S(ni,{name:"chevron-down"})})]}),S(ut.Portal,{container:t,children:S(ut.Content,{className:q.selectContent,position:"popper",sideOffset:8,align:"end",side:"top",onPointerDownOutside:()=>n(!1),onCloseAutoFocus:()=>n(!1),onEscapeKeyDown:()=>n(!1),children:[S(ut.ScrollUpButton,{className:q.selectScrollButton,children:S(ni,{name:"chevron-up"})}),S(ut.Viewport,{className:q.selectViewport,children:o.value.map(d=>S(ut.Item,{value:d.languageCode,className:pt(q.selectItem),children:[S(rp,{flagCode:d.flagCode}),S(ut.ItemText,{children:d.name}),S(ut.ItemIndicator,{className:q.selectItemIndicator,children:S(ni,{name:"check"})})]},d.languageCode))}),S(ut.ScrollDownButton,{className:q.selectScrollButton,children:S(ni,{name:"chevron-down"})})]})})]})}function zC(){const{isMuted:t,isMutingEnabled:e,setIsMuted:n}=ra(),i=ie(()=>{n(!t.peek())},[n]);return e.value?S(aa,{icon:t.value?"mic-off":"mic",onClick:i}):null}function GC({link:t}){return S("div",{className:q.poweredBy,children:[S("span",{children:""}),S("a",{href:t||"https://elevenlabs.io/agents",target:"_blank",children:"Agents"})]})}const KC=()=>!zp("(min-width: 768px)"),JC=({expandable:t,isMobile:e})=>{switch(t){case"always":return!0;case"mobile":return e;case"desktop":return!e;default:return!1}},YC=({allowExpanding:t,isOpen:e})=>t?e:!0,XC=Zi(function(){const{terms_key:e,terms_html:n,expandable:i,variant:r,disable_banner:o,show_avatar_when_collapsed:s,override_link:a}=bn().value,c=ce(()=>e?!!localStorage.getItem(e):!1,[e]),l=j(null),d=j(null),u=j(null),[h,f]=B(c),[m,p]=B(!1),[g,v]=B(null),[_,C]=B(!1),[y,k]=B(!1),{isMutingEnabled:T}=ra(),{startSession:E,endSession:I,error:x,isSpeaking:D,isDisconnected:O,status:U}=Ur(),$=KC(),H=JC({expandable:i,isMobile:$}),te=y||!H||!O.value,W=xb();G(()=>{var we;if(u.current){const Je=()=>{let Me=null;for(const Ye of u.current.assignedElements())if(Ye instanceof HTMLFormElement){Me=Ye;break}v(Me),C((Me==null?void 0:Me.checkValidity())??!1)};Je();const Pt=u.current;return Pt.addEventListener("slotchange",Je),()=>Pt.removeEventListener("slotchange",Je)}v(d.current),C(((we=d.current)==null?void 0:we.checkValidity())??!1)},[n]),G(()=>{c||!g?(p(!1),f(!0)):!c&&g&&f(!1)},[c,g]);const Q=YC({allowExpanding:H,isOpen:te}),{endFeedbackActive:V}=ca(),ne=oa(),Te=We(()=>({"--additional-width":ne.showPicker.value?"68px":T.value?"40px":void 0}));return S("div",{ref:l,style:Te,className:pt(q.wrapper,V.value?q.compact:q[r],te&&q.open,(m||x.value)&&q.customContent),children:[Q&&!o&&S(GC,{link:a}),H&&!te&&S(En,{variant:"primary",icon:s?void 0:"phone",className:pt(q.minimize,s&&q.avatarButton),onClick:()=>k(!0),title:W.expand_text,children:s?S(Dh,{}):W.expand_text}),S("div",{className:q.box,children:[x.value&&S(kb,{}),S("div",{className:pt(q.terms,m&&!x.value&&q.show),children:[n?S("form",{ref:d,onInput:()=>{C((g==null?void 0:g.checkValidity())??!1)},dangerouslySetInnerHTML:{__html:n}}):S("slot",{onInput:()=>{C((g==null?void 0:g.checkValidity())??!1)},ref:u,name:"terms"}),S("div",{className:q.termsFooter,children:[S(En,{onClick:()=>p(!1),children:"Cancel"}),S(En,{variant:"primary",disabledStyle:!_,onClick:we=>{g!=null&&g.reportValidity()&&(f(!0),e&&localStorage.setItem(e,"true"),p(!1),E(we.currentTarget))},children:"Agree"})]})]}),!m&&!x.value&&(V.value?S(Eb,{}):S(Ee,{children:[S(Dh,{}),S("div",{className:q.actions,children:[r!=="compact"&&S("p",{className:q.status,children:O.value?W.action_text:D.value?W.speaking_text:W.listening_text}),S("div",{className:q.actionButtons,children:O.value?S(Ee,{children:[S(En,{variant:"primary",icon:"phone",title:W.start_call_text,onClick:we=>{if(!h){p(!0);return}E(we.currentTarget)},children:W.start_call_text}),S(HC,{portal:l.current??void 0})]}):S(Ee,{children:[S(En,{icon:"phone-off",title:W.end_call_text,disabled:U.value!=="connected",onClick:()=>I(),children:W.end_call_text}),S(zC,{})]})})]})]}))]}),S(Pb,{})]})}),QC='@import"https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap";*{box-sizing:border-box}._devHost_1968y_7,:host{pointer-events:none;position:fixed;right:32px;bottom:32px;z-index:1000;--btn-max-width: 320px}._wrapper_1968y_18{display:flex;flex-direction:column-reverse;align-items:flex-end;gap:16px;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}._box_1968y_39{background-color:var(--el-bg-color);color:var(--el-text-color);border:1px solid var(--el-border-color);display:flex;align-items:center;gap:16px;padding:20px;border-radius:var(--el-border-radius);box-shadow:0 0 64px 64px #0000001a;pointer-events:none;opacity:0;transition:opacity .2s var(--el-timing-function);max-width:calc(100vw - 64px);max-height:calc(100vh - 64px)}._open_1968y_57 ._box_1968y_39{pointer-events:initial;opacity:1}._compact_1968y_62:not(._customContent_1968y_62) ._box_1968y_39{gap:8px;padding:12px;border-radius:32px}._avatar_1968y_68{position:relative;width:54px;height:54px;flex-shrink:0}._compact_1968y_62 ._avatar_1968y_68{width:36px;height:36px}._avatarBackground_1968y_80{border-radius:50%;position:absolute;top:-1px;left:-1px;right:-1px;bottom:-1px;background-color:var(--el-border-color)}._avatarImage_1968y_90{border-radius:50%;position:absolute;top:0;left:0;right:0;bottom:0;background-size:cover;background-color:var(--el-bg-color);overflow:hidden}._canvas_1968y_102{width:100%;height:100%}._actions_1968y_107{width:min-content;display:flex;gap:11px;flex-direction:column}._actionButtons_1968y_114{min-width:calc(156px + var(--additional-width, 0px));max-width:var(--btn-max-width);display:flex;gap:8px}._status_1968y_121{font-size:14px;text-wrap:nowrap;line-height:24px;margin:-7px 0;max-width:var(--btn-max-width);overflow:hidden;text-overflow:ellipsis;color:var(--el-text-color)}._btn_1968y_132{--el-ring-color: transparent;--el-ring-radius: 0;--el-focus-ring-radius: 0;--el-border-width: 0;background-color:var(--el-btn-color);color:var(--el-btn-text-color);border-radius:var(--el-btn-radius);box-shadow:0 1px 2px #1018280d,0 0 0 var(--el-ring-radius) var(--el-ring-color),0 0 0 var(--el-focus-ring-radius) var(--el-focus-color),inset 0 0 0 var(--el-border-width) var(--el-border-color);cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;padding:0 16px;display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;font-size:14px;font-weight:500;transition:all .2s var(--el-timing-function);flex-grow:1;flex-shrink:1;min-height:36px;min-width:0;max-width:var(--btn-max-width)}._avatarButton_1968y_166{background-color:transparent;color:transparent;box-shadow:none;height:56px;padding:0}._avatarButton_1968y_166 ._avatar_1968y_68{margin:1px}._btn_1968y_132:hover{--el-ring-color: rgba(125, 135, 155, .2);--el-ring-radius: 3px}._btn_1968y_132:active{--el-ring-color: rgba(101, 115, 135, .3);--el-ring-radius: 3px}._btn_1968y_132._disabled_1968y_189{opacity:.5}._btn_1968y_132:disabled{opacity:.5;pointer-events:none}._btn_1968y_132:focus-visible{--el-focus-ring-radius: 1px;outline:none}._btn_1968y_132._secondary_1968y_203{--el-border-width: 1px;background-color:var(--el-bg-color);color:var(--el-text-color)}._btn_1968y_132._secondary_1968y_203:hover{--el-ring-color: rgba(135, 145, 165, .1)}._btn_1968y_132._secondary_1968y_203:active{--el-ring-color: rgba(125, 135, 155, .2)}._btn_1968y_132._iconBtn_1968y_217{flex-grow:0;flex-shrink:0;height:36px;width:36px}._btn_1968y_132._select_1968y_224{flex-grow:0;flex-shrink:0;padding:6px;gap:4px}._ellipsis_1968y_231{flex-shrink:1;overflow:hidden;text-overflow:ellipsis}._iconSlot_1968y_237{display:flex;font-size:16px}._btnIcon_1968y_242{margin-left:-6px;margin-right:4px;flex-shrink:0}._minimize_1968y_248{pointer-events:all}._poweredBy_1968y_252{pointer-events:all;font-size:10px;align-self:center;text-align:center;color:var(--el-text-color)}._poweredBy_1968y_252 a,._poweredBy_1968y_252 span{opacity:.5}._poweredBy_1968y_252 a{white-space:nowrap;color:inherit;outline-color:var(--el-focus-color)}._poweredBy_1968y_252 a:hover,._poweredBy_1968y_252 a:focus-visible{opacity:1}._compact_1968y_62 ._poweredBy_1968y_252,._full_1968y_277 ._poweredBy_1968y_252{margin:-8px 0 -20px}._terms_1968y_281{display:none;max-width:480px;font-size:14px;line-height:20px;accent-color:var(--el-btn-color)}._terms_1968y_281 form{display:flex;flex-direction:column;gap:16px}._terms_1968y_281 p,._terms_1968y_281 ul,._terms_1968y_281 ol,._terms_1968y_281 h1,._terms_1968y_281 h2,._terms_1968y_281 h3,._terms_1968y_281 h4,._terms_1968y_281 h5,._terms_1968y_281 h6{margin:0;font-weight:400}._terms_1968y_281 a{color:var(--el-text-color)}._terms_1968y_281 ._strong_1968y_312{font-weight:500}._terms_1968y_281 h1{font-size:35px}._terms_1968y_281 h2{font-size:28px}._terms_1968y_281 h3{font-size:24px}._terms_1968y_281 h4{font-size:20px}._terms_1968y_281 h5{font-size:18px}._terms_1968y_281 h6{font-size:16px}._terms_1968y_281._show_1968y_340{display:block}._termsFooter_1968y_344{display:flex;gap:8px;justify-content:end;margin-top:20px}._termsFooter_1968y_344 ._btn_1968y_132{flex-grow:0}._feedback_1968y_355{display:flex;align-items:center;gap:8px;z-index:1;opacity:0;translate:0 8px;transition:all .6s var(--el-timing-function);font-size:12px;text-wrap:nowrap;line-height:10px;margin:0;color:var(--el-text-color)}._feedback_1968y_355._show_1968y_340{opacity:.5;translate:0 0;pointer-events:auto}._feedback_1968y_355._show_1968y_340:hover{opacity:1}._inlineFeedback_1968y_381{display:flex;align-items:center;gap:5px;z-index:1;translate:0 8px;transition:all .6s var(--el-timing-function);font-size:14px;font-weight:500;text-wrap:nowrap;line-height:20px}._inlineFeedback_1968y_381._show_1968y_340{translate:0 0;pointer-events:auto}._inlineFeedback_1968y_381 ._feedbackText_1968y_400{margin:0 12px}._flag_1968y_404{width:24px;height:24px;border-radius:50%;object-fit:cover;border:1px solid var(--el-border-color)}._selectContent_1968y_412{z-index:1;overflow:hidden;background-color:var(--el-bg-color);color:var(--el-text-color);border:1px solid var(--el-border-color);border-radius:var(--el-border-radius);max-height:min(384px,var(--radix-select-content-available-height));min-width:var(--radix-select-trigger-width)}._selectViewport_1968y_423{padding:8px}._selectValue_1968y_427{display:none;margin-right:auto;margin-left:auto}._selectIcon_1968y_433{padding-right:4px}._selectItem_1968y_437{display:flex;-webkit-user-select:none;user-select:none;align-items:center;padding:6px 32px 6px 6px;gap:8px;cursor:pointer;border-radius:var(--el-border-radius);position:relative}._selectItem_1968y_437:focus-visible{outline:none}._selectItem_1968y_437[data-highlighted]{background-color:#8080801a}._selectItemIndicator_1968y_456{position:absolute;right:0;width:32px;display:inline-flex;align-items:center;justify-content:center}._selectScrollButton_1968y_465{display:flex;align-items:center;justify-content:center;height:24px;background-color:var(--el-bg-color);cursor:default}._error_1968y_474{max-width:320px;font-size:14px;line-height:20px}._error_1968y_474 h1{margin:0 0 16px;font-size:20px;font-weight:400}._error_1968y_474 p{margin:0}';function ZC(){const t=bn();let e=QC;const n=We(()=>`.${q.devHost}, :host {
  --el-bg-color: ${t.value.bg_color??"#fff"};
  --el-text-color: ${t.value.text_color??"#000"};
  --el-border-color: ${t.value.border_color??"#e1e1e1"};
  --el-border-radius: ${t.value.border_radius??"20"}px;
  --el-btn-color: ${t.value.btn_color??"#000"};
  --el-btn-text-color: ${t.value.btn_text_color??"#fff"};
  --el-btn-radius: ${t.value.btn_radius??"32"}px;
  --el-focus-color: ${t.value.focus_color??"#000"};
  --el-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}`);return S("style",{children:[n,e]})}function ek(t){return S(Qp,{value:t,children:S(im,{children:S(om,{children:S(Zy,{children:S(Qy,{children:S(eb,{children:S(nb,{children:S(wb,{children:S(Rb,{children:S(am,{children:[S(ZC,{}),S(XC,{})]})})})})})})})})})})}const tk=window.__CHATO_VOICE_WIDGET_TAG_NAME__||"chato-voice-agent";mp(ek,tk,No,{shadow:!0})});
